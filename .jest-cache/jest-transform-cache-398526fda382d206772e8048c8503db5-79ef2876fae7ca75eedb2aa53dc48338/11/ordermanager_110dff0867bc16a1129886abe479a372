a96395c3ec6cfc61bb21bfa0bfdfca38
"use strict";
/**
 * =============================================================================
 * ORDER MANAGEMENT AND EXECUTION SYSTEM
 * =============================================================================
 *
 * This module implements a comprehensive order management system for Gate.io
 * cryptocurrency trading with validation, confirmation, status monitoring,
 * and comprehensive audit logging for all order operations.
 *
 * SECURITY FEATURES:
 * - Order validation with risk assessment before placement
 * - Real-time order status monitoring and updates
 * - Comprehensive audit logging for all order operations
 * - Order cancellation and modification with safety checks
 * - Position tracking and reconciliation
 * - Emergency stop-loss and position closure capabilities
 *
 * CRITICAL TRADING NOTICE:
 * This system handles real financial assets and trading operations.
 * All order operations must be validated and logged for audit compliance.
 *
 * @author AI Crypto Trading System
 * @version 1.0.0
 * @license PROPRIETARY
 * =============================================================================
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.OrderManager = void 0;
const events_1 = require("events");
const logger_1 = require("@/core/logging/logger");
const audit_service_1 = require("@/security/audit-service");
/**
 * Order Management and Execution System
 * Handles all order lifecycle operations with comprehensive validation and monitoring
 */
class OrderManager extends events_1.EventEmitter {
    gateIOClient;
    auditService;
    activeOrders = new Map();
    orderHistory = [];
    positions = new Map();
    stats;
    config;
    // Monitoring and validation
    statusMonitorInterval = null;
    statusCheckInterval = 5000; // 5 seconds
    maxOrderAge = 86400000; // 24 hours in milliseconds
    constructor(gateIOClient) {
        super();
        this.gateIOClient = gateIOClient;
        this.auditService = new audit_service_1.AuditService();
        // Initialize statistics
        this.stats = {
            totalOrders: 0,
            successfulOrders: 0,
            failedOrders: 0,
            cancelledOrders: 0,
            totalVolume: 0,
            totalFees: 0,
            averageExecutionTime: 0,
            successRate: 0,
            lastOrderTime: null,
        };
        // Default configuration
        this.config = {
            enablePreValidation: true,
            enablePostValidation: true,
            maxOrderValue: 10000, // $10,000 USD
            maxDailyVolume: 100000, // $100,000 USD
            enableRiskChecks: true,
            confirmationRequired: false,
            executionTimeout: 30000, // 30 seconds
        };
        logger_1.logger.info('üíπ Order Manager initialized with comprehensive validation');
    }
    /**
     * Initialize order manager with configuration
     *
     * @param config - Order execution configuration
     * @returns Promise<boolean> - Success status
     */
    async initialize(config) {
        try {
            logger_1.logger.info('üöÄ Initializing Order Manager...');
            // Update configuration
            if (config) {
                this.config = { ...this.config, ...config };
            }
            // Load existing orders from exchange
            await this.loadExistingOrders();
            // Start order status monitoring
            this.startOrderStatusMonitoring();
            // Initialize position tracking
            await this.initializePositionTracking();
            await this.auditService.logSecurityEvent({
                type: 'ORDER_MANAGER_INITIALIZED',
                severity: 'INFO',
                details: { config: this.config },
                timestamp: new Date(),
            });
            logger_1.logger.info('‚úÖ Order Manager initialized successfully');
            return true;
        }
        catch (error) {
            logger_1.logger.error('‚ùå Failed to initialize Order Manager:', error);
            await this.auditService.logSecurityEvent({
                type: 'ORDER_MANAGER_INIT_FAILED',
                severity: 'ERROR',
                details: { error: error.message },
                timestamp: new Date(),
            });
            return false;
        }
    }
    /**
     * Place new order with comprehensive validation and confirmation
     *
     * @param orderRequest - Order request parameters
     * @returns Promise<OrderExecutionResult> - Order execution result
     */
    async placeOrder(orderRequest) {
        const startTime = Date.now();
        try {
            logger_1.logger.info(`üìù Placing ${orderRequest.side} order for ${orderRequest.amount} ${orderRequest.currency_pair}`);
            // Pre-validation
            const validationResult = await this.validateOrder(orderRequest);
            if (!validationResult.isValid) {
                const error = `Order validation failed: ${validationResult.errors.join(', ')}`;
                await this.logOrderEvent('ORDER_VALIDATION_FAILED', orderRequest, { validationResult });
                return {
                    success: false,
                    order: null,
                    executionTime: Date.now() - startTime,
                    error,
                    validationResult,
                };
            }
            // Log validation warnings if any
            if (validationResult.warnings.length > 0) {
                logger_1.logger.warn('‚ö†Ô∏è Order validation warnings:', validationResult.warnings);
            }
            // Risk assessment
            if (this.config.enableRiskChecks) {
                const riskAssessment = await this.assessOrderRisk(orderRequest, validationResult);
                if (riskAssessment.riskScore > 80) {
                    const error = `Order risk score too high: ${riskAssessment.riskScore}/100`;
                    await this.logOrderEvent('ORDER_HIGH_RISK_REJECTED', orderRequest, { riskAssessment });
                    return {
                        success: false,
                        order: null,
                        executionTime: Date.now() - startTime,
                        error,
                        validationResult,
                    };
                }
            }
            // Execute order through Gate.io API
            const orderResponse = await this.executeOrder(orderRequest);
            // Post-validation
            if (this.config.enablePostValidation) {
                const postValidation = await this.validateOrderExecution(orderRequest, orderResponse);
                if (!postValidation.isValid) {
                    logger_1.logger.error('‚ùå Post-execution validation failed:', postValidation.errors);
                    // Attempt to cancel the order if validation fails
                    await this.cancelOrder(orderResponse.id, 'Post-validation failure');
                }
            }
            // Store order in active orders
            this.activeOrders.set(orderResponse.id, orderResponse);
            this.orderHistory.push(orderResponse);
            // Update statistics
            const executionTime = Date.now() - startTime;
            this.updateOrderStats(true, executionTime, parseFloat(orderRequest.amount), validationResult.estimatedFees);
            // Update position tracking
            await this.updatePositionTracking(orderResponse);
            // Log successful order placement
            await this.logOrderEvent('ORDER_PLACED_SUCCESS', orderRequest, {
                orderResponse,
                executionTime,
                validationResult
            });
            // Emit order placed event
            this.emit('orderPlaced', orderResponse);
            logger_1.logger.info(`‚úÖ Order placed successfully: ${orderResponse.id} (${executionTime}ms)`);
            return {
                success: true,
                order: orderResponse,
                executionTime,
                validationResult,
            };
        }
        catch (error) {
            const executionTime = Date.now() - startTime;
            // Update statistics
            this.updateOrderStats(false, executionTime, 0, 0);
            // Log failed order placement
            await this.logOrderEvent('ORDER_PLACEMENT_FAILED', orderRequest, {
                error: error.message,
                executionTime
            });
            logger_1.logger.error(`‚ùå Failed to place order: ${error.message}`);
            return {
                success: false,
                order: null,
                executionTime,
                error: error.message,
                validationResult: {
                    isValid: false,
                    errors: [error.message],
                    warnings: [],
                    riskScore: 100,
                    estimatedCost: 0,
                    estimatedFees: 0,
                },
            };
        }
    }
    /**
     * Cancel existing order with safety checks
     *
     * @param orderId - Order ID to cancel
     * @param reason - Cancellation reason
     * @returns Promise<boolean> - Success status
     */
    async cancelOrder(orderId, reason = 'User requested') {
        try {
            logger_1.logger.info(`üö´ Cancelling order: ${orderId} (reason: ${reason})`);
            // Check if order exists and is cancellable
            const order = this.activeOrders.get(orderId);
            if (!order) {
                logger_1.logger.warn(`‚ö†Ô∏è Order not found in active orders: ${orderId}`);
                return false;
            }
            if (order.status === 'closed' || order.status === 'cancelled') {
                logger_1.logger.warn(`‚ö†Ô∏è Order already ${order.status}: ${orderId}`);
                return false;
            }
            // Execute cancellation through Gate.io API
            await this.gateIOClient.makeRequest({
                method: 'DELETE',
                url: `/spot/orders/${orderId}`,
                data: { currency_pair: order.currency_pair },
            });
            // Update order status
            const updatedOrder = { ...order, status: 'cancelled' };
            this.activeOrders.set(orderId, updatedOrder);
            // Update statistics
            this.stats.cancelledOrders++;
            // Log cancellation
            await this.logOrderEvent('ORDER_CANCELLED', order, { reason });
            // Emit order cancelled event
            this.emit('orderCancelled', updatedOrder, reason);
            logger_1.logger.info(`‚úÖ Order cancelled successfully: ${orderId}`);
            return true;
        }
        catch (error) {
            logger_1.logger.error(`‚ùå Failed to cancel order ${orderId}:`, error);
            await this.logOrderEvent('ORDER_CANCELLATION_FAILED', { orderId }, {
                error: error.message,
                reason
            });
            return false;
        }
    }
    /**
     * Modify existing order
     *
     * @param orderId - Order ID to modify
     * @param modifications - Order modifications
     * @returns Promise<OrderResponse | null> - Modified order or null if failed
     */
    async modifyOrder(orderId, modifications) {
        try {
            logger_1.logger.info(`‚úèÔ∏è Modifying order: ${orderId}`);
            // Check if order exists and is modifiable
            const order = this.activeOrders.get(orderId);
            if (!order) {
                logger_1.logger.warn(`‚ö†Ô∏è Order not found: ${orderId}`);
                return null;
            }
            if (order.status !== 'open') {
                logger_1.logger.warn(`‚ö†Ô∏è Order not modifiable (status: ${order.status}): ${orderId}`);
                return null;
            }
            // Validate modifications
            const validationResult = await this.validateOrderModification(order, modifications);
            if (!validationResult.isValid) {
                logger_1.logger.error('‚ùå Order modification validation failed:', validationResult.errors);
                return null;
            }
            // Execute modification through Gate.io API
            const modifiedOrder = await this.gateIOClient.makeRequest({
                method: 'PATCH',
                url: `/spot/orders/${orderId}`,
                data: {
                    currency_pair: order.currency_pair,
                    ...modifications,
                },
            });
            // Update stored order
            this.activeOrders.set(orderId, modifiedOrder);
            // Log modification
            await this.logOrderEvent('ORDER_MODIFIED', order, {
                modifications,
                modifiedOrder,
                validationResult
            });
            // Emit order modified event
            this.emit('orderModified', modifiedOrder, modifications);
            logger_1.logger.info(`‚úÖ Order modified successfully: ${orderId}`);
            return modifiedOrder;
        }
        catch (error) {
            logger_1.logger.error(`‚ùå Failed to modify order ${orderId}:`, error);
            await this.logOrderEvent('ORDER_MODIFICATION_FAILED', { orderId }, {
                error: error.message,
                modifications
            });
            return null;
        }
    }
    /**
     * Get order status with real-time updates
     *
     * @param orderId - Order ID
     * @returns Promise<OrderResponse | null> - Order details or null if not found
     */
    async getOrderStatus(orderId) {
        try {
            // First check local cache
            const cachedOrder = this.activeOrders.get(orderId);
            // Fetch latest status from exchange
            const orderResponse = await this.gateIOClient.makeRequest({
                method: 'GET',
                url: `/spot/orders/${orderId}`,
                params: { currency_pair: cachedOrder?.currency_pair || 'BTC_USDT' },
            });
            // Update local cache
            if (orderResponse) {
                this.activeOrders.set(orderId, orderResponse);
                // Check for status changes
                if (cachedOrder && cachedOrder.status !== orderResponse.status) {
                    await this.handleOrderStatusChange(cachedOrder, orderResponse);
                }
            }
            return orderResponse;
        }
        catch (error) {
            logger_1.logger.error(`‚ùå Failed to get order status ${orderId}:`, error);
            return null;
        }
    }
    /**
     * Get all active orders
     *
     * @returns Array of active orders
     */
    getActiveOrders() {
        return Array.from(this.activeOrders.values()).filter(order => order.status === 'open');
    }
    /**
     * Get order history
     *
     * @param limit - Maximum number of orders to return
     * @returns Array of historical orders
     */
    getOrderHistory(limit = 100) {
        return this.orderHistory
            .sort((a, b) => new Date(b.create_time).getTime() - new Date(a.create_time).getTime())
            .slice(0, limit);
    }
    /**
     * Get position summary for symbol
     *
     * @param symbol - Trading symbol
     * @returns Position summary or null if no position
     */
    getPosition(symbol) {
        return this.positions.get(symbol) || null;
    }
    /**
     * Get all positions
     *
     * @returns Array of all position summaries
     */
    getAllPositions() {
        return Array.from(this.positions.values());
    }
    /**
     * Emergency stop - cancel all open orders
     *
     * @param reason - Emergency stop reason
     * @returns Promise<boolean> - Success status
     */
    async emergencyStop(reason = 'Emergency stop triggered') {
        try {
            logger_1.logger.warn(`üö® EMERGENCY STOP: ${reason}`);
            const activeOrders = this.getActiveOrders();
            const cancellationPromises = activeOrders.map(order => this.cancelOrder(order.id, `Emergency stop: ${reason}`));
            const results = await Promise.allSettled(cancellationPromises);
            const successCount = results.filter(result => result.status === 'fulfilled' && result.value === true).length;
            await this.auditService.logSecurityEvent({
                type: 'EMERGENCY_STOP_EXECUTED',
                severity: 'CRITICAL',
                details: {
                    reason,
                    totalOrders: activeOrders.length,
                    cancelledOrders: successCount
                },
                timestamp: new Date(),
            });
            logger_1.logger.warn(`üö® Emergency stop completed: ${successCount}/${activeOrders.length} orders cancelled`);
            // Emit emergency stop event
            this.emit('emergencyStop', reason, successCount, activeOrders.length);
            return successCount === activeOrders.length;
        }
        catch (error) {
            logger_1.logger.error('‚ùå Emergency stop failed:', error);
            return false;
        }
    }
    /**
     * Validate order before placement
     *
     * @param orderRequest - Order request to validate
     * @returns Promise<OrderValidationResult> - Validation result
     */
    async validateOrder(orderRequest) {
        const errors = [];
        const warnings = [];
        let riskScore = 0;
        // Validate required fields
        if (!orderRequest.currency_pair) {
            errors.push('Currency pair is required');
        }
        if (!orderRequest.side) {
            errors.push('Order side is required');
        }
        if (!orderRequest.amount || parseFloat(orderRequest.amount) <= 0) {
            errors.push('Order amount must be positive');
        }
        if (orderRequest.type === 'limit' && (!orderRequest.price || parseFloat(orderRequest.price) <= 0)) {
            errors.push('Limit orders require a positive price');
        }
        // Validate order size limits
        const orderValue = parseFloat(orderRequest.amount) * (parseFloat(orderRequest.price || '0') || 1);
        if (orderValue > this.config.maxOrderValue) {
            errors.push(`Order value exceeds maximum: ${orderValue} > ${this.config.maxOrderValue}`);
            riskScore += 30;
        }
        // Check daily volume limits
        const todayVolume = this.calculateTodayVolume();
        if (todayVolume + orderValue > this.config.maxDailyVolume) {
            warnings.push(`Order would exceed daily volume limit: ${todayVolume + orderValue} > ${this.config.maxDailyVolume}`);
            riskScore += 20;
        }
        // Estimate costs and fees
        const estimatedCost = orderValue;
        const estimatedFees = orderValue * 0.002; // Assume 0.2% fee
        // Check account balance (simplified)
        try {
            const balances = await this.gateIOClient.makeRequest({
                method: 'GET',
                url: '/spot/accounts',
            });
            // Add balance validation logic here
            // This is simplified - in production, you'd check specific currency balances
        }
        catch (error) {
            warnings.push('Could not verify account balance');
            riskScore += 10;
        }
        return {
            isValid: errors.length === 0,
            errors,
            warnings,
            riskScore,
            estimatedCost,
            estimatedFees,
        };
    }
    /**
     * Execute order through Gate.io API
     *
     * @param orderRequest - Order request
     * @returns Promise<OrderResponse> - Order response
     */
    async executeOrder(orderRequest) {
        const orderResponse = await this.gateIOClient.makeRequest({
            method: 'POST',
            url: '/spot/orders',
            data: orderRequest,
        });
        return orderResponse;
    }
    /**
     * Validate order execution
     *
     * @param orderRequest - Original order request
     * @param orderResponse - Order response from exchange
     * @returns Promise<OrderValidationResult> - Validation result
     */
    async validateOrderExecution(orderRequest, orderResponse) {
        const errors = [];
        const warnings = [];
        // Validate response matches request
        if (orderResponse.currency_pair !== orderRequest.currency_pair) {
            errors.push('Currency pair mismatch');
        }
        if (orderResponse.side !== orderRequest.side) {
            errors.push('Order side mismatch');
        }
        if (orderResponse.type !== orderRequest.type) {
            errors.push('Order type mismatch');
        }
        if (Math.abs(parseFloat(orderResponse.amount) - parseFloat(orderRequest.amount)) > 0.00001) {
            errors.push('Order amount mismatch');
        }
        // Validate order was accepted
        if (!orderResponse.id) {
            errors.push('Order ID not received');
        }
        if (orderResponse.status === 'cancelled' || orderResponse.status === 'expired') {
            warnings.push(`Order immediately ${orderResponse.status}`);
        }
        return {
            isValid: errors.length === 0,
            errors,
            warnings,
            riskScore: errors.length > 0 ? 100 : warnings.length * 10,
            estimatedCost: 0,
            estimatedFees: 0,
        };
    }
    /**
     * Assess order risk
     *
     * @param orderRequest - Order request
     * @param validationResult - Validation result
     * @returns Promise<any> - Risk assessment
     */
    async assessOrderRisk(orderRequest, validationResult) {
        // Simplified risk assessment
        // In production, this would include more sophisticated risk models
        return {
            riskScore: validationResult.riskScore,
            factors: validationResult.warnings,
        };
    }
    /**
     * Validate order modification
     *
     * @param order - Original order
     * @param modifications - Proposed modifications
     * @returns Promise<OrderValidationResult> - Validation result
     */
    async validateOrderModification(order, modifications) {
        const errors = [];
        const warnings = [];
        // Validate modification parameters
        if (modifications.price && parseFloat(modifications.price) <= 0) {
            errors.push('Modified price must be positive');
        }
        if (modifications.amount && parseFloat(modifications.amount) <= 0) {
            errors.push('Modified amount must be positive');
        }
        // Check if modifications are significant
        if (modifications.price && Math.abs(parseFloat(modifications.price) - parseFloat(order.price)) < 0.01) {
            warnings.push('Price modification is very small');
        }
        return {
            isValid: errors.length === 0,
            errors,
            warnings,
            riskScore: errors.length * 20,
            estimatedCost: 0,
            estimatedFees: 0,
        };
    }
    /**
     * Handle order status changes
     *
     * @param oldOrder - Previous order state
     * @param newOrder - New order state
     */
    async handleOrderStatusChange(oldOrder, newOrder) {
        const statusUpdate = {
            orderId: newOrder.id,
            oldStatus: oldOrder.status,
            newStatus: newOrder.status,
            timestamp: new Date(),
            filledAmount: newOrder.filled_total,
            remainingAmount: newOrder.left,
            averagePrice: newOrder.price,
        };
        // Log status change
        await this.logOrderEvent('ORDER_STATUS_CHANGED', newOrder, { statusUpdate });
        // Update position tracking
        await this.updatePositionTracking(newOrder);
        // Emit status change event
        this.emit('orderStatusChanged', statusUpdate);
        logger_1.logger.info(`üìä Order status changed: ${statusUpdate.orderId} (${statusUpdate.oldStatus} -> ${statusUpdate.newStatus})`);
    }
    /**
     * Load existing orders from exchange
     */
    async loadExistingOrders() {
        try {
            // Load open orders for each supported trading pair
            const symbols = ['BTC_USDT', 'ETH_USDT'];
            for (const symbol of symbols) {
                const orders = await this.gateIOClient.makeRequest({
                    method: 'GET',
                    url: '/spot/orders',
                    params: {
                        currency_pair: symbol,
                        status: 'open',
                        limit: 100
                    },
                });
                // Store active orders
                orders.forEach(order => {
                    this.activeOrders.set(order.id, order);
                    this.orderHistory.push(order);
                });
            }
            logger_1.logger.info(`üìã Loaded ${this.activeOrders.size} existing orders`);
        }
        catch (error) {
            logger_1.logger.error('‚ùå Failed to load existing orders:', error);
        }
    }
    /**
     * Start order status monitoring
     */
    startOrderStatusMonitoring() {
        this.statusMonitorInterval = setInterval(async () => {
            await this.monitorOrderStatuses();
        }, this.statusCheckInterval);
        logger_1.logger.info('üëÅÔ∏è Started order status monitoring');
    }
    /**
     * Monitor order statuses
     */
    async monitorOrderStatuses() {
        const activeOrders = this.getActiveOrders();
        for (const order of activeOrders) {
            try {
                await this.getOrderStatus(order.id);
            }
            catch (error) {
                logger_1.logger.error(`‚ùå Failed to monitor order ${order.id}:`, error);
            }
        }
        // Clean up old orders
        await this.cleanupOldOrders();
    }
    /**
     * Initialize position tracking
     */
    async initializePositionTracking() {
        try {
            // Initialize positions for supported symbols
            const symbols = ['BTC_USDT', 'ETH_USDT'];
            for (const symbol of symbols) {
                this.positions.set(symbol, {
                    symbol,
                    side: 'neutral',
                    totalAmount: 0,
                    averagePrice: 0,
                    unrealizedPnL: 0,
                    realizedPnL: 0,
                    openOrders: [],
                    lastUpdate: new Date(),
                });
            }
            logger_1.logger.info('üìä Position tracking initialized');
        }
        catch (error) {
            logger_1.logger.error('‚ùå Failed to initialize position tracking:', error);
        }
    }
    /**
     * Update position tracking
     *
     * @param order - Order to update position with
     */
    async updatePositionTracking(order) {
        try {
            const position = this.positions.get(order.currency_pair);
            if (!position)
                return;
            // Update position based on order status
            if (order.status === 'closed') {
                const filledAmount = parseFloat(order.filled_total);
                const price = parseFloat(order.price);
                if (order.side === 'buy') {
                    position.totalAmount += filledAmount;
                }
                else {
                    position.totalAmount -= filledAmount;
                }
                // Recalculate average price (simplified)
                if (position.totalAmount > 0) {
                    position.averagePrice = price; // Simplified calculation
                }
            }
            // Update open orders
            position.openOrders = this.getActiveOrders().filter(o => o.currency_pair === order.currency_pair);
            position.lastUpdate = new Date();
        }
        catch (error) {
            logger_1.logger.error('‚ùå Failed to update position tracking:', error);
        }
    }
    /**
     * Calculate today's trading volume
     */
    calculateTodayVolume() {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        return this.orderHistory
            .filter(order => new Date(order.create_time) >= today)
            .reduce((total, order) => {
            const volume = parseFloat(order.amount) * parseFloat(order.price);
            return total + volume;
        }, 0);
    }
    /**
     * Update order statistics
     *
     * @param success - Order success status
     * @param executionTime - Execution time in milliseconds
     * @param volume - Order volume
     * @param fees - Order fees
     */
    updateOrderStats(success, executionTime, volume, fees) {
        this.stats.totalOrders++;
        this.stats.lastOrderTime = new Date();
        if (success) {
            this.stats.successfulOrders++;
            this.stats.totalVolume += volume;
            this.stats.totalFees += fees;
        }
        else {
            this.stats.failedOrders++;
        }
        // Update average execution time
        const alpha = 0.1;
        this.stats.averageExecutionTime =
            (alpha * executionTime) + ((1 - alpha) * this.stats.averageExecutionTime);
        // Update success rate
        this.stats.successRate = (this.stats.successfulOrders / this.stats.totalOrders) * 100;
    }
    /**
     * Clean up old orders from memory
     */
    async cleanupOldOrders() {
        const cutoffTime = Date.now() - this.maxOrderAge;
        // Remove old orders from active orders map
        for (const [orderId, order] of this.activeOrders.entries()) {
            const orderTime = new Date(order.create_time).getTime();
            if (orderTime < cutoffTime && (order.status === 'closed' || order.status === 'cancelled')) {
                this.activeOrders.delete(orderId);
            }
        }
        // Limit order history size
        if (this.orderHistory.length > 1000) {
            this.orderHistory = this.orderHistory
                .sort((a, b) => new Date(b.create_time).getTime() - new Date(a.create_time).getTime())
                .slice(0, 1000);
        }
    }
    /**
     * Log order event for audit trail
     *
     * @param eventType - Event type
     * @param orderData - Order data
     * @param additionalData - Additional event data
     */
    async logOrderEvent(eventType, orderData, additionalData = {}) {
        await this.auditService.logSecurityEvent({
            type: eventType,
            severity: 'INFO',
            details: {
                orderData: this.sanitizeOrderData(orderData),
                ...additionalData,
            },
            timestamp: new Date(),
        });
    }
    /**
     * Sanitize order data for logging
     *
     * @param orderData - Order data to sanitize
     * @returns Sanitized order data
     */
    sanitizeOrderData(orderData) {
        // Remove sensitive information from logs
        const sanitized = { ...orderData };
        // Keep only essential order information
        if (sanitized.text) {
            delete sanitized.text; // May contain sensitive info
        }
        return sanitized;
    }
    /**
     * Get order management statistics
     */
    getOrderStats() {
        return { ...this.stats };
    }
    /**
     * Get order execution configuration
     */
    getConfig() {
        return { ...this.config };
    }
    /**
     * Update order execution configuration
     *
     * @param config - New configuration
     */
    updateConfig(config) {
        this.config = { ...this.config, ...config };
        logger_1.logger.info('‚öôÔ∏è Order execution configuration updated');
    }
    /**
     * Graceful shutdown
     */
    async shutdown() {
        logger_1.logger.info('üõë Shutting down Order Manager...');
        // Stop status monitoring
        if (this.statusMonitorInterval) {
            clearInterval(this.statusMonitorInterval);
            this.statusMonitorInterval = null;
        }
        // Log final statistics
        await this.auditService.logSecurityEvent({
            type: 'ORDER_MANAGER_SHUTDOWN',
            severity: 'INFO',
            details: {
                stats: this.stats,
                activeOrders: this.activeOrders.size,
                positions: this.positions.size
            },
            timestamp: new Date(),
        });
        logger_1.logger.info('‚úÖ Order Manager shutdown completed');
    }
}
exports.OrderManager = OrderManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxOaWNrXFxEZXNrdG9wXFxTbW9vdGhTYWlsXFxzcmNcXHRyYWRpbmdcXG9yZGVyc1xcb3JkZXItbWFuYWdlci50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0F5Qkc7OztBQUVILG1DQUFzQztBQUN0QyxrREFBK0M7QUFDL0MsNERBQXdEO0FBMkZ4RDs7O0dBR0c7QUFDSCxNQUFhLFlBQWEsU0FBUSxxQkFBWTtJQUNwQyxZQUFZLENBQWU7SUFDM0IsWUFBWSxDQUFlO0lBQzNCLFlBQVksR0FBK0IsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUNyRCxZQUFZLEdBQW9CLEVBQUUsQ0FBQztJQUNuQyxTQUFTLEdBQWlDLElBQUksR0FBRyxFQUFFLENBQUM7SUFDcEQsS0FBSyxDQUF1QjtJQUM1QixNQUFNLENBQXVCO0lBRXJDLDRCQUE0QjtJQUNwQixxQkFBcUIsR0FBMEIsSUFBSSxDQUFDO0lBQzNDLG1CQUFtQixHQUFXLElBQUksQ0FBQyxDQUFDLFlBQVk7SUFDaEQsV0FBVyxHQUFXLFFBQVEsQ0FBQyxDQUFDLDJCQUEyQjtJQUU1RSxZQUFZLFlBQTBCO1FBQ3BDLEtBQUssRUFBRSxDQUFDO1FBRVIsSUFBSSxDQUFDLFlBQVksR0FBRyxZQUFZLENBQUM7UUFDakMsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLDRCQUFZLEVBQUUsQ0FBQztRQUV2Qyx3QkFBd0I7UUFDeEIsSUFBSSxDQUFDLEtBQUssR0FBRztZQUNYLFdBQVcsRUFBRSxDQUFDO1lBQ2QsZ0JBQWdCLEVBQUUsQ0FBQztZQUNuQixZQUFZLEVBQUUsQ0FBQztZQUNmLGVBQWUsRUFBRSxDQUFDO1lBQ2xCLFdBQVcsRUFBRSxDQUFDO1lBQ2QsU0FBUyxFQUFFLENBQUM7WUFDWixvQkFBb0IsRUFBRSxDQUFDO1lBQ3ZCLFdBQVcsRUFBRSxDQUFDO1lBQ2QsYUFBYSxFQUFFLElBQUk7U0FDcEIsQ0FBQztRQUVGLHdCQUF3QjtRQUN4QixJQUFJLENBQUMsTUFBTSxHQUFHO1lBQ1os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QUMsTUFBcUM7UUFDdkQsSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLE1BQU0sRUFBRSxDQUFDO1FBQzVDLGVBQU0sQ0FBQyxJQUFJLENBQUMsMENBQTBDLENBQUMsQ0FBQztJQUMxRCxDQUFDO0lBRUQ7O09BRUc7SUFDSSxLQUFLLENBQUMsUUFBUTtRQUNuQixlQUFNLENBQUMsSUFBSSxDQUFDLG1DQUFtQyxDQUFDLENBQUM7UUFFakQseUJBQXlCO1FBQ3pCLElBQUksSUFBSSxDQUFDLHFCQUFxQixFQUFFLENBQUM7WUFDL0IsYUFBYSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1lBQzFDLElBQUksQ0FBQyxxQkFBcUIsR0FBRyxJQUFJLENBQUM7UUFDcEMsQ0FBQztRQUVELHVCQUF1QjtRQUN2QixNQUFNLElBQUksQ0FBQyxZQUFZLENBQUMsZ0JBQWdCLENBQUM7WUFDdkMsSUFBSSxFQUFFLHdCQUF3QjtZQUM5QixRQUFRLEVBQUUsTUFBTTtZQUNoQixPQUFPLEVBQUU7Z0JBQ1AsS0FBSyxFQUFFLElBQUksQ0FBQyxLQUFLO2dCQUNqQixZQUFZLEVBQUUsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJO2dCQUNwQyxTQUFTLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJO2FBQy9CO1lBQ0QsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO1NBQ3RCLENBQUMsQ0FBQztRQUVILGVBQU0sQ0FBQyxJQUFJLENBQUMsb0NBQW9DLENBQUMsQ0FBQztJQUNwRCxDQUFDO0NBQ0Y7QUFsOUJELG9DQWs5QkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxOaWNrXFxEZXNrdG9wXFxTbW9vdGhTYWlsXFxzcmNcXHRyYWRpbmdcXG9yZGVyc1xcb3JkZXItbWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICogT1JERVIgTUFOQUdFTUVOVCBBTkQgRVhFQ1VUSU9OIFNZU1RFTVxyXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gKiBcclxuICogVGhpcyBtb2R1bGUgaW1wbGVtZW50cyBhIGNvbXByZWhlbnNpdmUgb3JkZXIgbWFuYWdlbWVudCBzeXN0ZW0gZm9yIEdhdGUuaW9cclxuICogY3J5cHRvY3VycmVuY3kgdHJhZGluZyB3aXRoIHZhbGlkYXRpb24sIGNvbmZpcm1hdGlvbiwgc3RhdHVzIG1vbml0b3JpbmcsXHJcbiAqIGFuZCBjb21wcmVoZW5zaXZlIGF1ZGl0IGxvZ2dpbmcgZm9yIGFsbCBvcmRlciBvcGVyYXRpb25zLlxyXG4gKiBcclxuICogU0VDVVJJVFkgRkVBVFVSRVM6XHJcbiAqIC0gT3JkZXIgdmFsaWRhdGlvbiB3aXRoIHJpc2sgYXNzZXNzbWVudCBiZWZvcmUgcGxhY2VtZW50XHJcbiAqIC0gUmVhbC10aW1lIG9yZGVyIHN0YXR1cyBtb25pdG9yaW5nIGFuZCB1cGRhdGVzXHJcbiAqIC0gQ29tcHJlaGVuc2l2ZSBhdWRpdCBsb2dnaW5nIGZvciBhbGwgb3JkZXIgb3BlcmF0aW9uc1xyXG4gKiAtIE9yZGVyIGNhbmNlbGxhdGlvbiBhbmQgbW9kaWZpY2F0aW9uIHdpdGggc2FmZXR5IGNoZWNrc1xyXG4gKiAtIFBvc2l0aW9uIHRyYWNraW5nIGFuZCByZWNvbmNpbGlhdGlvblxyXG4gKiAtIEVtZXJnZW5jeSBzdG9wLWxvc3MgYW5kIHBvc2l0aW9uIGNsb3N1cmUgY2FwYWJpbGl0aWVzXHJcbiAqIFxyXG4gKiBDUklUSUNBTCBUUkFESU5HIE5PVElDRTpcclxuICogVGhpcyBzeXN0ZW0gaGFuZGxlcyByZWFsIGZpbmFuY2lhbCBhc3NldHMgYW5kIHRyYWRpbmcgb3BlcmF0aW9ucy5cclxuICogQWxsIG9yZGVyIG9wZXJhdGlvbnMgbXVzdCBiZSB2YWxpZGF0ZWQgYW5kIGxvZ2dlZCBmb3IgYXVkaXQgY29tcGxpYW5jZS5cclxuICogXHJcbiAqIEBhdXRob3IgQUkgQ3J5cHRvIFRyYWRpbmcgU3lzdGVtXHJcbiAqIEB2ZXJzaW9uIDEuMC4wXHJcbiAqIEBsaWNlbnNlIFBST1BSSUVUQVJZXHJcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcclxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnQC9jb3JlL2xvZ2dpbmcvbG9nZ2VyJztcclxuaW1wb3J0IHsgQXVkaXRTZXJ2aWNlIH0gZnJvbSAnQC9zZWN1cml0eS9hdWRpdC1zZXJ2aWNlJztcclxuaW1wb3J0IHsgR2F0ZUlPQ2xpZW50IH0gZnJvbSAnLi4vYXBpL2dhdGUtaW8tY2xpZW50JztcclxuaW1wb3J0IHsgXHJcbiAgT3JkZXJSZXF1ZXN0LCBcclxuICBPcmRlclJlc3BvbnNlLCBcclxuICBPcmRlck1vZGlmeVJlcXVlc3QsIFxyXG4gIE9yZGVyU3RhdHVzLCBcclxuICBPcmRlclNpZGUsIFxyXG4gIE9yZGVyVHlwZSxcclxuICBUcmFkaW5nU3ltYm9sLFxyXG4gIFRpbWVJbkZvcmNlIFxyXG59IGZyb20gJy4uL2FwaS90eXBlcyc7XHJcblxyXG4vKipcclxuICogT3JkZXIgdmFsaWRhdGlvbiByZXN1bHRcclxuICovXHJcbmludGVyZmFjZSBPcmRlclZhbGlkYXRpb25SZXN1bHQge1xyXG4gIGlzVmFsaWQ6IGJvb2xlYW47XHJcbiAgZXJyb3JzOiBzdHJpbmdbXTtcclxuICB3YXJuaW5nczogc3RyaW5nW107XHJcbiAgcmlza1Njb3JlOiBudW1iZXI7IC8vIDAtMTAwXHJcbiAgZXN0aW1hdGVkQ29zdDogbnVtYmVyO1xyXG4gIGVzdGltYXRlZEZlZXM6IG51bWJlcjtcclxufVxyXG5cclxuLyoqXHJcbiAqIE9yZGVyIGV4ZWN1dGlvbiByZXN1bHRcclxuICovXHJcbmludGVyZmFjZSBPcmRlckV4ZWN1dGlvblJlc3VsdCB7XHJcbiAgc3VjY2VzczogYm9vbGVhbjtcclxuICBvcmRlcjogT3JkZXJSZXNwb25zZSB8IG51bGw7XHJcbiAgZXhlY3V0aW9uVGltZTogbnVtYmVyO1xyXG4gIGVycm9yPzogc3RyaW5nO1xyXG4gIHZhbGlkYXRpb25SZXN1bHQ6IE9yZGVyVmFsaWRhdGlvblJlc3VsdDtcclxufVxyXG5cclxuLyoqXHJcbiAqIE9yZGVyIHN0YXR1cyB1cGRhdGVcclxuICovXHJcbmludGVyZmFjZSBPcmRlclN0YXR1c1VwZGF0ZSB7XHJcbiAgb3JkZXJJZDogc3RyaW5nO1xyXG4gIG9sZFN0YXR1czogT3JkZXJTdGF0dXM7XHJcbiAgbmV3U3RhdHVzOiBPcmRlclN0YXR1cztcclxuICB0aW1lc3RhbXA6IERhdGU7XHJcbiAgZmlsbGVkQW1vdW50Pzogc3RyaW5nO1xyXG4gIHJlbWFpbmluZ0Ftb3VudD86IHN0cmluZztcclxuICBhdmVyYWdlUHJpY2U/OiBzdHJpbmc7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBQb3NpdGlvbiBzdW1tYXJ5XHJcbiAqL1xyXG5pbnRlcmZhY2UgUG9zaXRpb25TdW1tYXJ5IHtcclxuICBzeW1ib2w6IHN0cmluZztcclxuICBzaWRlOiAnbG9uZycgfCAnc2hvcnQnIHwgJ25ldXRyYWwnO1xyXG4gIHRvdGFsQW1vdW50OiBudW1iZXI7XHJcbiAgYXZlcmFnZVByaWNlOiBudW1iZXI7XHJcbiAgdW5yZWFsaXplZFBuTDogbnVtYmVyO1xyXG4gIHJlYWxpemVkUG5MOiBudW1iZXI7XHJcbiAgb3Blbk9yZGVyczogT3JkZXJSZXNwb25zZVtdO1xyXG4gIGxhc3RVcGRhdGU6IERhdGU7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBPcmRlciBtYW5hZ2VtZW50IHN0YXRpc3RpY3NcclxuICovXHJcbmludGVyZmFjZSBPcmRlck1hbmFnZW1lbnRTdGF0cyB7XHJcbiAgdG90YWxPcmRlcnM6IG51bWJlcjtcclxuICBzdWNjZXNzZnVsT3JkZXJzOiBudW1iZXI7XHJcbiAgZmFpbGVkT3JkZXJzOiBudW1iZXI7XHJcbiAgY2FuY2VsbGVkT3JkZXJzOiBudW1iZXI7XHJcbiAgdG90YWxWb2x1bWU6IG51bWJlcjtcclxuICB0b3RhbEZlZXM6IG51bWJlcjtcclxuICBhdmVyYWdlRXhlY3V0aW9uVGltZTogbnVtYmVyO1xyXG4gIHN1Y2Nlc3NSYXRlOiBudW1iZXI7XHJcbiAgbGFzdE9yZGVyVGltZTogRGF0ZSB8IG51bGw7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBPcmRlciBleGVjdXRpb24gY29uZmlndXJhdGlvblxyXG4gKi9cclxuaW50ZXJmYWNlIE9yZGVyRXhlY3V0aW9uQ29uZmlnIHtcclxuICBlbmFibGVQcmVWYWxpZGF0aW9uOiBib29sZWFuO1xyXG4gIGVuYWJsZVBvc3RWYWxpZGF0aW9uOiBib29sZWFuO1xyXG4gIG1heE9yZGVyVmFsdWU6IG51bWJlcjtcclxuICBtYXhEYWlseVZvbHVtZTogbnVtYmVyO1xyXG4gIGVuYWJsZVJpc2tDaGVja3M6IGJvb2xlYW47XHJcbiAgY29uZmlybWF0aW9uUmVxdWlyZWQ6IGJvb2xlYW47XHJcbiAgZXhlY3V0aW9uVGltZW91dDogbnVtYmVyO1xyXG59XHJcblxyXG4vKipcclxuICogT3JkZXIgTWFuYWdlbWVudCBhbmQgRXhlY3V0aW9uIFN5c3RlbVxyXG4gKiBIYW5kbGVzIGFsbCBvcmRlciBsaWZlY3ljbGUgb3BlcmF0aW9ucyB3aXRoIGNvbXByZWhlbnNpdmUgdmFsaWRhdGlvbiBhbmQgbW9uaXRvcmluZ1xyXG4gKi9cclxuZXhwb3J0IGNsYXNzIE9yZGVyTWFuYWdlciBleHRlbmRzIEV2ZW50RW1pdHRlciB7XHJcbiAgcHJpdmF0ZSBnYXRlSU9DbGllbnQ6IEdhdGVJT0NsaWVudDtcclxuICBwcml2YXRlIGF1ZGl0U2VydmljZTogQXVkaXRTZXJ2aWNlO1xyXG4gIHByaXZhdGUgYWN0aXZlT3JkZXJzOiBNYXA8c3RyaW5nLCBPcmRlclJlc3BvbnNlPiA9IG5ldyBNYXAoKTtcclxuICBwcml2YXRlIG9yZGVySGlzdG9yeTogT3JkZXJSZXNwb25zZVtdID0gW107XHJcbiAgcHJpdmF0ZSBwb3NpdGlvbnM6IE1hcDxzdHJpbmcsIFBvc2l0aW9uU3VtbWFyeT4gPSBuZXcgTWFwKCk7XHJcbiAgcHJpdmF0ZSBzdGF0czogT3JkZXJNYW5hZ2VtZW50U3RhdHM7XHJcbiAgcHJpdmF0ZSBjb25maWc6IE9yZGVyRXhlY3V0aW9uQ29uZmlnO1xyXG4gIFxyXG4gIC8vIE1vbml0b3JpbmcgYW5kIHZhbGlkYXRpb25cclxuICBwcml2YXRlIHN0YXR1c01vbml0b3JJbnRlcnZhbDogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcclxuICBwcml2YXRlIHJlYWRvbmx5IHN0YXR1c0NoZWNrSW50ZXJ2YWw6IG51bWJlciA9IDUwMDA7IC8vIDUgc2Vjb25kc1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgbWF4T3JkZXJBZ2U6IG51bWJlciA9IDg2NDAwMDAwOyAvLyAyNCBob3VycyBpbiBtaWxsaXNlY29uZHNcclxuXHJcbiAgY29uc3RydWN0b3IoZ2F0ZUlPQ2xpZW50OiBHYXRlSU9DbGllbnQpIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgICBcclxuICAgIHRoaXMuZ2F0ZUlPQ2xpZW50ID0gZ2F0ZUlPQ2xpZW50O1xyXG4gICAgdGhpcy5hdWRpdFNlcnZpY2UgPSBuZXcgQXVkaXRTZXJ2aWNlKCk7XHJcbiAgICBcclxuICAgIC8vIEluaXRpYWxpemUgc3RhdGlzdGljc1xyXG4gICAgdGhpcy5zdGF0cyA9IHtcclxuICAgICAgdG90YWxPcmRlcnM6IDAsXHJcbiAgICAgIHN1Y2Nlc3NmdWxPcmRlcnM6IDAsXHJcbiAgICAgIGZhaWxlZE9yZGVyczogMCxcclxuICAgICAgY2FuY2VsbGVkT3JkZXJzOiAwLFxyXG4gICAgICB0b3RhbFZvbHVtZTogMCxcclxuICAgICAgdG90YWxGZWVzOiAwLFxyXG4gICAgICBhdmVyYWdlRXhlY3V0aW9uVGltZTogMCxcclxuICAgICAgc3VjY2Vzc1JhdGU6IDAsXHJcbiAgICAgIGxhc3RPcmRlclRpbWU6IG51bGwsXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICAvLyBEZWZhdWx0IGNvbmZpZ3VyYXRpb25cclxuICAgIHRoaXMuY29uZmlnID0ge1xyXG4gICAgICBlbmFibGVQcmVWYWxpZGF0aW9uOiB0cnVlLFxyXG4gICAgICBlbmFibGVQb3N0VmFsaWRhdGlvbjogdHJ1ZSxcclxuICAgICAgbWF4T3JkZXJWYWx1ZTogMTAwMDAsIC8vICQxMCwwMDAgVVNEXHJcbiAgICAgIG1heERhaWx5Vm9sdW1lOiAxMDAwMDAsIC8vICQxMDAsMDAwIFVTRFxyXG4gICAgICBlbmFibGVSaXNrQ2hlY2tzOiB0cnVlLFxyXG4gICAgICBjb25maXJtYXRpb25SZXF1aXJlZDogZmFsc2UsXHJcbiAgICAgIGV4ZWN1dGlvblRpbWVvdXQ6IDMwMDAwLCAvLyAzMCBzZWNvbmRzXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBsb2dnZXIuaW5mbygn8J+SuSBPcmRlciBNYW5hZ2VyIGluaXRpYWxpemVkIHdpdGggY29tcHJlaGVuc2l2ZSB2YWxpZGF0aW9uJyk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBJbml0aWFsaXplIG9yZGVyIG1hbmFnZXIgd2l0aCBjb25maWd1cmF0aW9uXHJcbiAgICogXHJcbiAgICogQHBhcmFtIGNvbmZpZyAtIE9yZGVyIGV4ZWN1dGlvbiBjb25maWd1cmF0aW9uXHJcbiAgICogQHJldHVybnMgUHJvbWlzZTxib29sZWFuPiAtIFN1Y2Nlc3Mgc3RhdHVzXHJcbiAgICovXHJcbiAgcHVibGljIGFzeW5jIGluaXRpYWxpemUoY29uZmlnPzogUGFydGlhbDxPcmRlckV4ZWN1dGlvbkNvbmZpZz4pOiBQcm9taXNlPGJvb2xlYW4+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGxvZ2dlci5pbmZvKCfwn5qAIEluaXRpYWxpemluZyBPcmRlciBNYW5hZ2VyLi4uJyk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBVcGRhdGUgY29uZmlndXJhdGlvblxyXG4gICAgICBpZiAoY29uZmlnKSB7XHJcbiAgICAgICAgdGhpcy5jb25maWcgPSB7IC4uLnRoaXMuY29uZmlnLCAuLi5jb25maWcgfTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gTG9hZCBleGlzdGluZyBvcmRlcnMgZnJvbSBleGNoYW5nZVxyXG4gICAgICBhd2FpdCB0aGlzLmxvYWRFeGlzdGluZ09yZGVycygpO1xyXG4gICAgICBcclxuICAgICAgLy8gU3RhcnQgb3JkZXIgc3RhdHVzIG1vbml0b3JpbmdcclxuICAgICAgdGhpcy5zdGFydE9yZGVyU3RhdHVzTW9uaXRvcmluZygpO1xyXG4gICAgICBcclxuICAgICAgLy8gSW5pdGlhbGl6ZSBwb3NpdGlvbiB0cmFja2luZ1xyXG4gICAgICBhd2FpdCB0aGlzLmluaXRpYWxpemVQb3NpdGlvblRyYWNraW5nKCk7XHJcbiAgICAgIFxyXG4gICAgICBhd2FpdCB0aGlzLmF1ZGl0U2VydmljZS5sb2dTZWN1cml0eUV2ZW50KHtcclxuICAgICAgICB0eXBlOiAnT1JERVJfTUFOQUdFUl9JTklUSUFMSVpFRCcsXHJcbiAgICAgICAgc2V2ZXJpdHk6ICdJTkZPJyxcclxuICAgICAgICBkZXRhaWxzOiB7IGNvbmZpZzogdGhpcy5jb25maWcgfSxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgbG9nZ2VyLmluZm8oJ+KchSBPcmRlciBNYW5hZ2VyIGluaXRpYWxpemVkIHN1Y2Nlc3NmdWxseScpO1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ+KdjCBGYWlsZWQgdG8gaW5pdGlhbGl6ZSBPcmRlciBNYW5hZ2VyOicsIGVycm9yKTtcclxuICAgICAgYXdhaXQgdGhpcy5hdWRpdFNlcnZpY2UubG9nU2VjdXJpdHlFdmVudCh7XHJcbiAgICAgICAgdHlwZTogJ09SREVSX01BTkFHRVJfSU5JVF9GQUlMRUQnLFxyXG4gICAgICAgIHNldmVyaXR5OiAnRVJST1InLFxyXG4gICAgICAgIGRldGFpbHM6IHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXHJcbiAgICAgIH0pO1xyXG4gICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBQbGFjZSBuZXcgb3JkZXIgd2l0aCBjb21wcmVoZW5zaXZlIHZhbGlkYXRpb24gYW5kIGNvbmZpcm1hdGlvblxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBvcmRlclJlcXVlc3QgLSBPcmRlciByZXF1ZXN0IHBhcmFtZXRlcnNcclxuICAgKiBAcmV0dXJucyBQcm9taXNlPE9yZGVyRXhlY3V0aW9uUmVzdWx0PiAtIE9yZGVyIGV4ZWN1dGlvbiByZXN1bHRcclxuICAgKi9cclxuICBwdWJsaWMgYXN5bmMgcGxhY2VPcmRlcihvcmRlclJlcXVlc3Q6IE9yZGVyUmVxdWVzdCk6IFByb21pc2U8T3JkZXJFeGVjdXRpb25SZXN1bHQ+IHtcclxuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XHJcbiAgICBcclxuICAgIHRyeSB7XHJcbiAgICAgIGxvZ2dlci5pbmZvKGDwn5OdIFBsYWNpbmcgJHtvcmRlclJlcXVlc3Quc2lkZX0gb3JkZXIgZm9yICR7b3JkZXJSZXF1ZXN0LmFtb3VudH0gJHtvcmRlclJlcXVlc3QuY3VycmVuY3lfcGFpcn1gKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFByZS12YWxpZGF0aW9uXHJcbiAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSBhd2FpdCB0aGlzLnZhbGlkYXRlT3JkZXIob3JkZXJSZXF1ZXN0KTtcclxuICAgICAgaWYgKCF2YWxpZGF0aW9uUmVzdWx0LmlzVmFsaWQpIHtcclxuICAgICAgICBjb25zdCBlcnJvciA9IGBPcmRlciB2YWxpZGF0aW9uIGZhaWxlZDogJHt2YWxpZGF0aW9uUmVzdWx0LmVycm9ycy5qb2luKCcsICcpfWA7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5sb2dPcmRlckV2ZW50KCdPUkRFUl9WQUxJREFUSU9OX0ZBSUxFRCcsIG9yZGVyUmVxdWVzdCwgeyB2YWxpZGF0aW9uUmVzdWx0IH0pO1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICAgIG9yZGVyOiBudWxsLFxyXG4gICAgICAgICAgZXhlY3V0aW9uVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZSxcclxuICAgICAgICAgIGVycm9yLFxyXG4gICAgICAgICAgdmFsaWRhdGlvblJlc3VsdCxcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBMb2cgdmFsaWRhdGlvbiB3YXJuaW5ncyBpZiBhbnlcclxuICAgICAgaWYgKHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MubGVuZ3RoID4gMCkge1xyXG4gICAgICAgIGxvZ2dlci53YXJuKCfimqDvuI8gT3JkZXIgdmFsaWRhdGlvbiB3YXJuaW5nczonLCB2YWxpZGF0aW9uUmVzdWx0Lndhcm5pbmdzKTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gUmlzayBhc3Nlc3NtZW50XHJcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5lbmFibGVSaXNrQ2hlY2tzKSB7XHJcbiAgICAgICAgY29uc3Qgcmlza0Fzc2Vzc21lbnQgPSBhd2FpdCB0aGlzLmFzc2Vzc09yZGVyUmlzayhvcmRlclJlcXVlc3QsIHZhbGlkYXRpb25SZXN1bHQpO1xyXG4gICAgICAgIGlmIChyaXNrQXNzZXNzbWVudC5yaXNrU2NvcmUgPiA4MCkge1xyXG4gICAgICAgICAgY29uc3QgZXJyb3IgPSBgT3JkZXIgcmlzayBzY29yZSB0b28gaGlnaDogJHtyaXNrQXNzZXNzbWVudC5yaXNrU2NvcmV9LzEwMGA7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLmxvZ09yZGVyRXZlbnQoJ09SREVSX0hJR0hfUklTS19SRUpFQ1RFRCcsIG9yZGVyUmVxdWVzdCwgeyByaXNrQXNzZXNzbWVudCB9KTtcclxuICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICAgICAgICBvcmRlcjogbnVsbCxcclxuICAgICAgICAgICAgZXhlY3V0aW9uVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZSxcclxuICAgICAgICAgICAgZXJyb3IsXHJcbiAgICAgICAgICAgIHZhbGlkYXRpb25SZXN1bHQsXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gRXhlY3V0ZSBvcmRlciB0aHJvdWdoIEdhdGUuaW8gQVBJXHJcbiAgICAgIGNvbnN0IG9yZGVyUmVzcG9uc2UgPSBhd2FpdCB0aGlzLmV4ZWN1dGVPcmRlcihvcmRlclJlcXVlc3QpO1xyXG4gICAgICBcclxuICAgICAgLy8gUG9zdC12YWxpZGF0aW9uXHJcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5lbmFibGVQb3N0VmFsaWRhdGlvbikge1xyXG4gICAgICAgIGNvbnN0IHBvc3RWYWxpZGF0aW9uID0gYXdhaXQgdGhpcy52YWxpZGF0ZU9yZGVyRXhlY3V0aW9uKG9yZGVyUmVxdWVzdCwgb3JkZXJSZXNwb25zZSk7XHJcbiAgICAgICAgaWYgKCFwb3N0VmFsaWRhdGlvbi5pc1ZhbGlkKSB7XHJcbiAgICAgICAgICBsb2dnZXIuZXJyb3IoJ+KdjCBQb3N0LWV4ZWN1dGlvbiB2YWxpZGF0aW9uIGZhaWxlZDonLCBwb3N0VmFsaWRhdGlvbi5lcnJvcnMpO1xyXG4gICAgICAgICAgLy8gQXR0ZW1wdCB0byBjYW5jZWwgdGhlIG9yZGVyIGlmIHZhbGlkYXRpb24gZmFpbHNcclxuICAgICAgICAgIGF3YWl0IHRoaXMuY2FuY2VsT3JkZXIob3JkZXJSZXNwb25zZS5pZCwgJ1Bvc3QtdmFsaWRhdGlvbiBmYWlsdXJlJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBTdG9yZSBvcmRlciBpbiBhY3RpdmUgb3JkZXJzXHJcbiAgICAgIHRoaXMuYWN0aXZlT3JkZXJzLnNldChvcmRlclJlc3BvbnNlLmlkLCBvcmRlclJlc3BvbnNlKTtcclxuICAgICAgdGhpcy5vcmRlckhpc3RvcnkucHVzaChvcmRlclJlc3BvbnNlKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFVwZGF0ZSBzdGF0aXN0aWNzXHJcbiAgICAgIGNvbnN0IGV4ZWN1dGlvblRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xyXG4gICAgICB0aGlzLnVwZGF0ZU9yZGVyU3RhdHModHJ1ZSwgZXhlY3V0aW9uVGltZSwgcGFyc2VGbG9hdChvcmRlclJlcXVlc3QuYW1vdW50KSwgdmFsaWRhdGlvblJlc3VsdC5lc3RpbWF0ZWRGZWVzKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFVwZGF0ZSBwb3NpdGlvbiB0cmFja2luZ1xyXG4gICAgICBhd2FpdCB0aGlzLnVwZGF0ZVBvc2l0aW9uVHJhY2tpbmcob3JkZXJSZXNwb25zZSk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBMb2cgc3VjY2Vzc2Z1bCBvcmRlciBwbGFjZW1lbnRcclxuICAgICAgYXdhaXQgdGhpcy5sb2dPcmRlckV2ZW50KCdPUkRFUl9QTEFDRURfU1VDQ0VTUycsIG9yZGVyUmVxdWVzdCwgeyBcclxuICAgICAgICBvcmRlclJlc3BvbnNlLCBcclxuICAgICAgICBleGVjdXRpb25UaW1lLFxyXG4gICAgICAgIHZhbGlkYXRpb25SZXN1bHQgXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gRW1pdCBvcmRlciBwbGFjZWQgZXZlbnRcclxuICAgICAgdGhpcy5lbWl0KCdvcmRlclBsYWNlZCcsIG9yZGVyUmVzcG9uc2UpO1xyXG4gICAgICBcclxuICAgICAgbG9nZ2VyLmluZm8oYOKchSBPcmRlciBwbGFjZWQgc3VjY2Vzc2Z1bGx5OiAke29yZGVyUmVzcG9uc2UuaWR9ICgke2V4ZWN1dGlvblRpbWV9bXMpYCk7XHJcbiAgICAgIFxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgb3JkZXI6IG9yZGVyUmVzcG9uc2UsXHJcbiAgICAgICAgZXhlY3V0aW9uVGltZSxcclxuICAgICAgICB2YWxpZGF0aW9uUmVzdWx0LFxyXG4gICAgICB9O1xyXG4gICAgICBcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnN0IGV4ZWN1dGlvblRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xyXG4gICAgICBcclxuICAgICAgLy8gVXBkYXRlIHN0YXRpc3RpY3NcclxuICAgICAgdGhpcy51cGRhdGVPcmRlclN0YXRzKGZhbHNlLCBleGVjdXRpb25UaW1lLCAwLCAwKTtcclxuICAgICAgXHJcbiAgICAgIC8vIExvZyBmYWlsZWQgb3JkZXIgcGxhY2VtZW50XHJcbiAgICAgIGF3YWl0IHRoaXMubG9nT3JkZXJFdmVudCgnT1JERVJfUExBQ0VNRU5UX0ZBSUxFRCcsIG9yZGVyUmVxdWVzdCwgeyBcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSxcclxuICAgICAgICBleGVjdXRpb25UaW1lIFxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIGxvZ2dlci5lcnJvcihg4p2MIEZhaWxlZCB0byBwbGFjZSBvcmRlcjogJHtlcnJvci5tZXNzYWdlfWApO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcclxuICAgICAgICBvcmRlcjogbnVsbCxcclxuICAgICAgICBleGVjdXRpb25UaW1lLFxyXG4gICAgICAgIGVycm9yOiBlcnJvci5tZXNzYWdlLFxyXG4gICAgICAgIHZhbGlkYXRpb25SZXN1bHQ6IHtcclxuICAgICAgICAgIGlzVmFsaWQ6IGZhbHNlLFxyXG4gICAgICAgICAgZXJyb3JzOiBbZXJyb3IubWVzc2FnZV0sXHJcbiAgICAgICAgICB3YXJuaW5nczogW10sXHJcbiAgICAgICAgICByaXNrU2NvcmU6IDEwMCxcclxuICAgICAgICAgIGVzdGltYXRlZENvc3Q6IDAsXHJcbiAgICAgICAgICBlc3RpbWF0ZWRGZWVzOiAwLFxyXG4gICAgICAgIH0sXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYW5jZWwgZXhpc3Rpbmcgb3JkZXIgd2l0aCBzYWZldHkgY2hlY2tzXHJcbiAgICogXHJcbiAgICogQHBhcmFtIG9yZGVySWQgLSBPcmRlciBJRCB0byBjYW5jZWxcclxuICAgKiBAcGFyYW0gcmVhc29uIC0gQ2FuY2VsbGF0aW9uIHJlYXNvblxyXG4gICAqIEByZXR1cm5zIFByb21pc2U8Ym9vbGVhbj4gLSBTdWNjZXNzIHN0YXR1c1xyXG4gICAqL1xyXG4gIHB1YmxpYyBhc3luYyBjYW5jZWxPcmRlcihvcmRlcklkOiBzdHJpbmcsIHJlYXNvbjogc3RyaW5nID0gJ1VzZXIgcmVxdWVzdGVkJyk6IFByb21pc2U8Ym9vbGVhbj4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgbG9nZ2VyLmluZm8oYPCfmqsgQ2FuY2VsbGluZyBvcmRlcjogJHtvcmRlcklkfSAocmVhc29uOiAke3JlYXNvbn0pYCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBDaGVjayBpZiBvcmRlciBleGlzdHMgYW5kIGlzIGNhbmNlbGxhYmxlXHJcbiAgICAgIGNvbnN0IG9yZGVyID0gdGhpcy5hY3RpdmVPcmRlcnMuZ2V0KG9yZGVySWQpO1xyXG4gICAgICBpZiAoIW9yZGVyKSB7XHJcbiAgICAgICAgbG9nZ2VyLndhcm4oYOKaoO+4jyBPcmRlciBub3QgZm91bmQgaW4gYWN0aXZlIG9yZGVyczogJHtvcmRlcklkfWApO1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgaWYgKG9yZGVyLnN0YXR1cyA9PT0gJ2Nsb3NlZCcgfHwgb3JkZXIuc3RhdHVzID09PSAnY2FuY2VsbGVkJykge1xyXG4gICAgICAgIGxvZ2dlci53YXJuKGDimqDvuI8gT3JkZXIgYWxyZWFkeSAke29yZGVyLnN0YXR1c306ICR7b3JkZXJJZH1gKTtcclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIC8vIEV4ZWN1dGUgY2FuY2VsbGF0aW9uIHRocm91Z2ggR2F0ZS5pbyBBUElcclxuICAgICAgYXdhaXQgdGhpcy5nYXRlSU9DbGllbnQubWFrZVJlcXVlc3Qoe1xyXG4gICAgICAgIG1ldGhvZDogJ0RFTEVURScsXHJcbiAgICAgICAgdXJsOiBgL3Nwb3Qvb3JkZXJzLyR7b3JkZXJJZH1gLFxyXG4gICAgICAgIGRhdGE6IHsgY3VycmVuY3lfcGFpcjogb3JkZXIuY3VycmVuY3lfcGFpciB9LFxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIFVwZGF0ZSBvcmRlciBzdGF0dXNcclxuICAgICAgY29uc3QgdXBkYXRlZE9yZGVyID0geyAuLi5vcmRlciwgc3RhdHVzOiAnY2FuY2VsbGVkJyBhcyBPcmRlclN0YXR1cyB9O1xyXG4gICAgICB0aGlzLmFjdGl2ZU9yZGVycy5zZXQob3JkZXJJZCwgdXBkYXRlZE9yZGVyKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFVwZGF0ZSBzdGF0aXN0aWNzXHJcbiAgICAgIHRoaXMuc3RhdHMuY2FuY2VsbGVkT3JkZXJzKys7XHJcbiAgICAgIFxyXG4gICAgICAvLyBMb2cgY2FuY2VsbGF0aW9uXHJcbiAgICAgIGF3YWl0IHRoaXMubG9nT3JkZXJFdmVudCgnT1JERVJfQ0FOQ0VMTEVEJywgb3JkZXIsIHsgcmVhc29uIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gRW1pdCBvcmRlciBjYW5jZWxsZWQgZXZlbnRcclxuICAgICAgdGhpcy5lbWl0KCdvcmRlckNhbmNlbGxlZCcsIHVwZGF0ZWRPcmRlciwgcmVhc29uKTtcclxuICAgICAgXHJcbiAgICAgIGxvZ2dlci5pbmZvKGDinIUgT3JkZXIgY2FuY2VsbGVkIHN1Y2Nlc3NmdWxseTogJHtvcmRlcklkfWApO1xyXG4gICAgICByZXR1cm4gdHJ1ZTtcclxuICAgICAgXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoYOKdjCBGYWlsZWQgdG8gY2FuY2VsIG9yZGVyICR7b3JkZXJJZH06YCwgZXJyb3IpO1xyXG4gICAgICBhd2FpdCB0aGlzLmxvZ09yZGVyRXZlbnQoJ09SREVSX0NBTkNFTExBVElPTl9GQUlMRUQnLCB7IG9yZGVySWQgfSwgeyBcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSwgXHJcbiAgICAgICAgcmVhc29uIFxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTW9kaWZ5IGV4aXN0aW5nIG9yZGVyXHJcbiAgICogXHJcbiAgICogQHBhcmFtIG9yZGVySWQgLSBPcmRlciBJRCB0byBtb2RpZnlcclxuICAgKiBAcGFyYW0gbW9kaWZpY2F0aW9ucyAtIE9yZGVyIG1vZGlmaWNhdGlvbnNcclxuICAgKiBAcmV0dXJucyBQcm9taXNlPE9yZGVyUmVzcG9uc2UgfCBudWxsPiAtIE1vZGlmaWVkIG9yZGVyIG9yIG51bGwgaWYgZmFpbGVkXHJcbiAgICovXHJcbiAgcHVibGljIGFzeW5jIG1vZGlmeU9yZGVyKFxyXG4gICAgb3JkZXJJZDogc3RyaW5nLCBcclxuICAgIG1vZGlmaWNhdGlvbnM6IE9yZGVyTW9kaWZ5UmVxdWVzdFxyXG4gICk6IFByb21pc2U8T3JkZXJSZXNwb25zZSB8IG51bGw+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGxvZ2dlci5pbmZvKGDinI/vuI8gTW9kaWZ5aW5nIG9yZGVyOiAke29yZGVySWR9YCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBDaGVjayBpZiBvcmRlciBleGlzdHMgYW5kIGlzIG1vZGlmaWFibGVcclxuICAgICAgY29uc3Qgb3JkZXIgPSB0aGlzLmFjdGl2ZU9yZGVycy5nZXQob3JkZXJJZCk7XHJcbiAgICAgIGlmICghb3JkZXIpIHtcclxuICAgICAgICBsb2dnZXIud2Fybihg4pqg77iPIE9yZGVyIG5vdCBmb3VuZDogJHtvcmRlcklkfWApO1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICBpZiAob3JkZXIuc3RhdHVzICE9PSAnb3BlbicpIHtcclxuICAgICAgICBsb2dnZXIud2Fybihg4pqg77iPIE9yZGVyIG5vdCBtb2RpZmlhYmxlIChzdGF0dXM6ICR7b3JkZXIuc3RhdHVzfSk6ICR7b3JkZXJJZH1gKTtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gVmFsaWRhdGUgbW9kaWZpY2F0aW9uc1xyXG4gICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gYXdhaXQgdGhpcy52YWxpZGF0ZU9yZGVyTW9kaWZpY2F0aW9uKG9yZGVyLCBtb2RpZmljYXRpb25zKTtcclxuICAgICAgaWYgKCF2YWxpZGF0aW9uUmVzdWx0LmlzVmFsaWQpIHtcclxuICAgICAgICBsb2dnZXIuZXJyb3IoJ+KdjCBPcmRlciBtb2RpZmljYXRpb24gdmFsaWRhdGlvbiBmYWlsZWQ6JywgdmFsaWRhdGlvblJlc3VsdC5lcnJvcnMpO1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBFeGVjdXRlIG1vZGlmaWNhdGlvbiB0aHJvdWdoIEdhdGUuaW8gQVBJXHJcbiAgICAgIGNvbnN0IG1vZGlmaWVkT3JkZXIgPSBhd2FpdCB0aGlzLmdhdGVJT0NsaWVudC5tYWtlUmVxdWVzdDxPcmRlclJlc3BvbnNlPih7XHJcbiAgICAgICAgbWV0aG9kOiAnUEFUQ0gnLFxyXG4gICAgICAgIHVybDogYC9zcG90L29yZGVycy8ke29yZGVySWR9YCxcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBjdXJyZW5jeV9wYWlyOiBvcmRlci5jdXJyZW5jeV9wYWlyLFxyXG4gICAgICAgICAgLi4ubW9kaWZpY2F0aW9ucyxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIFVwZGF0ZSBzdG9yZWQgb3JkZXJcclxuICAgICAgdGhpcy5hY3RpdmVPcmRlcnMuc2V0KG9yZGVySWQsIG1vZGlmaWVkT3JkZXIpO1xyXG4gICAgICBcclxuICAgICAgLy8gTG9nIG1vZGlmaWNhdGlvblxyXG4gICAgICBhd2FpdCB0aGlzLmxvZ09yZGVyRXZlbnQoJ09SREVSX01PRElGSUVEJywgb3JkZXIsIHsgXHJcbiAgICAgICAgbW9kaWZpY2F0aW9ucywgXHJcbiAgICAgICAgbW9kaWZpZWRPcmRlcixcclxuICAgICAgICB2YWxpZGF0aW9uUmVzdWx0IFxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIEVtaXQgb3JkZXIgbW9kaWZpZWQgZXZlbnRcclxuICAgICAgdGhpcy5lbWl0KCdvcmRlck1vZGlmaWVkJywgbW9kaWZpZWRPcmRlciwgbW9kaWZpY2F0aW9ucyk7XHJcbiAgICAgIFxyXG4gICAgICBsb2dnZXIuaW5mbyhg4pyFIE9yZGVyIG1vZGlmaWVkIHN1Y2Nlc3NmdWxseTogJHtvcmRlcklkfWApO1xyXG4gICAgICByZXR1cm4gbW9kaWZpZWRPcmRlcjtcclxuICAgICAgXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoYOKdjCBGYWlsZWQgdG8gbW9kaWZ5IG9yZGVyICR7b3JkZXJJZH06YCwgZXJyb3IpO1xyXG4gICAgICBhd2FpdCB0aGlzLmxvZ09yZGVyRXZlbnQoJ09SREVSX01PRElGSUNBVElPTl9GQUlMRUQnLCB7IG9yZGVySWQgfSwgeyBcclxuICAgICAgICBlcnJvcjogZXJyb3IubWVzc2FnZSwgXHJcbiAgICAgICAgbW9kaWZpY2F0aW9ucyBcclxuICAgICAgfSk7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IG9yZGVyIHN0YXR1cyB3aXRoIHJlYWwtdGltZSB1cGRhdGVzXHJcbiAgICogXHJcbiAgICogQHBhcmFtIG9yZGVySWQgLSBPcmRlciBJRFxyXG4gICAqIEByZXR1cm5zIFByb21pc2U8T3JkZXJSZXNwb25zZSB8IG51bGw+IC0gT3JkZXIgZGV0YWlscyBvciBudWxsIGlmIG5vdCBmb3VuZFxyXG4gICAqL1xyXG4gIHB1YmxpYyBhc3luYyBnZXRPcmRlclN0YXR1cyhvcmRlcklkOiBzdHJpbmcpOiBQcm9taXNlPE9yZGVyUmVzcG9uc2UgfCBudWxsPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBGaXJzdCBjaGVjayBsb2NhbCBjYWNoZVxyXG4gICAgICBjb25zdCBjYWNoZWRPcmRlciA9IHRoaXMuYWN0aXZlT3JkZXJzLmdldChvcmRlcklkKTtcclxuICAgICAgXHJcbiAgICAgIC8vIEZldGNoIGxhdGVzdCBzdGF0dXMgZnJvbSBleGNoYW5nZVxyXG4gICAgICBjb25zdCBvcmRlclJlc3BvbnNlID0gYXdhaXQgdGhpcy5nYXRlSU9DbGllbnQubWFrZVJlcXVlc3Q8T3JkZXJSZXNwb25zZT4oe1xyXG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgdXJsOiBgL3Nwb3Qvb3JkZXJzLyR7b3JkZXJJZH1gLFxyXG4gICAgICAgIHBhcmFtczogeyBjdXJyZW5jeV9wYWlyOiBjYWNoZWRPcmRlcj8uY3VycmVuY3lfcGFpciB8fCAnQlRDX1VTRFQnIH0sXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgLy8gVXBkYXRlIGxvY2FsIGNhY2hlXHJcbiAgICAgIGlmIChvcmRlclJlc3BvbnNlKSB7XHJcbiAgICAgICAgdGhpcy5hY3RpdmVPcmRlcnMuc2V0KG9yZGVySWQsIG9yZGVyUmVzcG9uc2UpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIENoZWNrIGZvciBzdGF0dXMgY2hhbmdlc1xyXG4gICAgICAgIGlmIChjYWNoZWRPcmRlciAmJiBjYWNoZWRPcmRlci5zdGF0dXMgIT09IG9yZGVyUmVzcG9uc2Uuc3RhdHVzKSB7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLmhhbmRsZU9yZGVyU3RhdHVzQ2hhbmdlKGNhY2hlZE9yZGVyLCBvcmRlclJlc3BvbnNlKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIHJldHVybiBvcmRlclJlc3BvbnNlO1xyXG4gICAgICBcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcihg4p2MIEZhaWxlZCB0byBnZXQgb3JkZXIgc3RhdHVzICR7b3JkZXJJZH06YCwgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBhbGwgYWN0aXZlIG9yZGVyc1xyXG4gICAqIFxyXG4gICAqIEByZXR1cm5zIEFycmF5IG9mIGFjdGl2ZSBvcmRlcnNcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0QWN0aXZlT3JkZXJzKCk6IE9yZGVyUmVzcG9uc2VbXSB7XHJcbiAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmFjdGl2ZU9yZGVycy52YWx1ZXMoKSkuZmlsdGVyKFxyXG4gICAgICBvcmRlciA9PiBvcmRlci5zdGF0dXMgPT09ICdvcGVuJ1xyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBvcmRlciBoaXN0b3J5XHJcbiAgICogXHJcbiAgICogQHBhcmFtIGxpbWl0IC0gTWF4aW11bSBudW1iZXIgb2Ygb3JkZXJzIHRvIHJldHVyblxyXG4gICAqIEByZXR1cm5zIEFycmF5IG9mIGhpc3RvcmljYWwgb3JkZXJzXHJcbiAgICovXHJcbiAgcHVibGljIGdldE9yZGVySGlzdG9yeShsaW1pdDogbnVtYmVyID0gMTAwKTogT3JkZXJSZXNwb25zZVtdIHtcclxuICAgIHJldHVybiB0aGlzLm9yZGVySGlzdG9yeVxyXG4gICAgICAuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYi5jcmVhdGVfdGltZSkuZ2V0VGltZSgpIC0gbmV3IERhdGUoYS5jcmVhdGVfdGltZSkuZ2V0VGltZSgpKVxyXG4gICAgICAuc2xpY2UoMCwgbGltaXQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHBvc2l0aW9uIHN1bW1hcnkgZm9yIHN5bWJvbFxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBzeW1ib2wgLSBUcmFkaW5nIHN5bWJvbFxyXG4gICAqIEByZXR1cm5zIFBvc2l0aW9uIHN1bW1hcnkgb3IgbnVsbCBpZiBubyBwb3NpdGlvblxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRQb3NpdGlvbihzeW1ib2w6IHN0cmluZyk6IFBvc2l0aW9uU3VtbWFyeSB8IG51bGwge1xyXG4gICAgcmV0dXJuIHRoaXMucG9zaXRpb25zLmdldChzeW1ib2wpIHx8IG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgYWxsIHBvc2l0aW9uc1xyXG4gICAqIFxyXG4gICAqIEByZXR1cm5zIEFycmF5IG9mIGFsbCBwb3NpdGlvbiBzdW1tYXJpZXNcclxuICAgKi9cclxuICBwdWJsaWMgZ2V0QWxsUG9zaXRpb25zKCk6IFBvc2l0aW9uU3VtbWFyeVtdIHtcclxuICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXMucG9zaXRpb25zLnZhbHVlcygpKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEVtZXJnZW5jeSBzdG9wIC0gY2FuY2VsIGFsbCBvcGVuIG9yZGVyc1xyXG4gICAqIFxyXG4gICAqIEBwYXJhbSByZWFzb24gLSBFbWVyZ2VuY3kgc3RvcCByZWFzb25cclxuICAgKiBAcmV0dXJucyBQcm9taXNlPGJvb2xlYW4+IC0gU3VjY2VzcyBzdGF0dXNcclxuICAgKi9cclxuICBwdWJsaWMgYXN5bmMgZW1lcmdlbmN5U3RvcChyZWFzb246IHN0cmluZyA9ICdFbWVyZ2VuY3kgc3RvcCB0cmlnZ2VyZWQnKTogUHJvbWlzZTxib29sZWFuPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBsb2dnZXIud2Fybihg8J+aqCBFTUVSR0VOQ1kgU1RPUDogJHtyZWFzb259YCk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCBhY3RpdmVPcmRlcnMgPSB0aGlzLmdldEFjdGl2ZU9yZGVycygpO1xyXG4gICAgICBjb25zdCBjYW5jZWxsYXRpb25Qcm9taXNlcyA9IGFjdGl2ZU9yZGVycy5tYXAob3JkZXIgPT4gXHJcbiAgICAgICAgdGhpcy5jYW5jZWxPcmRlcihvcmRlci5pZCwgYEVtZXJnZW5jeSBzdG9wOiAke3JlYXNvbn1gKVxyXG4gICAgICApO1xyXG4gICAgICBcclxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChjYW5jZWxsYXRpb25Qcm9taXNlcyk7XHJcbiAgICAgIGNvbnN0IHN1Y2Nlc3NDb3VudCA9IHJlc3VsdHMuZmlsdGVyKHJlc3VsdCA9PiBcclxuICAgICAgICByZXN1bHQuc3RhdHVzID09PSAnZnVsZmlsbGVkJyAmJiByZXN1bHQudmFsdWUgPT09IHRydWVcclxuICAgICAgKS5sZW5ndGg7XHJcbiAgICAgIFxyXG4gICAgICBhd2FpdCB0aGlzLmF1ZGl0U2VydmljZS5sb2dTZWN1cml0eUV2ZW50KHtcclxuICAgICAgICB0eXBlOiAnRU1FUkdFTkNZX1NUT1BfRVhFQ1VURUQnLFxyXG4gICAgICAgIHNldmVyaXR5OiAnQ1JJVElDQUwnLFxyXG4gICAgICAgIGRldGFpbHM6IHsgXHJcbiAgICAgICAgICByZWFzb24sIFxyXG4gICAgICAgICAgdG90YWxPcmRlcnM6IGFjdGl2ZU9yZGVycy5sZW5ndGgsIFxyXG4gICAgICAgICAgY2FuY2VsbGVkT3JkZXJzOiBzdWNjZXNzQ291bnQgXHJcbiAgICAgICAgfSxcclxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXHJcbiAgICAgIH0pO1xyXG4gICAgICBcclxuICAgICAgbG9nZ2VyLndhcm4oYPCfmqggRW1lcmdlbmN5IHN0b3AgY29tcGxldGVkOiAke3N1Y2Nlc3NDb3VudH0vJHthY3RpdmVPcmRlcnMubGVuZ3RofSBvcmRlcnMgY2FuY2VsbGVkYCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBFbWl0IGVtZXJnZW5jeSBzdG9wIGV2ZW50XHJcbiAgICAgIHRoaXMuZW1pdCgnZW1lcmdlbmN5U3RvcCcsIHJlYXNvbiwgc3VjY2Vzc0NvdW50LCBhY3RpdmVPcmRlcnMubGVuZ3RoKTtcclxuICAgICAgXHJcbiAgICAgIHJldHVybiBzdWNjZXNzQ291bnQgPT09IGFjdGl2ZU9yZGVycy5sZW5ndGg7XHJcbiAgICAgIFxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgbG9nZ2VyLmVycm9yKCfinYwgRW1lcmdlbmN5IHN0b3AgZmFpbGVkOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVmFsaWRhdGUgb3JkZXIgYmVmb3JlIHBsYWNlbWVudFxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBvcmRlclJlcXVlc3QgLSBPcmRlciByZXF1ZXN0IHRvIHZhbGlkYXRlXHJcbiAgICogQHJldHVybnMgUHJvbWlzZTxPcmRlclZhbGlkYXRpb25SZXN1bHQ+IC0gVmFsaWRhdGlvbiByZXN1bHRcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIHZhbGlkYXRlT3JkZXIob3JkZXJSZXF1ZXN0OiBPcmRlclJlcXVlc3QpOiBQcm9taXNlPE9yZGVyVmFsaWRhdGlvblJlc3VsdD4ge1xyXG4gICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgY29uc3Qgd2FybmluZ3M6IHN0cmluZ1tdID0gW107XHJcbiAgICBsZXQgcmlza1Njb3JlID0gMDtcclxuICAgIFxyXG4gICAgLy8gVmFsaWRhdGUgcmVxdWlyZWQgZmllbGRzXHJcbiAgICBpZiAoIW9yZGVyUmVxdWVzdC5jdXJyZW5jeV9wYWlyKSB7XHJcbiAgICAgIGVycm9ycy5wdXNoKCdDdXJyZW5jeSBwYWlyIGlzIHJlcXVpcmVkJyk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmICghb3JkZXJSZXF1ZXN0LnNpZGUpIHtcclxuICAgICAgZXJyb3JzLnB1c2goJ09yZGVyIHNpZGUgaXMgcmVxdWlyZWQnKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKCFvcmRlclJlcXVlc3QuYW1vdW50IHx8IHBhcnNlRmxvYXQob3JkZXJSZXF1ZXN0LmFtb3VudCkgPD0gMCkge1xyXG4gICAgICBlcnJvcnMucHVzaCgnT3JkZXIgYW1vdW50IG11c3QgYmUgcG9zaXRpdmUnKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgaWYgKG9yZGVyUmVxdWVzdC50eXBlID09PSAnbGltaXQnICYmICghb3JkZXJSZXF1ZXN0LnByaWNlIHx8IHBhcnNlRmxvYXQob3JkZXJSZXF1ZXN0LnByaWNlKSA8PSAwKSkge1xyXG4gICAgICBlcnJvcnMucHVzaCgnTGltaXQgb3JkZXJzIHJlcXVpcmUgYSBwb3NpdGl2ZSBwcmljZScpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBWYWxpZGF0ZSBvcmRlciBzaXplIGxpbWl0c1xyXG4gICAgY29uc3Qgb3JkZXJWYWx1ZSA9IHBhcnNlRmxvYXQob3JkZXJSZXF1ZXN0LmFtb3VudCkgKiAocGFyc2VGbG9hdChvcmRlclJlcXVlc3QucHJpY2UgfHwgJzAnKSB8fCAxKTtcclxuICAgIGlmIChvcmRlclZhbHVlID4gdGhpcy5jb25maWcubWF4T3JkZXJWYWx1ZSkge1xyXG4gICAgICBlcnJvcnMucHVzaChgT3JkZXIgdmFsdWUgZXhjZWVkcyBtYXhpbXVtOiAke29yZGVyVmFsdWV9ID4gJHt0aGlzLmNvbmZpZy5tYXhPcmRlclZhbHVlfWApO1xyXG4gICAgICByaXNrU2NvcmUgKz0gMzA7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIENoZWNrIGRhaWx5IHZvbHVtZSBsaW1pdHNcclxuICAgIGNvbnN0IHRvZGF5Vm9sdW1lID0gdGhpcy5jYWxjdWxhdGVUb2RheVZvbHVtZSgpO1xyXG4gICAgaWYgKHRvZGF5Vm9sdW1lICsgb3JkZXJWYWx1ZSA+IHRoaXMuY29uZmlnLm1heERhaWx5Vm9sdW1lKSB7XHJcbiAgICAgIHdhcm5pbmdzLnB1c2goYE9yZGVyIHdvdWxkIGV4Y2VlZCBkYWlseSB2b2x1bWUgbGltaXQ6ICR7dG9kYXlWb2x1bWUgKyBvcmRlclZhbHVlfSA+ICR7dGhpcy5jb25maWcubWF4RGFpbHlWb2x1bWV9YCk7XHJcbiAgICAgIHJpc2tTY29yZSArPSAyMDtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gRXN0aW1hdGUgY29zdHMgYW5kIGZlZXNcclxuICAgIGNvbnN0IGVzdGltYXRlZENvc3QgPSBvcmRlclZhbHVlO1xyXG4gICAgY29uc3QgZXN0aW1hdGVkRmVlcyA9IG9yZGVyVmFsdWUgKiAwLjAwMjsgLy8gQXNzdW1lIDAuMiUgZmVlXHJcbiAgICBcclxuICAgIC8vIENoZWNrIGFjY291bnQgYmFsYW5jZSAoc2ltcGxpZmllZClcclxuICAgIHRyeSB7XHJcbiAgICAgIGNvbnN0IGJhbGFuY2VzID0gYXdhaXQgdGhpcy5nYXRlSU9DbGllbnQubWFrZVJlcXVlc3Qoe1xyXG4gICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgdXJsOiAnL3Nwb3QvYWNjb3VudHMnLFxyXG4gICAgICB9KTtcclxuICAgICAgXHJcbiAgICAgIC8vIEFkZCBiYWxhbmNlIHZhbGlkYXRpb24gbG9naWMgaGVyZVxyXG4gICAgICAvLyBUaGlzIGlzIHNpbXBsaWZpZWQgLSBpbiBwcm9kdWN0aW9uLCB5b3UnZCBjaGVjayBzcGVjaWZpYyBjdXJyZW5jeSBiYWxhbmNlc1xyXG4gICAgICBcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHdhcm5pbmdzLnB1c2goJ0NvdWxkIG5vdCB2ZXJpZnkgYWNjb3VudCBiYWxhbmNlJyk7XHJcbiAgICAgIHJpc2tTY29yZSArPSAxMDtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgaXNWYWxpZDogZXJyb3JzLmxlbmd0aCA9PT0gMCxcclxuICAgICAgZXJyb3JzLFxyXG4gICAgICB3YXJuaW5ncyxcclxuICAgICAgcmlza1Njb3JlLFxyXG4gICAgICBlc3RpbWF0ZWRDb3N0LFxyXG4gICAgICBlc3RpbWF0ZWRGZWVzLFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEV4ZWN1dGUgb3JkZXIgdGhyb3VnaCBHYXRlLmlvIEFQSVxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBvcmRlclJlcXVlc3QgLSBPcmRlciByZXF1ZXN0XHJcbiAgICogQHJldHVybnMgUHJvbWlzZTxPcmRlclJlc3BvbnNlPiAtIE9yZGVyIHJlc3BvbnNlXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBleGVjdXRlT3JkZXIob3JkZXJSZXF1ZXN0OiBPcmRlclJlcXVlc3QpOiBQcm9taXNlPE9yZGVyUmVzcG9uc2U+IHtcclxuICAgIGNvbnN0IG9yZGVyUmVzcG9uc2UgPSBhd2FpdCB0aGlzLmdhdGVJT0NsaWVudC5tYWtlUmVxdWVzdDxPcmRlclJlc3BvbnNlPih7XHJcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICB1cmw6ICcvc3BvdC9vcmRlcnMnLFxyXG4gICAgICBkYXRhOiBvcmRlclJlcXVlc3QsXHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgcmV0dXJuIG9yZGVyUmVzcG9uc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBWYWxpZGF0ZSBvcmRlciBleGVjdXRpb25cclxuICAgKiBcclxuICAgKiBAcGFyYW0gb3JkZXJSZXF1ZXN0IC0gT3JpZ2luYWwgb3JkZXIgcmVxdWVzdFxyXG4gICAqIEBwYXJhbSBvcmRlclJlc3BvbnNlIC0gT3JkZXIgcmVzcG9uc2UgZnJvbSBleGNoYW5nZVxyXG4gICAqIEByZXR1cm5zIFByb21pc2U8T3JkZXJWYWxpZGF0aW9uUmVzdWx0PiAtIFZhbGlkYXRpb24gcmVzdWx0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyB2YWxpZGF0ZU9yZGVyRXhlY3V0aW9uKFxyXG4gICAgb3JkZXJSZXF1ZXN0OiBPcmRlclJlcXVlc3QsIFxyXG4gICAgb3JkZXJSZXNwb25zZTogT3JkZXJSZXNwb25zZVxyXG4gICk6IFByb21pc2U8T3JkZXJWYWxpZGF0aW9uUmVzdWx0PiB7XHJcbiAgICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XHJcbiAgICBjb25zdCB3YXJuaW5nczogc3RyaW5nW10gPSBbXTtcclxuICAgIFxyXG4gICAgLy8gVmFsaWRhdGUgcmVzcG9uc2UgbWF0Y2hlcyByZXF1ZXN0XHJcbiAgICBpZiAob3JkZXJSZXNwb25zZS5jdXJyZW5jeV9wYWlyICE9PSBvcmRlclJlcXVlc3QuY3VycmVuY3lfcGFpcikge1xyXG4gICAgICBlcnJvcnMucHVzaCgnQ3VycmVuY3kgcGFpciBtaXNtYXRjaCcpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAob3JkZXJSZXNwb25zZS5zaWRlICE9PSBvcmRlclJlcXVlc3Quc2lkZSkge1xyXG4gICAgICBlcnJvcnMucHVzaCgnT3JkZXIgc2lkZSBtaXNtYXRjaCcpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAob3JkZXJSZXNwb25zZS50eXBlICE9PSBvcmRlclJlcXVlc3QudHlwZSkge1xyXG4gICAgICBlcnJvcnMucHVzaCgnT3JkZXIgdHlwZSBtaXNtYXRjaCcpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAoTWF0aC5hYnMocGFyc2VGbG9hdChvcmRlclJlc3BvbnNlLmFtb3VudCkgLSBwYXJzZUZsb2F0KG9yZGVyUmVxdWVzdC5hbW91bnQpKSA+IDAuMDAwMDEpIHtcclxuICAgICAgZXJyb3JzLnB1c2goJ09yZGVyIGFtb3VudCBtaXNtYXRjaCcpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBWYWxpZGF0ZSBvcmRlciB3YXMgYWNjZXB0ZWRcclxuICAgIGlmICghb3JkZXJSZXNwb25zZS5pZCkge1xyXG4gICAgICBlcnJvcnMucHVzaCgnT3JkZXIgSUQgbm90IHJlY2VpdmVkJyk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmIChvcmRlclJlc3BvbnNlLnN0YXR1cyA9PT0gJ2NhbmNlbGxlZCcgfHwgb3JkZXJSZXNwb25zZS5zdGF0dXMgPT09ICdleHBpcmVkJykge1xyXG4gICAgICB3YXJuaW5ncy5wdXNoKGBPcmRlciBpbW1lZGlhdGVseSAke29yZGVyUmVzcG9uc2Uuc3RhdHVzfWApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBpc1ZhbGlkOiBlcnJvcnMubGVuZ3RoID09PSAwLFxyXG4gICAgICBlcnJvcnMsXHJcbiAgICAgIHdhcm5pbmdzLFxyXG4gICAgICByaXNrU2NvcmU6IGVycm9ycy5sZW5ndGggPiAwID8gMTAwIDogd2FybmluZ3MubGVuZ3RoICogMTAsXHJcbiAgICAgIGVzdGltYXRlZENvc3Q6IDAsXHJcbiAgICAgIGVzdGltYXRlZEZlZXM6IDAsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQXNzZXNzIG9yZGVyIHJpc2tcclxuICAgKiBcclxuICAgKiBAcGFyYW0gb3JkZXJSZXF1ZXN0IC0gT3JkZXIgcmVxdWVzdFxyXG4gICAqIEBwYXJhbSB2YWxpZGF0aW9uUmVzdWx0IC0gVmFsaWRhdGlvbiByZXN1bHRcclxuICAgKiBAcmV0dXJucyBQcm9taXNlPGFueT4gLSBSaXNrIGFzc2Vzc21lbnRcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIGFzc2Vzc09yZGVyUmlzayhcclxuICAgIG9yZGVyUmVxdWVzdDogT3JkZXJSZXF1ZXN0LCBcclxuICAgIHZhbGlkYXRpb25SZXN1bHQ6IE9yZGVyVmFsaWRhdGlvblJlc3VsdFxyXG4gICk6IFByb21pc2U8YW55PiB7XHJcbiAgICAvLyBTaW1wbGlmaWVkIHJpc2sgYXNzZXNzbWVudFxyXG4gICAgLy8gSW4gcHJvZHVjdGlvbiwgdGhpcyB3b3VsZCBpbmNsdWRlIG1vcmUgc29waGlzdGljYXRlZCByaXNrIG1vZGVsc1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgcmlza1Njb3JlOiB2YWxpZGF0aW9uUmVzdWx0LnJpc2tTY29yZSxcclxuICAgICAgZmFjdG9yczogdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncyxcclxuICAgIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBWYWxpZGF0ZSBvcmRlciBtb2RpZmljYXRpb25cclxuICAgKiBcclxuICAgKiBAcGFyYW0gb3JkZXIgLSBPcmlnaW5hbCBvcmRlclxyXG4gICAqIEBwYXJhbSBtb2RpZmljYXRpb25zIC0gUHJvcG9zZWQgbW9kaWZpY2F0aW9uc1xyXG4gICAqIEByZXR1cm5zIFByb21pc2U8T3JkZXJWYWxpZGF0aW9uUmVzdWx0PiAtIFZhbGlkYXRpb24gcmVzdWx0XHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyB2YWxpZGF0ZU9yZGVyTW9kaWZpY2F0aW9uKFxyXG4gICAgb3JkZXI6IE9yZGVyUmVzcG9uc2UsIFxyXG4gICAgbW9kaWZpY2F0aW9uczogT3JkZXJNb2RpZnlSZXF1ZXN0XHJcbiAgKTogUHJvbWlzZTxPcmRlclZhbGlkYXRpb25SZXN1bHQ+IHtcclxuICAgIGNvbnN0IGVycm9yczogc3RyaW5nW10gPSBbXTtcclxuICAgIGNvbnN0IHdhcm5pbmdzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgXHJcbiAgICAvLyBWYWxpZGF0ZSBtb2RpZmljYXRpb24gcGFyYW1ldGVyc1xyXG4gICAgaWYgKG1vZGlmaWNhdGlvbnMucHJpY2UgJiYgcGFyc2VGbG9hdChtb2RpZmljYXRpb25zLnByaWNlKSA8PSAwKSB7XHJcbiAgICAgIGVycm9ycy5wdXNoKCdNb2RpZmllZCBwcmljZSBtdXN0IGJlIHBvc2l0aXZlJyk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGlmIChtb2RpZmljYXRpb25zLmFtb3VudCAmJiBwYXJzZUZsb2F0KG1vZGlmaWNhdGlvbnMuYW1vdW50KSA8PSAwKSB7XHJcbiAgICAgIGVycm9ycy5wdXNoKCdNb2RpZmllZCBhbW91bnQgbXVzdCBiZSBwb3NpdGl2ZScpO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBDaGVjayBpZiBtb2RpZmljYXRpb25zIGFyZSBzaWduaWZpY2FudFxyXG4gICAgaWYgKG1vZGlmaWNhdGlvbnMucHJpY2UgJiYgTWF0aC5hYnMocGFyc2VGbG9hdChtb2RpZmljYXRpb25zLnByaWNlKSAtIHBhcnNlRmxvYXQob3JkZXIucHJpY2UpKSA8IDAuMDEpIHtcclxuICAgICAgd2FybmluZ3MucHVzaCgnUHJpY2UgbW9kaWZpY2F0aW9uIGlzIHZlcnkgc21hbGwnKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgaXNWYWxpZDogZXJyb3JzLmxlbmd0aCA9PT0gMCxcclxuICAgICAgZXJyb3JzLFxyXG4gICAgICB3YXJuaW5ncyxcclxuICAgICAgcmlza1Njb3JlOiBlcnJvcnMubGVuZ3RoICogMjAsXHJcbiAgICAgIGVzdGltYXRlZENvc3Q6IDAsXHJcbiAgICAgIGVzdGltYXRlZEZlZXM6IDAsXHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSGFuZGxlIG9yZGVyIHN0YXR1cyBjaGFuZ2VzXHJcbiAgICogXHJcbiAgICogQHBhcmFtIG9sZE9yZGVyIC0gUHJldmlvdXMgb3JkZXIgc3RhdGVcclxuICAgKiBAcGFyYW0gbmV3T3JkZXIgLSBOZXcgb3JkZXIgc3RhdGVcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIGhhbmRsZU9yZGVyU3RhdHVzQ2hhbmdlKFxyXG4gICAgb2xkT3JkZXI6IE9yZGVyUmVzcG9uc2UsIFxyXG4gICAgbmV3T3JkZXI6IE9yZGVyUmVzcG9uc2VcclxuICApOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnN0IHN0YXR1c1VwZGF0ZTogT3JkZXJTdGF0dXNVcGRhdGUgPSB7XHJcbiAgICAgIG9yZGVySWQ6IG5ld09yZGVyLmlkLFxyXG4gICAgICBvbGRTdGF0dXM6IG9sZE9yZGVyLnN0YXR1cyxcclxuICAgICAgbmV3U3RhdHVzOiBuZXdPcmRlci5zdGF0dXMsXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgICAgZmlsbGVkQW1vdW50OiBuZXdPcmRlci5maWxsZWRfdG90YWwsXHJcbiAgICAgIHJlbWFpbmluZ0Ftb3VudDogbmV3T3JkZXIubGVmdCxcclxuICAgICAgYXZlcmFnZVByaWNlOiBuZXdPcmRlci5wcmljZSxcclxuICAgIH07XHJcbiAgICBcclxuICAgIC8vIExvZyBzdGF0dXMgY2hhbmdlXHJcbiAgICBhd2FpdCB0aGlzLmxvZ09yZGVyRXZlbnQoJ09SREVSX1NUQVRVU19DSEFOR0VEJywgbmV3T3JkZXIsIHsgc3RhdHVzVXBkYXRlIH0pO1xyXG4gICAgXHJcbiAgICAvLyBVcGRhdGUgcG9zaXRpb24gdHJhY2tpbmdcclxuICAgIGF3YWl0IHRoaXMudXBkYXRlUG9zaXRpb25UcmFja2luZyhuZXdPcmRlcik7XHJcbiAgICBcclxuICAgIC8vIEVtaXQgc3RhdHVzIGNoYW5nZSBldmVudFxyXG4gICAgdGhpcy5lbWl0KCdvcmRlclN0YXR1c0NoYW5nZWQnLCBzdGF0dXNVcGRhdGUpO1xyXG4gICAgXHJcbiAgICBsb2dnZXIuaW5mbyhg8J+TiiBPcmRlciBzdGF0dXMgY2hhbmdlZDogJHtzdGF0dXNVcGRhdGUub3JkZXJJZH0gKCR7c3RhdHVzVXBkYXRlLm9sZFN0YXR1c30gLT4gJHtzdGF0dXNVcGRhdGUubmV3U3RhdHVzfSlgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExvYWQgZXhpc3Rpbmcgb3JkZXJzIGZyb20gZXhjaGFuZ2VcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIGxvYWRFeGlzdGluZ09yZGVycygpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIExvYWQgb3BlbiBvcmRlcnMgZm9yIGVhY2ggc3VwcG9ydGVkIHRyYWRpbmcgcGFpclxyXG4gICAgICBjb25zdCBzeW1ib2xzOiBUcmFkaW5nU3ltYm9sW10gPSBbJ0JUQ19VU0RUJywgJ0VUSF9VU0RUJ107XHJcbiAgICAgIFxyXG4gICAgICBmb3IgKGNvbnN0IHN5bWJvbCBvZiBzeW1ib2xzKSB7XHJcbiAgICAgICAgY29uc3Qgb3JkZXJzID0gYXdhaXQgdGhpcy5nYXRlSU9DbGllbnQubWFrZVJlcXVlc3Q8T3JkZXJSZXNwb25zZVtdPih7XHJcbiAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxyXG4gICAgICAgICAgdXJsOiAnL3Nwb3Qvb3JkZXJzJyxcclxuICAgICAgICAgIHBhcmFtczogeyBcclxuICAgICAgICAgICAgY3VycmVuY3lfcGFpcjogc3ltYm9sLFxyXG4gICAgICAgICAgICBzdGF0dXM6ICdvcGVuJyxcclxuICAgICAgICAgICAgbGltaXQ6IDEwMCBcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU3RvcmUgYWN0aXZlIG9yZGVyc1xyXG4gICAgICAgIG9yZGVycy5mb3JFYWNoKG9yZGVyID0+IHtcclxuICAgICAgICAgIHRoaXMuYWN0aXZlT3JkZXJzLnNldChvcmRlci5pZCwgb3JkZXIpO1xyXG4gICAgICAgICAgdGhpcy5vcmRlckhpc3RvcnkucHVzaChvcmRlcik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgICAgXHJcbiAgICAgIGxvZ2dlci5pbmZvKGDwn5OLIExvYWRlZCAke3RoaXMuYWN0aXZlT3JkZXJzLnNpemV9IGV4aXN0aW5nIG9yZGVyc2ApO1xyXG4gICAgICBcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGxvZ2dlci5lcnJvcign4p2MIEZhaWxlZCB0byBsb2FkIGV4aXN0aW5nIG9yZGVyczonLCBlcnJvcik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTdGFydCBvcmRlciBzdGF0dXMgbW9uaXRvcmluZ1xyXG4gICAqL1xyXG4gIHByaXZhdGUgc3RhcnRPcmRlclN0YXR1c01vbml0b3JpbmcoKTogdm9pZCB7XHJcbiAgICB0aGlzLnN0YXR1c01vbml0b3JJbnRlcnZhbCA9IHNldEludGVydmFsKGFzeW5jICgpID0+IHtcclxuICAgICAgYXdhaXQgdGhpcy5tb25pdG9yT3JkZXJTdGF0dXNlcygpO1xyXG4gICAgfSwgdGhpcy5zdGF0dXNDaGVja0ludGVydmFsKTtcclxuICAgIFxyXG4gICAgbG9nZ2VyLmluZm8oJ/CfkYHvuI8gU3RhcnRlZCBvcmRlciBzdGF0dXMgbW9uaXRvcmluZycpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogTW9uaXRvciBvcmRlciBzdGF0dXNlc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgbW9uaXRvck9yZGVyU3RhdHVzZXMoKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCBhY3RpdmVPcmRlcnMgPSB0aGlzLmdldEFjdGl2ZU9yZGVycygpO1xyXG4gICAgXHJcbiAgICBmb3IgKGNvbnN0IG9yZGVyIG9mIGFjdGl2ZU9yZGVycykge1xyXG4gICAgICB0cnkge1xyXG4gICAgICAgIGF3YWl0IHRoaXMuZ2V0T3JkZXJTdGF0dXMob3JkZXIuaWQpO1xyXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgIGxvZ2dlci5lcnJvcihg4p2MIEZhaWxlZCB0byBtb25pdG9yIG9yZGVyICR7b3JkZXIuaWR9OmAsIGVycm9yKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBDbGVhbiB1cCBvbGQgb3JkZXJzXHJcbiAgICBhd2FpdCB0aGlzLmNsZWFudXBPbGRPcmRlcnMoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEluaXRpYWxpemUgcG9zaXRpb24gdHJhY2tpbmdcclxuICAgKi9cclxuICBwcml2YXRlIGFzeW5jIGluaXRpYWxpemVQb3NpdGlvblRyYWNraW5nKCk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gSW5pdGlhbGl6ZSBwb3NpdGlvbnMgZm9yIHN1cHBvcnRlZCBzeW1ib2xzXHJcbiAgICAgIGNvbnN0IHN5bWJvbHM6IFRyYWRpbmdTeW1ib2xbXSA9IFsnQlRDX1VTRFQnLCAnRVRIX1VTRFQnXTtcclxuICAgICAgXHJcbiAgICAgIGZvciAoY29uc3Qgc3ltYm9sIG9mIHN5bWJvbHMpIHtcclxuICAgICAgICB0aGlzLnBvc2l0aW9ucy5zZXQoc3ltYm9sLCB7XHJcbiAgICAgICAgICBzeW1ib2wsXHJcbiAgICAgICAgICBzaWRlOiAnbmV1dHJhbCcsXHJcbiAgICAgICAgICB0b3RhbEFtb3VudDogMCxcclxuICAgICAgICAgIGF2ZXJhZ2VQcmljZTogMCxcclxuICAgICAgICAgIHVucmVhbGl6ZWRQbkw6IDAsXHJcbiAgICAgICAgICByZWFsaXplZFBuTDogMCxcclxuICAgICAgICAgIG9wZW5PcmRlcnM6IFtdLFxyXG4gICAgICAgICAgbGFzdFVwZGF0ZTogbmV3IERhdGUoKSxcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgbG9nZ2VyLmluZm8oJ/Cfk4ogUG9zaXRpb24gdHJhY2tpbmcgaW5pdGlhbGl6ZWQnKTtcclxuICAgICAgXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ+KdjCBGYWlsZWQgdG8gaW5pdGlhbGl6ZSBwb3NpdGlvbiB0cmFja2luZzonLCBlcnJvcik7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBVcGRhdGUgcG9zaXRpb24gdHJhY2tpbmdcclxuICAgKiBcclxuICAgKiBAcGFyYW0gb3JkZXIgLSBPcmRlciB0byB1cGRhdGUgcG9zaXRpb24gd2l0aFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgdXBkYXRlUG9zaXRpb25UcmFja2luZyhvcmRlcjogT3JkZXJSZXNwb25zZSk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgY29uc3QgcG9zaXRpb24gPSB0aGlzLnBvc2l0aW9ucy5nZXQob3JkZXIuY3VycmVuY3lfcGFpcik7XHJcbiAgICAgIGlmICghcG9zaXRpb24pIHJldHVybjtcclxuICAgICAgXHJcbiAgICAgIC8vIFVwZGF0ZSBwb3NpdGlvbiBiYXNlZCBvbiBvcmRlciBzdGF0dXNcclxuICAgICAgaWYgKG9yZGVyLnN0YXR1cyA9PT0gJ2Nsb3NlZCcpIHtcclxuICAgICAgICBjb25zdCBmaWxsZWRBbW91bnQgPSBwYXJzZUZsb2F0KG9yZGVyLmZpbGxlZF90b3RhbCk7XHJcbiAgICAgICAgY29uc3QgcHJpY2UgPSBwYXJzZUZsb2F0KG9yZGVyLnByaWNlKTtcclxuICAgICAgICBcclxuICAgICAgICBpZiAob3JkZXIuc2lkZSA9PT0gJ2J1eScpIHtcclxuICAgICAgICAgIHBvc2l0aW9uLnRvdGFsQW1vdW50ICs9IGZpbGxlZEFtb3VudDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgcG9zaXRpb24udG90YWxBbW91bnQgLT0gZmlsbGVkQW1vdW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICAvLyBSZWNhbGN1bGF0ZSBhdmVyYWdlIHByaWNlIChzaW1wbGlmaWVkKVxyXG4gICAgICAgIGlmIChwb3NpdGlvbi50b3RhbEFtb3VudCA+IDApIHtcclxuICAgICAgICAgIHBvc2l0aW9uLmF2ZXJhZ2VQcmljZSA9IHByaWNlOyAvLyBTaW1wbGlmaWVkIGNhbGN1bGF0aW9uXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBVcGRhdGUgb3BlbiBvcmRlcnNcclxuICAgICAgcG9zaXRpb24ub3Blbk9yZGVycyA9IHRoaXMuZ2V0QWN0aXZlT3JkZXJzKCkuZmlsdGVyKFxyXG4gICAgICAgIG8gPT4gby5jdXJyZW5jeV9wYWlyID09PSBvcmRlci5jdXJyZW5jeV9wYWlyXHJcbiAgICAgICk7XHJcbiAgICAgIFxyXG4gICAgICBwb3NpdGlvbi5sYXN0VXBkYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBsb2dnZXIuZXJyb3IoJ+KdjCBGYWlsZWQgdG8gdXBkYXRlIHBvc2l0aW9uIHRyYWNraW5nOicsIGVycm9yKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENhbGN1bGF0ZSB0b2RheSdzIHRyYWRpbmcgdm9sdW1lXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjYWxjdWxhdGVUb2RheVZvbHVtZSgpOiBudW1iZXIge1xyXG4gICAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpO1xyXG4gICAgdG9kYXkuc2V0SG91cnMoMCwgMCwgMCwgMCk7XHJcbiAgICBcclxuICAgIHJldHVybiB0aGlzLm9yZGVySGlzdG9yeVxyXG4gICAgICAuZmlsdGVyKG9yZGVyID0+IG5ldyBEYXRlKG9yZGVyLmNyZWF0ZV90aW1lKSA+PSB0b2RheSlcclxuICAgICAgLnJlZHVjZSgodG90YWwsIG9yZGVyKSA9PiB7XHJcbiAgICAgICAgY29uc3Qgdm9sdW1lID0gcGFyc2VGbG9hdChvcmRlci5hbW91bnQpICogcGFyc2VGbG9hdChvcmRlci5wcmljZSk7XHJcbiAgICAgICAgcmV0dXJuIHRvdGFsICsgdm9sdW1lO1xyXG4gICAgICB9LCAwKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZSBvcmRlciBzdGF0aXN0aWNzXHJcbiAgICogXHJcbiAgICogQHBhcmFtIHN1Y2Nlc3MgLSBPcmRlciBzdWNjZXNzIHN0YXR1c1xyXG4gICAqIEBwYXJhbSBleGVjdXRpb25UaW1lIC0gRXhlY3V0aW9uIHRpbWUgaW4gbWlsbGlzZWNvbmRzXHJcbiAgICogQHBhcmFtIHZvbHVtZSAtIE9yZGVyIHZvbHVtZVxyXG4gICAqIEBwYXJhbSBmZWVzIC0gT3JkZXIgZmVlc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgdXBkYXRlT3JkZXJTdGF0cyhcclxuICAgIHN1Y2Nlc3M6IGJvb2xlYW4sIFxyXG4gICAgZXhlY3V0aW9uVGltZTogbnVtYmVyLCBcclxuICAgIHZvbHVtZTogbnVtYmVyLCBcclxuICAgIGZlZXM6IG51bWJlclxyXG4gICk6IHZvaWQge1xyXG4gICAgdGhpcy5zdGF0cy50b3RhbE9yZGVycysrO1xyXG4gICAgdGhpcy5zdGF0cy5sYXN0T3JkZXJUaW1lID0gbmV3IERhdGUoKTtcclxuICAgIFxyXG4gICAgaWYgKHN1Y2Nlc3MpIHtcclxuICAgICAgdGhpcy5zdGF0cy5zdWNjZXNzZnVsT3JkZXJzKys7XHJcbiAgICAgIHRoaXMuc3RhdHMudG90YWxWb2x1bWUgKz0gdm9sdW1lO1xyXG4gICAgICB0aGlzLnN0YXRzLnRvdGFsRmVlcyArPSBmZWVzO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5zdGF0cy5mYWlsZWRPcmRlcnMrKztcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gVXBkYXRlIGF2ZXJhZ2UgZXhlY3V0aW9uIHRpbWVcclxuICAgIGNvbnN0IGFscGhhID0gMC4xO1xyXG4gICAgdGhpcy5zdGF0cy5hdmVyYWdlRXhlY3V0aW9uVGltZSA9IFxyXG4gICAgICAoYWxwaGEgKiBleGVjdXRpb25UaW1lKSArICgoMSAtIGFscGhhKSAqIHRoaXMuc3RhdHMuYXZlcmFnZUV4ZWN1dGlvblRpbWUpO1xyXG4gICAgXHJcbiAgICAvLyBVcGRhdGUgc3VjY2VzcyByYXRlXHJcbiAgICB0aGlzLnN0YXRzLnN1Y2Nlc3NSYXRlID0gKHRoaXMuc3RhdHMuc3VjY2Vzc2Z1bE9yZGVycyAvIHRoaXMuc3RhdHMudG90YWxPcmRlcnMpICogMTAwO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2xlYW4gdXAgb2xkIG9yZGVycyBmcm9tIG1lbW9yeVxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgY2xlYW51cE9sZE9yZGVycygpOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIGNvbnN0IGN1dG9mZlRpbWUgPSBEYXRlLm5vdygpIC0gdGhpcy5tYXhPcmRlckFnZTtcclxuICAgIFxyXG4gICAgLy8gUmVtb3ZlIG9sZCBvcmRlcnMgZnJvbSBhY3RpdmUgb3JkZXJzIG1hcFxyXG4gICAgZm9yIChjb25zdCBbb3JkZXJJZCwgb3JkZXJdIG9mIHRoaXMuYWN0aXZlT3JkZXJzLmVudHJpZXMoKSkge1xyXG4gICAgICBjb25zdCBvcmRlclRpbWUgPSBuZXcgRGF0ZShvcmRlci5jcmVhdGVfdGltZSkuZ2V0VGltZSgpO1xyXG4gICAgICBpZiAob3JkZXJUaW1lIDwgY3V0b2ZmVGltZSAmJiAob3JkZXIuc3RhdHVzID09PSAnY2xvc2VkJyB8fCBvcmRlci5zdGF0dXMgPT09ICdjYW5jZWxsZWQnKSkge1xyXG4gICAgICAgIHRoaXMuYWN0aXZlT3JkZXJzLmRlbGV0ZShvcmRlcklkKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBMaW1pdCBvcmRlciBoaXN0b3J5IHNpemVcclxuICAgIGlmICh0aGlzLm9yZGVySGlzdG9yeS5sZW5ndGggPiAxMDAwKSB7XHJcbiAgICAgIHRoaXMub3JkZXJIaXN0b3J5ID0gdGhpcy5vcmRlckhpc3RvcnlcclxuICAgICAgICAuc29ydCgoYSwgYikgPT4gbmV3IERhdGUoYi5jcmVhdGVfdGltZSkuZ2V0VGltZSgpIC0gbmV3IERhdGUoYS5jcmVhdGVfdGltZSkuZ2V0VGltZSgpKVxyXG4gICAgICAgIC5zbGljZSgwLCAxMDAwKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIExvZyBvcmRlciBldmVudCBmb3IgYXVkaXQgdHJhaWxcclxuICAgKiBcclxuICAgKiBAcGFyYW0gZXZlbnRUeXBlIC0gRXZlbnQgdHlwZVxyXG4gICAqIEBwYXJhbSBvcmRlckRhdGEgLSBPcmRlciBkYXRhXHJcbiAgICogQHBhcmFtIGFkZGl0aW9uYWxEYXRhIC0gQWRkaXRpb25hbCBldmVudCBkYXRhXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBsb2dPcmRlckV2ZW50KFxyXG4gICAgZXZlbnRUeXBlOiBzdHJpbmcsIFxyXG4gICAgb3JkZXJEYXRhOiBhbnksIFxyXG4gICAgYWRkaXRpb25hbERhdGE6IGFueSA9IHt9XHJcbiAgKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBhd2FpdCB0aGlzLmF1ZGl0U2VydmljZS5sb2dTZWN1cml0eUV2ZW50KHtcclxuICAgICAgdHlwZTogZXZlbnRUeXBlLFxyXG4gICAgICBzZXZlcml0eTogJ0lORk8nLFxyXG4gICAgICBkZXRhaWxzOiB7XHJcbiAgICAgICAgb3JkZXJEYXRhOiB0aGlzLnNhbml0aXplT3JkZXJEYXRhKG9yZGVyRGF0YSksXHJcbiAgICAgICAgLi4uYWRkaXRpb25hbERhdGEsXHJcbiAgICAgIH0sXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU2FuaXRpemUgb3JkZXIgZGF0YSBmb3IgbG9nZ2luZ1xyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBvcmRlckRhdGEgLSBPcmRlciBkYXRhIHRvIHNhbml0aXplXHJcbiAgICogQHJldHVybnMgU2FuaXRpemVkIG9yZGVyIGRhdGFcclxuICAgKi9cclxuICBwcml2YXRlIHNhbml0aXplT3JkZXJEYXRhKG9yZGVyRGF0YTogYW55KTogYW55IHtcclxuICAgIC8vIFJlbW92ZSBzZW5zaXRpdmUgaW5mb3JtYXRpb24gZnJvbSBsb2dzXHJcbiAgICBjb25zdCBzYW5pdGl6ZWQgPSB7IC4uLm9yZGVyRGF0YSB9O1xyXG4gICAgXHJcbiAgICAvLyBLZWVwIG9ubHkgZXNzZW50aWFsIG9yZGVyIGluZm9ybWF0aW9uXHJcbiAgICBpZiAoc2FuaXRpemVkLnRleHQpIHtcclxuICAgICAgZGVsZXRlIHNhbml0aXplZC50ZXh0OyAvLyBNYXkgY29udGFpbiBzZW5zaXRpdmUgaW5mb1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICByZXR1cm4gc2FuaXRpemVkO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IG9yZGVyIG1hbmFnZW1lbnQgc3RhdGlzdGljc1xyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRPcmRlclN0YXRzKCk6IE9yZGVyTWFuYWdlbWVudFN0YXRzIHtcclxuICAgIHJldHVybiB7IC4uLnRoaXMuc3RhdHMgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCBvcmRlciBleGVjdXRpb24gY29uZmlndXJhdGlvblxyXG4gICAqL1xyXG4gIHB1YmxpYyBnZXRDb25maWcoKTogT3JkZXJFeGVjdXRpb25Db25maWcge1xyXG4gICAgcmV0dXJuIHsgLi4udGhpcy5jb25maWcgfTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZSBvcmRlciBleGVjdXRpb24gY29uZmlndXJhdGlvblxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBjb25maWcgLSBOZXcgY29uZmlndXJhdGlvblxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGVDb25maWcoY29uZmlnOiBQYXJ0aWFsPE9yZGVyRXhlY3V0aW9uQ29uZmlnPik6IHZvaWQge1xyXG4gICAgdGhpcy5jb25maWcgPSB7IC4uLnRoaXMuY29uZmlnLCAuLi5jb25maWcgfTtcclxuICAgIGxvZ2dlci5pbmZvKCfimpnvuI8gT3JkZXIgZXhlY3V0aW9uIGNvbmZpZ3VyYXRpb24gdXBkYXRlZCcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR3JhY2VmdWwgc2h1dGRvd25cclxuICAgKi9cclxuICBwdWJsaWMgYXN5bmMgc2h1dGRvd24oKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBsb2dnZXIuaW5mbygn8J+bkSBTaHV0dGluZyBkb3duIE9yZGVyIE1hbmFnZXIuLi4nKTtcclxuICAgIFxyXG4gICAgLy8gU3RvcCBzdGF0dXMgbW9uaXRvcmluZ1xyXG4gICAgaWYgKHRoaXMuc3RhdHVzTW9uaXRvckludGVydmFsKSB7XHJcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5zdGF0dXNNb25pdG9ySW50ZXJ2YWwpO1xyXG4gICAgICB0aGlzLnN0YXR1c01vbml0b3JJbnRlcnZhbCA9IG51bGw7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIExvZyBmaW5hbCBzdGF0aXN0aWNzXHJcbiAgICBhd2FpdCB0aGlzLmF1ZGl0U2VydmljZS5sb2dTZWN1cml0eUV2ZW50KHtcclxuICAgICAgdHlwZTogJ09SREVSX01BTkFHRVJfU0hVVERPV04nLFxyXG4gICAgICBzZXZlcml0eTogJ0lORk8nLFxyXG4gICAgICBkZXRhaWxzOiB7IFxyXG4gICAgICAgIHN0YXRzOiB0aGlzLnN0YXRzLFxyXG4gICAgICAgIGFjdGl2ZU9yZGVyczogdGhpcy5hY3RpdmVPcmRlcnMuc2l6ZSxcclxuICAgICAgICBwb3NpdGlvbnM6IHRoaXMucG9zaXRpb25zLnNpemUgXHJcbiAgICAgIH0sXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBsb2dnZXIuaW5mbygn4pyFIE9yZGVyIE1hbmFnZXIgc2h1dGRvd24gY29tcGxldGVkJyk7XHJcbiAgfVxyXG59XHJcblxyXG4vLyBFeHBvcnQgdHlwZXNcclxuZXhwb3J0IHR5cGUge1xyXG4gIE9yZGVyVmFsaWRhdGlvblJlc3VsdCxcclxuICBPcmRlckV4ZWN1dGlvblJlc3VsdCxcclxuICBPcmRlclN0YXR1c1VwZGF0ZSxcclxuICBQb3NpdGlvblN1bW1hcnksXHJcbiAgT3JkZXJNYW5hZ2VtZW50U3RhdHMsXHJcbiAgT3JkZXJFeGVjdXRpb25Db25maWcsXHJcbn07Il0sInZlcnNpb24iOjN9