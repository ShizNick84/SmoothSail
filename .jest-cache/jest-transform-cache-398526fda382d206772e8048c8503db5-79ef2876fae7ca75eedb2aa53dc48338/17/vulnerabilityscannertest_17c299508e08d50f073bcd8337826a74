f1c4afba79657406fff84ad2f354ac2b
"use strict";
/**
 * Vulnerability Scanner Tests
 *
 * Automated vulnerability scanning and security assessment tests
 * for the AI crypto trading system.
 *
 * Requirements: 25.7 - Vulnerability scanning and assessment
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock external dependencies
jest.mock('@/core/logging/logger', () => ({
    logger: {
        info: jest.fn(),
        debug: jest.fn(),
        warn: jest.fn(),
        error: jest.fn()
    }
}));
jest.mock('fs');
jest.mock('path');
const security_manager_1 = require("@/security/security-manager");
const threat_detection_engine_1 = require("@/security/threat-detection-engine");
const crypto_1 = __importDefault(require("crypto"));
const fs_1 = __importDefault(require("fs"));
const path_1 = __importDefault(require("path"));
const mockedFs = fs_1.default;
const mockedPath = path_1.default;
describe('Vulnerability Scanner Tests', () => {
    let securityManager;
    let threatDetection;
    beforeEach(() => {
        // Set up test environment
        process.env.MASTER_ENCRYPTION_KEY = crypto_1.default.randomBytes(32).toString('hex');
        securityManager = new security_manager_1.SecurityManager();
        threatDetection = new threat_detection_engine_1.ThreatDetectionEngine();
        jest.clearAllMocks();
    });
    afterEach(() => {
        delete process.env.MASTER_ENCRYPTION_KEY;
    });
    describe('Code Vulnerability Scanning', () => {
        it('should detect hardcoded secrets in code', async () => {
            const codeSnippets = [
                // API Keys
                'const apiKey = "gateio_api_key_12345";',
                'GATE_IO_SECRET = "super_secret_key_67890"',
                'const password = "weak123";'
            ];
            // Mock vulnerability scanning
            const vulnerabilities = await threatDetection.scanCodeVulnerabilities(codeSnippets);
            expect(vulnerabilities).toBeDefined();
            expect(vulnerabilities.length).toBeGreaterThan(0);
            expect(vulnerabilities.some(v => v.type === 'HARDCODED_SECRET')).toBe(true);
        });
        it('should detect SQL injection vulnerabilities', async () => {
            const sqlQueries = [
                'SELECT * FROM users WHERE id = ' + userId,
                'DELETE FROM orders WHERE user_id = "' + userInput + '"'
            ];
            const vulnerabilities = await threatDetection.scanSQLInjection(sqlQueries);
            expect(vulnerabilities).toBeDefined();
            expect(vulnerabilities.length).toBeGreaterThan(0);
        });
    });
    describe('Dependency Vulnerability Scanning', () => {
        it('should scan package.json for vulnerable dependencies', async () => {
            const mockPackageJson = {
                dependencies: {
                    'vulnerable-package': '1.0.0',
                    'safe-package': '2.0.0'
                }
            };
            mockedFs.readFileSync.mockReturnValue(JSON.stringify(mockPackageJson));
            const vulnerabilities = await securityManager.scanDependencies();
            expect(vulnerabilities).toBeDefined();
            expect(Array.isArray(vulnerabilities)).toBe(true);
        });
    });
    describe('Network Vulnerability Scanning', () => {
        it('should scan for open ports and services', async () => {
            const networkScan = await securityManager.scanNetwork();
            expect(networkScan).toBeDefined();
            expect(networkScan).toHaveProperty('openPorts');
            expect(networkScan).toHaveProperty('services');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxOaWNrXFxEZXNrdG9wXFxTbW9vdGhTYWlsXFxzcmNcXHRlc3RzXFxzZWN1cml0eVxcdnVsbmVyYWJpbGl0eS1zY2FubmVyLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7O0dBT0c7Ozs7O0FBU0gsNkJBQTZCO0FBQzdCLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN4QyxNQUFNLEVBQUU7UUFDTixJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNmLEtBQUssRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2hCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO1FBQ2YsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDakI7Q0FDRixDQUFDLENBQUMsQ0FBQztBQUVKLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDaEIsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztBQWxCbEIsa0VBQThEO0FBQzlELGdGQUEyRTtBQUUzRSxvREFBNEI7QUFDNUIsNENBQW9CO0FBQ3BCLGdEQUF3QjtBQWV4QixNQUFNLFFBQVEsR0FBRyxZQUE0QixDQUFDO0FBQzlDLE1BQU0sVUFBVSxHQUFHLGNBQWdDLENBQUM7QUFFcEQsUUFBUSxDQUFDLDZCQUE2QixFQUFFLEdBQUcsRUFBRTtJQUMzQyxJQUFJLGVBQWdDLENBQUM7SUFDckMsSUFBSSxlQUFzQyxDQUFDO0lBRTNDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCwwQkFBMEI7UUFDMUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsR0FBRyxnQkFBTSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFM0UsZUFBZSxHQUFHLElBQUksa0NBQWUsRUFBRSxDQUFDO1FBQ3hDLGVBQWUsR0FBRyxJQUFJLCtDQUFxQixFQUFFLENBQUM7UUFFOUMsSUFB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LCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxOaWNrXFxEZXNrdG9wXFxTbW9vdGhTYWlsXFxzcmNcXHRlc3RzXFxzZWN1cml0eVxcdnVsbmVyYWJpbGl0eS1zY2FubmVyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFZ1bG5lcmFiaWxpdHkgU2Nhbm5lciBUZXN0c1xyXG4gKiBcclxuICogQXV0b21hdGVkIHZ1bG5lcmFiaWxpdHkgc2Nhbm5pbmcgYW5kIHNlY3VyaXR5IGFzc2Vzc21lbnQgdGVzdHNcclxuICogZm9yIHRoZSBBSSBjcnlwdG8gdHJhZGluZyBzeXN0ZW0uXHJcbiAqIFxyXG4gKiBSZXF1aXJlbWVudHM6IDI1LjcgLSBWdWxuZXJhYmlsaXR5IHNjYW5uaW5nIGFuZCBhc3Nlc3NtZW50XHJcbiAqL1xyXG5cclxuaW1wb3J0IHsgU2VjdXJpdHlNYW5hZ2VyIH0gZnJvbSAnQC9zZWN1cml0eS9zZWN1cml0eS1tYW5hZ2VyJztcclxuaW1wb3J0IHsgVGhyZWF0RGV0ZWN0aW9uRW5naW5lIH0gZnJvbSAnQC9zZWN1cml0eS90aHJlYXQtZGV0ZWN0aW9uLWVuZ2luZSc7XHJcbmltcG9ydCB7IEVuY3J5cHRpb25TZXJ2aWNlIH0gZnJvbSAnQC9zZWN1cml0eS9lbmNyeXB0aW9uLXNlcnZpY2UnO1xyXG5pbXBvcnQgY3J5cHRvIGZyb20gJ2NyeXB0byc7XHJcbmltcG9ydCBmcyBmcm9tICdmcyc7XHJcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xyXG5cclxuLy8gTW9jayBleHRlcm5hbCBkZXBlbmRlbmNpZXNcclxuamVzdC5tb2NrKCdAL2NvcmUvbG9nZ2luZy9sb2dnZXInLCAoKSA9PiAoe1xyXG4gIGxvZ2dlcjoge1xyXG4gICAgaW5mbzogamVzdC5mbigpLFxyXG4gICAgZGVidWc6IGplc3QuZm4oKSxcclxuICAgIHdhcm46IGplc3QuZm4oKSxcclxuICAgIGVycm9yOiBqZXN0LmZuKClcclxuICB9XHJcbn0pKTtcclxuXHJcbmplc3QubW9jaygnZnMnKTtcclxuamVzdC5tb2NrKCdwYXRoJyk7XHJcblxyXG5jb25zdCBtb2NrZWRGcyA9IGZzIGFzIGplc3QuTW9ja2VkPHR5cGVvZiBmcz47XHJcbmNvbnN0IG1vY2tlZFBhdGggPSBwYXRoIGFzIGplc3QuTW9ja2VkPHR5cGVvZiBwYXRoPjtcclxuXHJcbmRlc2NyaWJlKCdWdWxuZXJhYmlsaXR5IFNjYW5uZXIgVGVzdHMnLCAoKSA9PiB7XHJcbiAgbGV0IHNlY3VyaXR5TWFuYWdlcjogU2VjdXJpdHlNYW5hZ2VyO1xyXG4gIGxldCB0aHJlYXREZXRlY3Rpb246IFRocmVhdERldGVjdGlvbkVuZ2luZTtcclxuXHJcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XHJcbiAgICAvLyBTZXQgdXAgdGVzdCBlbnZpcm9ubWVudFxyXG4gICAgcHJvY2Vzcy5lbnYuTUFTVEVSX0VOQ1JZUFRJT05fS0VZID0gY3J5cHRvLnJhbmRvbUJ5dGVzKDMyKS50b1N0cmluZygnaGV4Jyk7XHJcbiAgICBcclxuICAgIHNlY3VyaXR5TWFuYWdlciA9IG5ldyBTZWN1cml0eU1hbmFnZXIoKTtcclxuICAgIHRocmVhdERldGVjdGlvbiA9IG5ldyBUaHJlYXREZXRlY3Rpb25FbmdpbmUoKTtcclxuICAgIFxyXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbiAgfSk7XHJcblxyXG4gIGFmdGVyRWFjaCgoKSA9PiB7XHJcbiAgICBkZWxldGUgcHJvY2Vzcy5lbnYuTUFTVEVSX0VOQ1JZUFRJT05fS0VZO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnQ29kZSBWdWxuZXJhYmlsaXR5IFNjYW5uaW5nJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBkZXRlY3QgaGFyZGNvZGVkIHNlY3JldHMgaW4gY29kZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgY29kZVNuaXBwZXRzID0gW1xyXG4gICAgICAgIC8vIEFQSSBLZXlzXHJcbiAgICAgICAgJ2NvbnN0IGFwaUtleSA9IFwiZ2F0ZWlvX2FwaV9rZXlfMTIzNDVcIjsnLFxyXG4gICAgICAgICdHQVRFX0lPX1NFQ1JFVCA9IFwic3VwZXJfc2VjcmV0X2tleV82Nzg5MFwiJyxcclxuICAgICAgICAnY29uc3QgcGFzc3dvcmQgPSBcIndlYWsxMjNcIjsnXHJcbiAgICAgIF07XHJcblxyXG4gICAgICAvLyBNb2NrIHZ1bG5lcmFiaWxpdHkgc2Nhbm5pbmdcclxuICAgICAgY29uc3QgdnVsbmVyYWJpbGl0aWVzID0gYXdhaXQgdGhyZWF0RGV0ZWN0aW9uLnNjYW5Db2RlVnVsbmVyYWJpbGl0aWVzKGNvZGVTbmlwcGV0cyk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QodnVsbmVyYWJpbGl0aWVzKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QodnVsbmVyYWJpbGl0aWVzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xyXG4gICAgICBleHBlY3QodnVsbmVyYWJpbGl0aWVzLnNvbWUodiA9PiB2LnR5cGUgPT09ICdIQVJEQ09ERURfU0VDUkVUJykpLnRvQmUodHJ1ZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGRldGVjdCBTUUwgaW5qZWN0aW9uIHZ1bG5lcmFiaWxpdGllcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3Qgc3FsUXVlcmllcyA9IFtcclxuICAgICAgICAnU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSBpZCA9ICcgKyB1c2VySWQsXHJcbiAgICAgICAgJ0RFTEVURSBGUk9NIG9yZGVycyBXSEVSRSB1c2VyX2lkID0gXCInICsgdXNlcklucHV0ICsgJ1wiJ1xyXG4gICAgICBdO1xyXG5cclxuICAgICAgY29uc3QgdnVsbmVyYWJpbGl0aWVzID0gYXdhaXQgdGhyZWF0RGV0ZWN0aW9uLnNjYW5TUUxJbmplY3Rpb24oc3FsUXVlcmllcyk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QodnVsbmVyYWJpbGl0aWVzKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QodnVsbmVyYWJpbGl0aWVzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdEZXBlbmRlbmN5IFZ1bG5lcmFiaWxpdHkgU2Nhbm5pbmcnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHNjYW4gcGFja2FnZS5qc29uIGZvciB2dWxuZXJhYmxlIGRlcGVuZGVuY2llcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbW9ja1BhY2thZ2VKc29uID0ge1xyXG4gICAgICAgIGRlcGVuZGVuY2llczoge1xyXG4gICAgICAgICAgJ3Z1bG5lcmFibGUtcGFja2FnZSc6ICcxLjAuMCcsXHJcbiAgICAgICAgICAnc2FmZS1wYWNrYWdlJzogJzIuMC4wJ1xyXG4gICAgICAgIH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIG1vY2tlZEZzLnJlYWRGaWxlU3luYy5tb2NrUmV0dXJuVmFsdWUoSlNPTi5zdHJpbmdpZnkobW9ja1BhY2thZ2VKc29uKSk7XHJcbiAgICAgIFxyXG4gICAgICBjb25zdCB2dWxuZXJhYmlsaXRpZXMgPSBhd2FpdCBzZWN1cml0eU1hbmFnZXIuc2NhbkRlcGVuZGVuY2llcygpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHZ1bG5lcmFiaWxpdGllcykudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KEFycmF5LmlzQXJyYXkodnVsbmVyYWJpbGl0aWVzKSkudG9CZSh0cnVlKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG5cclxuICBkZXNjcmliZSgnTmV0d29yayBWdWxuZXJhYmlsaXR5IFNjYW5uaW5nJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBzY2FuIGZvciBvcGVuIHBvcnRzIGFuZCBzZXJ2aWNlcycsIGFzeW5jICgpID0+IHtcclxuICAgICAgY29uc3QgbmV0d29ya1NjYW4gPSBhd2FpdCBzZWN1cml0eU1hbmFnZXIuc2Nhbk5ldHdvcmsoKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChuZXR3b3JrU2NhbikudG9CZURlZmluZWQoKTtcclxuICAgICAgZXhwZWN0KG5ldHdvcmtTY2FuKS50b0hhdmVQcm9wZXJ0eSgnb3BlblBvcnRzJyk7XHJcbiAgICAgIGV4cGVjdChuZXR3b3JrU2NhbikudG9IYXZlUHJvcGVydHkoJ3NlcnZpY2VzJyk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7Il0sInZlcnNpb24iOjN9