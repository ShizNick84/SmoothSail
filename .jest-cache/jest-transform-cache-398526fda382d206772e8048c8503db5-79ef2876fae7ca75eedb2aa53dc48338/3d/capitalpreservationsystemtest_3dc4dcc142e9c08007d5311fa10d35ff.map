{"file":"C:\\Users\\Nick\\Desktop\\SmoothSail\\src\\trading\\risk\\__tests__\\capital-preservation-system.test.ts","mappings":";AAAA;;;;GAIG;;AAEH,2CAAiE;AACjE,gFAAoG;AAGpG,IAAA,kBAAQ,EAAC,2BAA2B,EAAE,GAAG,EAAE;IACzC,IAAI,MAAiC,CAAC;IACtC,IAAI,aAAsC,CAAC;IAC3C,IAAI,aAAyB,CAAC;IAE9B,IAAA,oBAAU,EAAC,GAAG,EAAE;QACd,aAAa,GAAG;YACd,oBAAoB,EAAE,EAAE,EAAE,mBAAmB;YAC7C,wBAAwB,EAAE,CAAC,EAAE,aAAa;YAC1C,yBAAyB,EAAE,EAAE,EAAE,eAAe;YAC9C,oBAAoB,EAAE,CAAC;YACvB,2BAA2B,EAAE,GAAG;YAChC,iBAAiB,EAAE,CAAC,EAAE,2BAA2B;YACjD,cAAc,EAAE,CAAC,EAAE,sBAAsB;YACzC,eAAe,EAAE,CAAC,EAAE,uBAAuB;YAC3C,gBAAgB,EAAE,EAAE,CAAC,yBAAyB;SAC/C,CAAC;QAEF,MAAM,GAAG,IAAI,uDAAyB,CAAC,aAAa,CAAC,CAAC;QAEtD,aAAa,GAAG;YACd;gBACE,EAAE,EAAE,MAAM;gBACV,MAAM,EAAE,KAAK;gBACb,IAAI,EAAE,GAAG;gBACT,UAAU,EAAE,KAAK;gBACjB,YAAY,EAAE,KAAK;gBACnB,IAAI,EAAE,MAAM;gBACZ,aAAa,EAAE,GAAG;gBAClB,QAAQ,EAAE,KAAK;gBACf,UAAU,EAAE,KAAK;gBACjB,SAAS,EAAE,IAAI,IAAI,EAAE;aACtB;YACD;gBACE,EAAE,EAAE,MAAM;gBACV,MAAM,EAAE,KAAK;gBACb,IAAI,EAAE,GAAG;gBACT,UAAU,EAAE,IAAI;gBAChB,YAAY,EAAE,IAAI;gBAClB,IAAI,EAAE,MAAM;gBACZ,aAAa,EAAE,GAAG;gBAClB,QAAQ,EAAE,IAAI;gBACd,UAAU,EAAE,IAAI;gBAChB,SAAS,EAAE,IAAI,IAAI,EAAE;aACtB;SACF,CAAC;IACJ,CAAC,CAAC,CAAC;IAEH,IAAA,kBAAQ,EAAC,4BAA4B,EAAE,GAAG,EAAE;QAC1C,IAAA,YAAE,EAAC,iDAAiD,EAAE,KAAK,IAAI,EAAE;YAC/D,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,0BAA0B,CACpD,KAAK,EAAE,kBAAkB;YACzB,aAAa,EACb,EAAE,EAAE,uBAAuB;YAC3B,GAAG,EAAE,wBAAwB;YAC7B,GAAG,CAAC,yBAAyB;aAC9B,CAAC;YAEF,IAAA,gBAAM,EAAC,MAAM,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YACtD,IAAA,gBAAM,EAAC,MAAM,CAAC,MAAM,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YACtC,IAAA,gBAAM,EAAC,MAAM,CAAC,gBAAgB,CAAC,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAChD,IAAA,gBAAM,EAAC,MAAM,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3C,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,sCAAsC,EAAE,KAAK,IAAI,EAAE;YACpD,2DAA2D;YAC3D,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,0BAA0B,CACpD,IAAI,EACJ,aAAa,EACb,CAAC,GAAG,EACJ,CAAC,GAAG,EACJ,CAAC,GAAG,CACL,CAAC;YAEF,IAAA,gBAAM,EAAC,MAAM,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YACjE,IAAA,gBAAM,EAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YAChD,IAAA,gBAAM,EAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC;YACvD,IAAA,gBAAM,EAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YACjD,IAAA,gBAAM,EAAC,MAAM,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3C,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,yDAAyD,EAAE,KAAK,IAAI,EAAE;YACvE,gEAAgE;YAChE,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,0BAA0B,CACpD,IAAI,EACJ,aAAa,EACb,CAAC,IAAI,EACL,CAAC,IAAI,EACL,CAAC,IAAI,CACN,CAAC;YAEF,IAAA,gBAAM,EAAC,MAAM,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;YAClE,IAAA,gBAAM,EAAC,MAAM,CAAC,cAAc,CAAC,kBAAkB,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YACpE,IAAA,gBAAM,EAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YAChD,IAAA,gBAAM,EAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YAC/C,IAAA,gBAAM,EAAC,MAAM,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YAC1D,IAAA,gBAAM,EAAC,MAAM,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3C,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,qDAAqD,EAAE,KAAK,IAAI,EAAE;YACnE,6DAA6D;YAC7D,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,0BAA0B,CACpD,IAAI,EACJ,aAAa,EACb,CAAC,IAAI,EACL,CAAC,IAAI,EACL,CAAC,IAAI,CACN,CAAC;YAEF,IAAA,gBAAM,EAAC,MAAM,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;YAClE,IAAA,gBAAM,EAAC,MAAM,CAAC,cAAc,CAAC,uBAAuB,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACjE,IAAA,gBAAM,EAAC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YAChD,IAAA,gBAAM,EAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;YACrD,IAAA,gBAAM,EAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;YACnD,IAAA,gBAAM,EAAC,MAAM,CAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YAC1D,IAAA,gBAAM,EAAC,MAAM,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC5C,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,oDAAoD,EAAE,KAAK,IAAI,EAAE;YAClE,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,0BAA0B,CACpD,IAAI,EAAE,iCAAiC;YACvC,aAAa,EACb,CAAC,GAAG,EAAE,gBAAgB;YACtB,CAAC,GAAG,EACJ,CAAC,GAAG,CACL,CAAC;YAEF,IAAA,gBAAM,EAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC;YACjE,IAAA,gBAAM,EAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,gBAAgB,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACxE,IAAA,gBAAM,EAAC,MAAM,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QAC5C,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,gDAAgD,EAAE,KAAK,IAAI,EAAE;YAC9D,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,0BAA0B,CACpD,IAAI,EAAE,wCAAwC;YAC9C,aAAa,EACb,CAAC,EAAE,EACH,CAAC,GAAG,EAAE,mBAAmB;YACzB,CAAC,GAAG,CACL,CAAC;YAEF,IAAA,gBAAM,EAAC,MAAM,CAAC,UAAU,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,YAAY,CAAC,MAAM,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,GAAG,GAAG,CAAC,CAAC;YAC9F,IAAA,gBAAM,EAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACtF,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;YAC9C,yDAAyD;YACzD,MAAM,mBAAmB,GAAG;gBAC1B,GAAG,aAAa;gBAChB;oBACE,EAAE,EAAE,MAAM;oBACV,MAAM,EAAE,KAAK;oBACb,IAAI,EAAE,GAAG;oBACT,UAAU,EAAE,KAAK;oBACjB,YAAY,EAAE,KAAK;oBACnB,IAAI,EAAE,MAAM;oBACZ,aAAa,EAAE,GAAG;oBAClB,QAAQ,EAAE,KAAK;oBACf,UAAU,EAAE,KAAK;oBACjB,SAAS,EAAE,IAAI,IAAI,EAAE;iBACtB;aACF,CAAC;YAEF,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,0BAA0B,CACpD,KAAK,EACL,mBAAmB,EACnB,CAAC,EACD,CAAC,EACD,CAAC,CACF,CAAC;YAEF,IAAA,gBAAM,EAAC,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,IAAI,KAAK,kBAAkB,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC5E,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAA,kBAAQ,EAAC,0BAA0B,EAAE,GAAG,EAAE;QACxC,IAAA,YAAE,EAAC,yDAAyD,EAAE,GAAG,EAAE;YACjE,MAAM,cAAc,GAAG;gBACrB,eAAe,EAAE,CAAC;gBAClB,WAAW,EAAE,CAAC;gBACd,gBAAgB,EAAE,CAAC;gBACnB,gBAAgB,EAAE,GAAG;gBACrB,uBAAuB,EAAE,KAAK;gBAC9B,kBAAkB,EAAE,CAAC;aACtB,CAAC;YAEF,MAAM,YAAY,GAAG,MAAM,CAAC,+BAA+B,CAAC,IAAI,EAAE,cAAc,CAAC,CAAC;YAClF,IAAA,gBAAM,EAAC,YAAY,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAClC,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,kDAAkD,EAAE,GAAG,EAAE;YAC1D,MAAM,cAAc,GAAG;gBACrB,eAAe,EAAE,EAAE;gBACnB,WAAW,EAAE,EAAE;gBACf,gBAAgB,EAAE,CAAC;gBACnB,gBAAgB,EAAE,CAAC;gBACnB,uBAAuB,EAAE,KAAK;gBAC9B,kBAAkB,EAAE,EAAE,CAAC,qBAAqB;aAC7C,CAAC;YAEF,MAAM,YAAY,GAAG,MAAM,CAAC,+BAA+B,CAAC,IAAI,EAAE,cAAc,CAAC,CAAC;YAClF,IAAA,gBAAM,EAAC,YAAY,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,gBAAgB;QAClD,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,yDAAyD,EAAE,GAAG,EAAE;YACjE,MAAM,cAAc,GAAG;gBACrB,eAAe,EAAE,EAAE;gBACnB,WAAW,EAAE,EAAE;gBACf,gBAAgB,EAAE,EAAE;gBACpB,gBAAgB,EAAE,CAAC;gBACnB,uBAAuB,EAAE,IAAI;gBAC7B,kBAAkB,EAAE,GAAG,CAAC,yBAAyB;aAClD,CAAC;YAEF,MAAM,YAAY,GAAG,MAAM,CAAC,+BAA+B,CAAC,IAAI,EAAE,cAAc,CAAC,CAAC;YAClF,IAAA,gBAAM,EAAC,YAAY,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,gBAAgB;QAChD,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAA,kBAAQ,EAAC,qBAAqB,EAAE,GAAG,EAAE;QACnC,IAAA,YAAE,EAAC,6DAA6D,EAAE,GAAG,EAAE;YACrE,MAAM,cAAc,GAAG;gBACrB,eAAe,EAAE,CAAC;gBAClB,WAAW,EAAE,CAAC;gBACd,gBAAgB,EAAE,CAAC;gBACnB,gBAAgB,EAAE,GAAG;gBACrB,uBAAuB,EAAE,KAAK;gBAC9B,kBAAkB,EAAE,CAAC;aACtB,CAAC;YAEF,MAAM,UAAU,GAAG,MAAM,CAAC,uBAAuB,CAAC,cAAc,CAAC,CAAC;YAClE,IAAA,gBAAM,EAAC,UAAU,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAChC,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,+CAA+C,EAAE,KAAK,IAAI,EAAE;YAC7D,+BAA+B;YAC/B,MAAM,MAAM,CAAC,0BAA0B,CAAC,IAAI,EAAE,aAAa,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC;YAElF,yBAAyB;YACzB,MAAM,cAAc,GAAG;gBACrB,eAAe,EAAE,CAAC,EAAE,2BAA2B;gBAC/C,WAAW,EAAE,EAAE;gBACf,gBAAgB,EAAE,CAAC;gBACnB,gBAAgB,EAAE,EAAE,EAAE,qBAAqB;gBAC3C,uBAAuB,EAAE,IAAI;gBAC7B,kBAAkB,EAAE,CAAC;aACtB,CAAC;YAEF,MAAM,UAAU,GAAG,MAAM,CAAC,uBAAuB,CAAC,cAAc,CAAC,CAAC;YAClE,IAAA,gBAAM,EAAC,UAAU,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAChC,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,uDAAuD,EAAE,KAAK,IAAI,EAAE;YACrE,+BAA+B;YAC/B,MAAM,MAAM,CAAC,0BAA0B,CAAC,IAAI,EAAE,aAAa,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC;YAElF,MAAM,cAAc,GAAG;gBACrB,eAAe,EAAE,CAAC,EAAE,iCAAiC;gBACrD,WAAW,EAAE,EAAE;gBACf,gBAAgB,EAAE,CAAC;gBACnB,gBAAgB,EAAE,EAAE,EAAE,qBAAqB;gBAC3C,uBAAuB,EAAE,IAAI;gBAC7B,kBAAkB,EAAE,EAAE;aACvB,CAAC;YAEF,MAAM,UAAU,GAAG,MAAM,CAAC,uBAAuB,CAAC,cAAc,CAAC,CAAC;YAClE,IAAA,gBAAM,EAAC,UAAU,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;QACjC,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,gDAAgD,EAAE,KAAK,IAAI,EAAE;YAC9D,+BAA+B;YAC/B,MAAM,MAAM,CAAC,0BAA0B,CAAC,IAAI,EAAE,aAAa,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC;YAElF,oBAAoB;YACpB,MAAM,CAAC,sBAAsB,EAAE,CAAC;YAEhC,MAAM,KAAK,GAAG,MAAM,CAAC,2BAA2B,EAAE,CAAC;YACnD,IAAA,gBAAM,EAAC,KAAK,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;YAE3C,MAAM,MAAM,GAAG,MAAM,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YACzC,IAAA,gBAAM,EAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,OAAO,CAAC,QAAQ,CAAC,2BAA2B,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACvF,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAA,kBAAQ,EAAC,0BAA0B,EAAE,GAAG,EAAE;QACxC,IAAA,YAAE,EAAC,8CAA8C,EAAE,KAAK,IAAI,EAAE;YAC5D,qCAAqC;YACrC,MAAM,MAAM,CAAC,0BAA0B,CAAC,IAAI,EAAE,aAAa,EAAE,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;YAC/E,MAAM,MAAM,CAAC,0BAA0B,CAAC,IAAI,EAAE,aAAa,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC;YAClF,MAAM,MAAM,CAAC,0BAA0B,CAAC,IAAI,EAAE,aAAa,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC;YAElF,MAAM,KAAK,GAAG,MAAM,CAAC,2BAA2B,EAAE,CAAC;YAEnD,IAAA,gBAAM,EAAC,KAAK,CAAC,oBAAoB,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YACtD,IAAA,gBAAM,EAAC,KAAK,CAAC,qBAAqB,CAAC,CAAC,eAAe,CAAC,EAAE,CAAC,CAAC;YACxD,IAAA,gBAAM,EAAC,KAAK,CAAC,oBAAoB,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YACtD,IAAA,gBAAM,EAAC,KAAK,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QAChD,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,gCAAgC,EAAE,KAAK,IAAI,EAAE;YAC9C,MAAM,MAAM,CAAC,0BAA0B,CAAC,IAAI,EAAE,aAAa,EAAE,CAAC,GAAG,EAAE,CAAC,GAAG,EAAE,CAAC,GAAG,CAAC,CAAC;YAE/E,MAAM,YAAY,GAAG,MAAM,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YAC/C,IAAA,gBAAM,EAAC,YAAY,CAAC,MAAM,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YAE/C,mBAAmB;YACnB,MAAM,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,CAAC,mBAAmB;YAC7C,MAAM,gBAAgB,GAAG,MAAM,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YACnD,IAAA,gBAAM,EAAC,gBAAgB,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QAC1C,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,uCAAuC,EAAE,GAAG,EAAE;YAC/C,MAAM,SAAS,GAAG,EAAE,oBAAoB,EAAE,EAAE,EAAE,CAAC;YAC/C,MAAM,CAAC,YAAY,CAAC,SAAS,CAAC,CAAC;YAE/B,MAAM,MAAM,GAAG,MAAM,CAAC,SAAS,EAAE,CAAC;YAClC,IAAA,gBAAM,EAAC,MAAM,CAAC,oBAAoB,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YAC7C,IAAA,gBAAM,EAAC,MAAM,CAAC,wBAAwB,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,0BAA0B;QAC7E,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAA,kBAAQ,EAAC,aAAa,EAAE,GAAG,EAAE;QAC3B,IAAA,YAAE,EAAC,wCAAwC,EAAE,KAAK,IAAI,EAAE;YACtD,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,0BAA0B,CACpD,IAAI,EAAE,UAAU;YAChB,aAAa,EACb,CAAC,GAAG,EAAE,gBAAgB;YACtB,CAAC,GAAG,EACJ,CAAC,GAAG,CACL,CAAC;YAEF,IAAA,gBAAM,EAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,cAAc;YAC/D,IAAA,gBAAM,EAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAClD,IAAA,gBAAM,EAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAElD,IAAA,gBAAM,EAAC,MAAM,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,cAAc;YAChE,IAAA,gBAAM,EAAC,MAAM,CAAC,UAAU,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YACnD,IAAA,gBAAM,EAAC,MAAM,CAAC,UAAU,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QACvD,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,sCAAsC,EAAE,KAAK,IAAI,EAAE;YACpD,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,0BAA0B,CACpD,KAAK,EAAE,UAAU;YACjB,aAAa,EACb,GAAG,EAAE,qBAAqB;YAC1B,GAAG,EACH,GAAG,CACJ,CAAC;YAEF,IAAA,gBAAM,EAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,UAAU;YAC3D,IAAA,gBAAM,EAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC;QAChF,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,IAAA,kBAAQ,EAAC,YAAY,EAAE,GAAG,EAAE;QAC1B,IAAA,YAAE,EAAC,qCAAqC,EAAE,KAAK,IAAI,EAAE;YACnD,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,0BAA0B,CACpD,KAAK,EACL,EAAE,EAAE,eAAe;YACnB,CAAC,EACD,CAAC,EACD,CAAC,CACF,CAAC;YAEF,IAAA,gBAAM,EAAC,MAAM,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YACtD,IAAA,gBAAM,EAAC,MAAM,CAAC,cAAc,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC3C,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,0CAA0C,EAAE,KAAK,IAAI,EAAE;YACxD,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,0BAA0B,CACpD,GAAG,EAAE,qBAAqB;YAC1B,EAAE,EACF,CAAC,EAAE,EAAE,WAAW;YAChB,CAAC,EAAE,EACH,CAAC,EAAE,CACJ,CAAC;YAEF,IAAA,gBAAM,EAAC,MAAM,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,CAAC;YACjE,IAAA,gBAAM,EAAC,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,YAAY;QAC7D,CAAC,CAAC,CAAC;QAEH,IAAA,YAAE,EAAC,wCAAwC,EAAE,KAAK,IAAI,EAAE;YACtD,MAAM,SAAS,GAAG,IAAI,uDAAyB,CAAC,aAAa,CAAC,CAAC;YAE/D,MAAM,MAAM,GAAG,MAAM,SAAS,CAAC,0BAA0B,CACvD,KAAK,EACL,aAAa,EACb,CAAC,EACD,CAAC,EACD,CAAC,CACF,CAAC;YAEF,IAAA,gBAAM,EAAC,MAAM,CAAC,cAAc,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YACtD,IAAA,gBAAM,EAAC,MAAM,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACpD,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","names":[],"sources":["C:\\Users\\Nick\\Desktop\\SmoothSail\\src\\trading\\risk\\__tests__\\capital-preservation-system.test.ts"],"sourcesContent":["/**\r\n * Capital Preservation System Tests\r\n * \r\n * Comprehensive tests for capital preservation functionality\r\n */\r\n\r\nimport { describe, it, expect, beforeEach } from '@jest/globals';\r\nimport { CapitalPreservationSystem, CapitalProtectionConfig } from '../capital-preservation-system';\r\nimport { Position } from '../types';\r\n\r\ndescribe('CapitalPreservationSystem', () => {\r\n  let system: CapitalPreservationSystem;\r\n  let defaultConfig: CapitalProtectionConfig;\r\n  let basePositions: Position[];\r\n\r\n  beforeEach(() => {\r\n    defaultConfig = {\r\n      maxDrawdownThreshold: 10, // 10% max drawdown\r\n      warningDrawdownThreshold: 5, // 5% warning\r\n      criticalDrawdownThreshold: 15, // 15% critical\r\n      consecutiveLossLimit: 3,\r\n      positionSizeReductionFactor: 0.5,\r\n      recoveryThreshold: 3, // 3% drawdown for recovery\r\n      dailyLossLimit: 2, // 2% daily loss limit\r\n      weeklyLossLimit: 5, // 5% weekly loss limit\r\n      monthlyLossLimit: 10 // 10% monthly loss limit\r\n    };\r\n\r\n    system = new CapitalPreservationSystem(defaultConfig);\r\n\r\n    basePositions = [\r\n      {\r\n        id: 'pos1',\r\n        symbol: 'BTC',\r\n        size: 0.1,\r\n        entryPrice: 50000,\r\n        currentPrice: 51000,\r\n        type: 'LONG',\r\n        unrealizedPnL: 100,\r\n        stopLoss: 49000,\r\n        takeProfit: 53000,\r\n        timestamp: new Date()\r\n      },\r\n      {\r\n        id: 'pos2',\r\n        symbol: 'ETH',\r\n        size: 1.0,\r\n        entryPrice: 3000,\r\n        currentPrice: 3100,\r\n        type: 'LONG',\r\n        unrealizedPnL: 100,\r\n        stopLoss: 2900,\r\n        takeProfit: 3300,\r\n        timestamp: new Date()\r\n      }\r\n    ];\r\n  });\r\n\r\n  describe('monitorCapitalPreservation', () => {\r\n    it('should monitor normal conditions without alerts', async () => {\r\n      const result = await system.monitorCapitalPreservation(\r\n        10000, // Current balance\r\n        basePositions,\r\n        50, // Daily P&L (positive)\r\n        200, // Weekly P&L (positive)\r\n        500 // Monthly P&L (positive)\r\n      );\r\n\r\n      expect(result.drawdownStatus.currentDrawdown).toBe(0);\r\n      expect(result.alerts).toHaveLength(0);\r\n      expect(result.emergencyActions).toHaveLength(0);\r\n      expect(result.tradingAllowed).toBe(true);\r\n    });\r\n\r\n    it('should detect warning level drawdown', async () => {\r\n      // Simulate account loss (from 10000 to 9400 = 6% drawdown)\r\n      const result = await system.monitorCapitalPreservation(\r\n        9400,\r\n        basePositions,\r\n        -600,\r\n        -600,\r\n        -600\r\n      );\r\n\r\n      expect(result.drawdownStatus.currentDrawdown).toBeGreaterThan(5);\r\n      expect(result.alerts.length).toBeGreaterThan(0);\r\n      expect(result.alerts[0].type).toBe('DRAWDOWN_WARNING');\r\n      expect(result.alerts[0].severity).toBe('MEDIUM');\r\n      expect(result.tradingAllowed).toBe(true);\r\n    });\r\n\r\n    it('should detect high drawdown and activate risk reduction', async () => {\r\n      // Simulate significant loss (from 10000 to 8800 = 12% drawdown)\r\n      const result = await system.monitorCapitalPreservation(\r\n        8800,\r\n        basePositions,\r\n        -1200,\r\n        -1200,\r\n        -1200\r\n      );\r\n\r\n      expect(result.drawdownStatus.currentDrawdown).toBeGreaterThan(10);\r\n      expect(result.drawdownStatus.riskReductionLevel).toBeGreaterThan(0);\r\n      expect(result.alerts.length).toBeGreaterThan(0);\r\n      expect(result.alerts[0].severity).toBe('HIGH');\r\n      expect(result.emergencyActions.length).toBeGreaterThan(0);\r\n      expect(result.tradingAllowed).toBe(true);\r\n    });\r\n\r\n    it('should activate emergency stop on critical drawdown', async () => {\r\n      // Simulate critical loss (from 10000 to 8400 = 16% drawdown)\r\n      const result = await system.monitorCapitalPreservation(\r\n        8400,\r\n        basePositions,\r\n        -1600,\r\n        -1600,\r\n        -1600\r\n      );\r\n\r\n      expect(result.drawdownStatus.currentDrawdown).toBeGreaterThan(15);\r\n      expect(result.drawdownStatus.emergencyMeasuresActive).toBe(true);\r\n      expect(result.alerts.length).toBeGreaterThan(0);\r\n      expect(result.alerts[0].type).toBe('EMERGENCY_STOP');\r\n      expect(result.alerts[0].severity).toBe('CRITICAL');\r\n      expect(result.emergencyActions.length).toBeGreaterThan(0);\r\n      expect(result.tradingAllowed).toBe(false);\r\n    });\r\n\r\n    it('should halt trading when daily loss limit exceeded', async () => {\r\n      const result = await system.monitorCapitalPreservation(\r\n        9700, // 3% loss exceeds 2% daily limit\r\n        basePositions,\r\n        -300, // 3% daily loss\r\n        -300,\r\n        -300\r\n      );\r\n\r\n      expect(result.lossLimits.daily.remaining).toBeLessThanOrEqual(0);\r\n      expect(result.alerts.some(a => a.type === 'EMERGENCY_STOP')).toBe(true);\r\n      expect(result.tradingAllowed).toBe(false);\r\n    });\r\n\r\n    it('should warn when approaching weekly loss limit', async () => {\r\n      const result = await system.monitorCapitalPreservation(\r\n        9550, // 4.5% loss approaching 5% weekly limit\r\n        basePositions,\r\n        -50,\r\n        -450, // 4.5% weekly loss\r\n        -450\r\n      );\r\n\r\n      expect(result.lossLimits.weekly.remaining).toBeLessThan(result.lossLimits.weekly.limit * 0.2);\r\n      expect(result.alerts.some(a => a.message.includes('Weekly loss limit'))).toBe(true);\r\n    });\r\n\r\n    it('should detect correlation risk', async () => {\r\n      // Add more BTC and ETH positions to increase correlation\r\n      const correlatedPositions = [\r\n        ...basePositions,\r\n        {\r\n          id: 'pos3',\r\n          symbol: 'BTC',\r\n          size: 0.2,\r\n          entryPrice: 49000,\r\n          currentPrice: 50000,\r\n          type: 'LONG',\r\n          unrealizedPnL: 200,\r\n          stopLoss: 48000,\r\n          takeProfit: 52000,\r\n          timestamp: new Date()\r\n        }\r\n      ];\r\n\r\n      const result = await system.monitorCapitalPreservation(\r\n        10000,\r\n        correlatedPositions,\r\n        0,\r\n        0,\r\n        0\r\n      );\r\n\r\n      expect(result.alerts.some(a => a.type === 'CORRELATION_RISK')).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('position size adjustment', () => {\r\n    it('should not adjust position size under normal conditions', () => {\r\n      const drawdownStatus = {\r\n        currentDrawdown: 2,\r\n        maxDrawdown: 2,\r\n        drawdownDuration: 1,\r\n        recoveryProgress: 100,\r\n        emergencyMeasuresActive: false,\r\n        riskReductionLevel: 0\r\n      };\r\n\r\n      const adjustedSize = system.calculatePositionSizeAdjustment(1000, drawdownStatus);\r\n      expect(adjustedSize).toBe(1000);\r\n    });\r\n\r\n    it('should reduce position size during high drawdown', () => {\r\n      const drawdownStatus = {\r\n        currentDrawdown: 12,\r\n        maxDrawdown: 12,\r\n        drawdownDuration: 5,\r\n        recoveryProgress: 0,\r\n        emergencyMeasuresActive: false,\r\n        riskReductionLevel: 40 // 40% risk reduction\r\n      };\r\n\r\n      const adjustedSize = system.calculatePositionSizeAdjustment(1000, drawdownStatus);\r\n      expect(adjustedSize).toBe(600); // 40% reduction\r\n    });\r\n\r\n    it('should maximize risk reduction during critical drawdown', () => {\r\n      const drawdownStatus = {\r\n        currentDrawdown: 18,\r\n        maxDrawdown: 18,\r\n        drawdownDuration: 10,\r\n        recoveryProgress: 0,\r\n        emergencyMeasuresActive: true,\r\n        riskReductionLevel: 100 // Maximum risk reduction\r\n      };\r\n\r\n      const adjustedSize = system.calculatePositionSizeAdjustment(1000, drawdownStatus);\r\n      expect(adjustedSize).toBe(0); // Complete halt\r\n    });\r\n  });\r\n\r\n  describe('recovery conditions', () => {\r\n    it('should not allow recovery when emergency mode is not active', () => {\r\n      const drawdownStatus = {\r\n        currentDrawdown: 2,\r\n        maxDrawdown: 5,\r\n        drawdownDuration: 1,\r\n        recoveryProgress: 100,\r\n        emergencyMeasuresActive: false,\r\n        riskReductionLevel: 0\r\n      };\r\n\r\n      const canRecover = system.checkRecoveryConditions(drawdownStatus);\r\n      expect(canRecover).toBe(true);\r\n    });\r\n\r\n    it('should allow recovery when conditions are met', async () => {\r\n      // First trigger emergency mode\r\n      await system.monitorCapitalPreservation(8400, basePositions, -1600, -1600, -1600);\r\n\r\n      // Then simulate recovery\r\n      const drawdownStatus = {\r\n        currentDrawdown: 2, // Below recovery threshold\r\n        maxDrawdown: 16,\r\n        drawdownDuration: 5,\r\n        recoveryProgress: 90, // Above 80% recovery\r\n        emergencyMeasuresActive: true,\r\n        riskReductionLevel: 0\r\n      };\r\n\r\n      const canRecover = system.checkRecoveryConditions(drawdownStatus);\r\n      expect(canRecover).toBe(true);\r\n    });\r\n\r\n    it('should not allow recovery when drawdown is still high', async () => {\r\n      // First trigger emergency mode\r\n      await system.monitorCapitalPreservation(8400, basePositions, -1600, -1600, -1600);\r\n\r\n      const drawdownStatus = {\r\n        currentDrawdown: 8, // Still above recovery threshold\r\n        maxDrawdown: 16,\r\n        drawdownDuration: 5,\r\n        recoveryProgress: 50, // Below 80% recovery\r\n        emergencyMeasuresActive: true,\r\n        riskReductionLevel: 20\r\n      };\r\n\r\n      const canRecover = system.checkRecoveryConditions(drawdownStatus);\r\n      expect(canRecover).toBe(false);\r\n    });\r\n\r\n    it('should resume normal operations after recovery', async () => {\r\n      // First trigger emergency mode\r\n      await system.monitorCapitalPreservation(8400, basePositions, -1600, -1600, -1600);\r\n\r\n      // Resume operations\r\n      system.resumeNormalOperations();\r\n\r\n      const stats = system.getCapitalPreservationStats();\r\n      expect(stats.currentStatus).toBe('NORMAL');\r\n\r\n      const alerts = system.getRecentAlerts(5);\r\n      expect(alerts.some(a => a.message.includes('Normal operations resumed'))).toBe(true);\r\n    });\r\n  });\r\n\r\n  describe('statistics and reporting', () => {\r\n    it('should track capital preservation statistics', async () => {\r\n      // Simulate multiple drawdown periods\r\n      await system.monitorCapitalPreservation(9400, basePositions, -600, -600, -600);\r\n      await system.monitorCapitalPreservation(8800, basePositions, -1200, -1200, -1200);\r\n      await system.monitorCapitalPreservation(8400, basePositions, -1600, -1600, -1600);\r\n\r\n      const stats = system.getCapitalPreservationStats();\r\n\r\n      expect(stats.totalDrawdownPeriods).toBeGreaterThan(0);\r\n      expect(stats.maxHistoricalDrawdown).toBeGreaterThan(15);\r\n      expect(stats.emergencyActivations).toBeGreaterThan(0);\r\n      expect(stats.currentStatus).toBe('EMERGENCY');\r\n    });\r\n\r\n    it('should manage alerts correctly', async () => {\r\n      await system.monitorCapitalPreservation(9400, basePositions, -600, -600, -600);\r\n\r\n      const recentAlerts = system.getRecentAlerts(5);\r\n      expect(recentAlerts.length).toBeGreaterThan(0);\r\n\r\n      // Clear old alerts\r\n      system.clearOldAlerts(0); // Clear all alerts\r\n      const alertsAfterClear = system.getRecentAlerts(5);\r\n      expect(alertsAfterClear.length).toBe(0);\r\n    });\r\n\r\n    it('should update configuration correctly', () => {\r\n      const newConfig = { maxDrawdownThreshold: 15 };\r\n      system.updateConfig(newConfig);\r\n\r\n      const config = system.getConfig();\r\n      expect(config.maxDrawdownThreshold).toBe(15);\r\n      expect(config.warningDrawdownThreshold).toBe(5); // Should remain unchanged\r\n    });\r\n  });\r\n\r\n  describe('loss limits', () => {\r\n    it('should calculate loss limits correctly', async () => {\r\n      const result = await system.monitorCapitalPreservation(\r\n        9800, // 2% loss\r\n        basePositions,\r\n        -200, // 2% daily loss\r\n        -200,\r\n        -200\r\n      );\r\n\r\n      expect(result.lossLimits.daily.limit).toBe(200); // 2% of 10000\r\n      expect(result.lossLimits.daily.current).toBe(200);\r\n      expect(result.lossLimits.daily.remaining).toBe(0);\r\n\r\n      expect(result.lossLimits.weekly.limit).toBe(500); // 5% of 10000\r\n      expect(result.lossLimits.weekly.current).toBe(200);\r\n      expect(result.lossLimits.weekly.remaining).toBe(300);\r\n    });\r\n\r\n    it('should handle positive P&L correctly', async () => {\r\n      const result = await system.monitorCapitalPreservation(\r\n        10200, // 2% gain\r\n        basePositions,\r\n        200, // Positive daily P&L\r\n        200,\r\n        200\r\n      );\r\n\r\n      expect(result.lossLimits.daily.current).toBe(0); // No loss\r\n      expect(result.lossLimits.daily.remaining).toBe(result.lossLimits.daily.limit);\r\n    });\r\n  });\r\n\r\n  describe('edge cases', () => {\r\n    it('should handle empty positions array', async () => {\r\n      const result = await system.monitorCapitalPreservation(\r\n        10000,\r\n        [], // No positions\r\n        0,\r\n        0,\r\n        0\r\n      );\r\n\r\n      expect(result.drawdownStatus.currentDrawdown).toBe(0);\r\n      expect(result.tradingAllowed).toBe(true);\r\n    });\r\n\r\n    it('should handle very small account balance', async () => {\r\n      const result = await system.monitorCapitalPreservation(\r\n        100, // Very small balance\r\n        [],\r\n        -10, // 10% loss\r\n        -10,\r\n        -10\r\n      );\r\n\r\n      expect(result.drawdownStatus.currentDrawdown).toBeGreaterThan(0);\r\n      expect(result.lossLimits.daily.limit).toBe(2); // 2% of 100\r\n    });\r\n\r\n    it('should handle first snapshot correctly', async () => {\r\n      const newSystem = new CapitalPreservationSystem(defaultConfig);\r\n      \r\n      const result = await newSystem.monitorCapitalPreservation(\r\n        10000,\r\n        basePositions,\r\n        0,\r\n        0,\r\n        0\r\n      );\r\n\r\n      expect(result.drawdownStatus.currentDrawdown).toBe(0);\r\n      expect(result.drawdownStatus.maxDrawdown).toBe(0);\r\n    });\r\n  });\r\n});"],"version":3}