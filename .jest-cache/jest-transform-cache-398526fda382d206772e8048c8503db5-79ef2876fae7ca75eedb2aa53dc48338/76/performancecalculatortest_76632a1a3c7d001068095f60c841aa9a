c3e79d44d321631a51bc6571b683cee1
"use strict";
/**
 * =============================================================================
 * PERFORMANCE CALCULATOR TESTS
 * =============================================================================
 *
 * Comprehensive tests for the performance calculator module.
 * Tests all performance metrics calculations including Sharpe ratio,
 * drawdown analysis, and risk metrics.
 *
 * @author AI Crypto Trading System
 * @version 1.0.0
 * @license PROPRIETARY
 * =============================================================================
 */
Object.defineProperty(exports, "__esModule", { value: true });
const globals_1 = require("@jest/globals");
const performance_calculator_1 = require("../performance-calculator");
// Sample data for testing
const sampleSignal = {
    id: 'test_signal',
    symbol: 'BTC_USDT',
    type: 'BUY',
    strength: 75,
    confidence: 80,
    indicators: ['MA_CROSSOVER'],
    reasoning: 'Test signal',
    riskReward: 2.0,
    timestamp: new Date('2024-01-01T00:00:00Z'),
};
const sampleTrades = [
    {
        id: 'trade_1',
        symbol: 'BTC_USDT',
        type: 'BUY',
        quantity: 0.1,
        entryPrice: 42000,
        exitPrice: 43000,
        entryTime: new Date('2024-01-01T00:00:00Z'),
        exitTime: new Date('2024-01-01T01:00:00Z'),
        strategy: 'TestStrategy',
        signal: sampleSignal,
        stopLoss: 41580,
        takeProfit: 43050,
        fees: 8.4,
        slippage: 4.2,
        pnl: 91.6,
        pnlPercentage: 2.18,
        status: 'CLOSED',
        exitReason: 'TAKE_PROFIT',
    },
    {
        id: 'trade_2',
        symbol: 'BTC_USDT',
        type: 'BUY',
        quantity: 0.05,
        entryPrice: 43000,
        exitPrice: 42500,
        entryTime: new Date('2024-01-01T01:00:00Z'),
        exitTime: new Date('2024-01-01T02:00:00Z'),
        strategy: 'TestStrategy',
        signal: sampleSignal,
        stopLoss: 42570,
        takeProfit: 43645,
        fees: 4.25,
        slippage: 2.15,
        pnl: -29.25,
        pnlPercentage: -1.36,
        status: 'CLOSED',
        exitReason: 'STOP_LOSS',
    },
];
const samplePortfolioHistory = [
    {
        timestamp: new Date('2024-01-01T00:00:00Z'),
        balance: 10000,
        equity: 10000,
        positions: [],
        totalPnL: 0,
        unrealizedPnL: 0,
        realizedPnL: 0,
        drawdown: 0,
        drawdownPercentage: 0,
        maxDrawdown: 0,
        maxDrawdownPercentage: 0,
    },
    {
        timestamp: new Date('2024-01-01T01:00:00Z'),
        balance: 10000,
        equity: 10091.6,
        positions: [],
        totalPnL: 91.6,
        unrealizedPnL: 0,
        realizedPnL: 91.6,
        drawdown: 0,
        drawdownPercentage: 0,
        maxDrawdown: 0,
        maxDrawdownPercentage: 0,
    },
    {
        timestamp: new Date('2024-01-01T02:00:00Z'),
        balance: 10000,
        equity: 10062.35,
        positions: [],
        totalPnL: 62.35,
        unrealizedPnL: 0,
        realizedPnL: 62.35,
        drawdown: 29.25,
        drawdownPercentage: 0.29,
        maxDrawdown: 29.25,
        maxDrawdownPercentage: 0.29,
    },
];
(0, globals_1.describe)('PerformanceCalculator', () => {
    (0, globals_1.describe)('Performance Metrics Calculation', () => {
        (0, globals_1.test)('should calculate basic performance metrics correctly', () => {
            const performance = performance_calculator_1.PerformanceCalculator.calculatePerformanceMetrics(sampleTrades, samplePortfolioHistory, 10000);
            (0, globals_1.expect)(performance.totalReturn).toBeCloseTo(62.35, 2);
            (0, globals_1.expect)(performance.totalReturnPercentage).toBeCloseTo(0.62, 2);
            (0, globals_1.expect)(performance.maxDrawdown).toBeCloseTo(29.25, 2);
            (0, globals_1.expect)(performance.maxDrawdownPercentage).toBeCloseTo(0.29, 2);
        });
        (0, globals_1.test)('should calculate Sharpe ratio', () => {
            const performance = performance_calculator_1.PerformanceCalculator.calculatePerformanceMetrics(sampleTrades, samplePortfolioHistory, 10000);
            (0, globals_1.expect)(performance.sharpeRatio).toBeDefined();
            (0, globals_1.expect)(typeof performance.sharpeRatio).toBe('number');
        });
        (0, globals_1.test)('should calculate profit factor correctly', () => {
            const performance = performance_calculator_1.PerformanceCalculator.calculatePerformanceMetrics(sampleTrades, samplePortfolioHistory, 10000);
            (0, globals_1.expect)(performance.profitFactor).toBeCloseTo(3.13, 1);
        });
    });
    (0, globals_1.describe)('Trade Statistics', () => {
        (0, globals_1.test)('should calculate trade statistics correctly', () => {
            const tradeStats = performance_calculator_1.PerformanceCalculator.calculateTradeStatistics(sampleTrades);
            (0, globals_1.expect)(tradeStats.total).toBe(2);
            (0, globals_1.expect)(tradeStats.winning).toBe(1);
            (0, globals_1.expect)(tradeStats.losing).toBe(1);
            (0, globals_1.expect)(tradeStats.winRate).toBe(50);
            (0, globals_1.expect)(tradeStats.averageWin).toBeCloseTo(91.6, 2);
            (0, globals_1.expect)(tradeStats.averageLoss).toBeCloseTo(29.25, 2);
        });
    });
    (0, globals_1.describe)('Risk Metrics', () => {
        (0, globals_1.test)('should calculate risk metrics correctly', () => {
            const returns = [0.00916, -0.0029];
            const riskMetrics = performance_calculator_1.PerformanceCalculator.calculateRiskMetrics(returns);
            (0, globals_1.expect)(riskMetrics.volatility).toBeGreaterThan(0);
            (0, globals_1.expect)(riskMetrics.var95).toBeDefined();
            (0, globals_1.expect)(riskMetrics.cvar95).toBeDefined();
        });
    });
    (0, globals_1.describe)('Curve Generation', () => {
        (0, globals_1.test)('should generate equity curve correctly', () => {
            const equityCurve = performance_calculator_1.PerformanceCalculator.generateEquityCurve(samplePortfolioHistory);
            (0, globals_1.expect)(equityCurve.length).toBe(samplePortfolioHistory.length);
            (0, globals_1.expect)(equityCurve[0].equity).toBe(10000);
            (0, globals_1.expect)(equityCurve[1].equity).toBeCloseTo(10091.6, 2);
        });
        (0, globals_1.test)('should generate drawdown curve correctly', () => {
            const drawdownCurve = performance_calculator_1.PerformanceCalculator.generateDrawdownCurve(samplePortfolioHistory);
            (0, globals_1.expect)(drawdownCurve.length).toBe(samplePortfolioHistory.length);
            (0, globals_1.expect)(drawdownCurve[0].drawdown).toBe(0);
            (0, globals_1.expect)(drawdownCurve[2].drawdown).toBeCloseTo(29.25, 2);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxOaWNrXFxEZXNrdG9wXFxTbW9vdGhTYWlsXFxzcmNcXHRyYWRpbmdcXGJhY2t0ZXN0aW5nXFxfX3Rlc3RzX19cXHBlcmZvcm1hbmNlLWNhbGN1bGF0b3IudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7Ozs7Ozs7R0FhRzs7QUFFSCwyQ0FBdUQ7QUFDdkQsc0VBQWtFO0FBSWxFLDBCQUEwQjtBQUMxQixNQUFNLFlBQVksR0FBa0I7SUFDbEMsRUFBRSxFQUFFLGFBQWE7SUFDakIsTUFBTSxFQUFFLFVBQVU7SUFDbEIsSUFBSSxFQUFFLEtBQUs7SUFDWCxRQUFRLEVBQUUsRUFBRTtJQUNaLFVBQVUsRUFBRSxFQUFFO0lBQ2QsVUFBVSxFQUFFLENBQUMsY0FBYyxDQUFDO0lBQzVCLFNBQVMsRUFBRSxhQUFhO0lBQ3hCLFVBQVUsRUFBRSxHQUFHO0lBQ2YsU0FBUyxFQUFFLElBQUksSUFBSSxDQUFDLHNCQUFzQixDQUFDO0NBQzVDLENBQUM7QUFFRixNQUFNLFlBQVksR0FBb0I7SUFDcEM7UUFDRSxFQUFFLEVBQUUsU0FBUztRQUNiLE1BQU0sRUFBRSxVQUFVO1FBQ2xCLElBQUksRUFBRSxLQUFLO1FBQ1gsUUFBUSxFQUFFLEdBQUc7UUFDYixVQUFVLEVBQUUsS0FBSztRQUNqQixTQUFTLEVBQUUsS0FBSztRQUNoQixTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsc0JBQXNCLENBQUM7UUFDM0MsUUFBUSxFQUFFLElBQUksSUFBSSxDQUFDLHNCQUFzQixDQUFDO1FBQzFDLFFBQVEsRUFBRSxjQUFjO1FBQ3hCLE1BQU0sRUFBRSxZQUFZO1FBQ3BCLFFBQVEsRUFBRSxLQUFLO1FBQ2YsVUFBVSxFQUFFLEtBQUs7UUFDakIsSUFBSSxFQUFFLEdBQUc7UUFDVCxRQUFRLEVBQUUsR0FBRztRQUNiLEdBQUcsRUFBRSxJQUFJO1FBQ1QsYUFBYSxFQUFFLElBQUk7UUFDbkIsTUFBTSxFQUFFLFFBQVE7UUFDaEIsVUFBVSxFQUFFLGFBQWE7S0FDMUI7SUFDRDtRQUNFLEVB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LENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQy9ELElBQUEsZ0JBQU0sRUFBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzFDLElBQUEsZ0JBQU0sRUFBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsV0FBVyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsQ0FBQztRQUN4RCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUEsY0FBSSxFQUFDLDBDQUEwQyxFQUFFLEdBQUcsRUFBRTtZQUNwRCxNQUFNLGFBQWEsR0FBRyw4Q0FBcUIsQ0FBQyxxQkFBcUIsQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO1lBRTFGLElBQUEsZ0JBQU0sRUFBQyxhQUFhLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLHNCQUFzQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ2pFLElBQUEsZ0JBQU0sRUFBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzFDLElBQUEsZ0JBQU0sRUFBQyxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLENBQUMsV0FBVyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztRQUMxRCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxOaWNrXFxEZXNrdG9wXFxTbW9vdGhTYWlsXFxzcmNcXHRyYWRpbmdcXGJhY2t0ZXN0aW5nXFxfX3Rlc3RzX19cXHBlcmZvcm1hbmNlLWNhbGN1bGF0b3IudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cclxuICogUEVSRk9STUFOQ0UgQ0FMQ1VMQVRPUiBURVNUU1xyXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gKiBcclxuICogQ29tcHJlaGVuc2l2ZSB0ZXN0cyBmb3IgdGhlIHBlcmZvcm1hbmNlIGNhbGN1bGF0b3IgbW9kdWxlLlxyXG4gKiBUZXN0cyBhbGwgcGVyZm9ybWFuY2UgbWV0cmljcyBjYWxjdWxhdGlvbnMgaW5jbHVkaW5nIFNoYXJwZSByYXRpbyxcclxuICogZHJhd2Rvd24gYW5hbHlzaXMsIGFuZCByaXNrIG1ldHJpY3MuXHJcbiAqIFxyXG4gKiBAYXV0aG9yIEFJIENyeXB0byBUcmFkaW5nIFN5c3RlbVxyXG4gKiBAdmVyc2lvbiAxLjAuMFxyXG4gKiBAbGljZW5zZSBQUk9QUklFVEFSWVxyXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gKi9cclxuXHJcbmltcG9ydCB7IGRlc2NyaWJlLCB0ZXN0LCBleHBlY3QgfSBmcm9tICdAamVzdC9nbG9iYWxzJztcclxuaW1wb3J0IHsgUGVyZm9ybWFuY2VDYWxjdWxhdG9yIH0gZnJvbSAnLi4vcGVyZm9ybWFuY2UtY2FsY3VsYXRvcic7XHJcbmltcG9ydCB7IEJhY2t0ZXN0VHJhZGUsIEJhY2t0ZXN0UG9ydGZvbGlvIH0gZnJvbSAnLi4vdHlwZXMnO1xyXG5pbXBvcnQgeyBUcmFkaW5nU2lnbmFsIH0gZnJvbSAnLi4vLi4vc3RyYXRlZ2llcy90eXBlcyc7XHJcblxyXG4vLyBTYW1wbGUgZGF0YSBmb3IgdGVzdGluZ1xyXG5jb25zdCBzYW1wbGVTaWduYWw6IFRyYWRpbmdTaWduYWwgPSB7XHJcbiAgaWQ6ICd0ZXN0X3NpZ25hbCcsXHJcbiAgc3ltYm9sOiAnQlRDX1VTRFQnLFxyXG4gIHR5cGU6ICdCVVknLFxyXG4gIHN0cmVuZ3RoOiA3NSxcclxuICBjb25maWRlbmNlOiA4MCxcclxuICBpbmRpY2F0b3JzOiBbJ01BX0NST1NTT1ZFUiddLFxyXG4gIHJlYXNvbmluZzogJ1Rlc3Qgc2lnbmFsJyxcclxuICByaXNrUmV3YXJkOiAyLjAsXHJcbiAgdGltZXN0YW1wOiBuZXcgRGF0ZSgnMjAyNC0wMS0wMVQwMDowMDowMFonKSxcclxufTtcclxuXHJcbmNvbnN0IHNhbXBsZVRyYWRlczogQmFja3Rlc3RUcmFkZVtdID0gW1xyXG4gIHtcclxuICAgIGlkOiAndHJhZGVfMScsXHJcbiAgICBzeW1ib2w6ICdCVENfVVNEVCcsXHJcbiAgICB0eXBlOiAnQlVZJyxcclxuICAgIHF1YW50aXR5OiAwLjEsXHJcbiAgICBlbnRyeVByaWNlOiA0MjAwMCxcclxuICAgIGV4aXRQcmljZTogNDMwMDAsXHJcbiAgICBlbnRyeVRpbWU6IG5ldyBEYXRlKCcyMDI0LTAxLTAxVDAwOjAwOjAwWicpLFxyXG4gICAgZXhpdFRpbWU6IG5ldyBEYXRlKCcyMDI0LTAxLTAxVDAxOjAwOjAwWicpLFxyXG4gICAgc3RyYXRlZ3k6ICdUZXN0U3RyYXRlZ3knLFxyXG4gICAgc2lnbmFsOiBzYW1wbGVTaWduYWwsXHJcbiAgICBzdG9wTG9zczogNDE1ODAsXHJcbiAgICB0YWtlUHJvZml0OiA0MzA1MCxcclxuICAgIGZlZXM6IDguNCxcclxuICAgIHNsaXBwYWdlOiA0LjIsXHJcbiAgICBwbmw6IDkxLjYsXHJcbiAgICBwbmxQZXJjZW50YWdlOiAyLjE4LFxyXG4gICAgc3RhdHVzOiAnQ0xPU0VEJyxcclxuICAgIGV4aXRSZWFzb246ICdUQUtFX1BST0ZJVCcsXHJcbiAgfSxcclxuICB7XHJcbiAgICBpZDogJ3RyYWRlXzInLFxyXG4gICAgc3ltYm9sOiAnQlRDX1VTRFQnLFxyXG4gICAgdHlwZTogJ0JVWScsXHJcbiAgICBxdWFudGl0eTogMC4wNSxcclxuICAgIGVudHJ5UHJpY2U6IDQzMDAwLFxyXG4gICAgZXhpdFByaWNlOiA0MjUwMCxcclxuICAgIGVudHJ5VGltZTogbmV3IERhdGUoJzIwMjQtMDEtMDFUMDE6MDA6MDBaJyksXHJcbiAgICBleGl0VGltZTogbmV3IERhdGUoJzIwMjQtMDEtMDFUMDI6MDA6MDBaJyksXHJcbiAgICBzdHJhdGVneTogJ1Rlc3RTdHJhdGVneScsXHJcbiAgICBzaWduYWw6IHNhbXBsZVNpZ25hbCxcclxuICAgIHN0b3BMb3NzOiA0MjU3MCxcclxuICAgIHRha2VQcm9maXQ6IDQzNjQ1LFxyXG4gICAgZmVlczogNC4yNSxcclxuICAgIHNsaXBwYWdlOiAyLjE1LFxyXG4gICAgcG5sOiAtMjkuMjUsXHJcbiAgICBwbmxQZXJjZW50YWdlOiAtMS4zNixcclxuICAgIHN0YXR1czogJ0NMT1NFRCcsXHJcbiAgICBleGl0UmVhc29uOiAnU1RPUF9MT1NTJyxcclxuICB9LFxyXG5dO1xyXG5cclxuY29uc3Qgc2FtcGxlUG9ydGZvbGlvSGlzdG9yeTogQmFja3Rlc3RQb3J0Zm9saW9bXSA9IFtcclxuICB7XHJcbiAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCcyMDI0LTAxLTAxVDAwOjAwOjAwWicpLFxyXG4gICAgYmFsYW5jZTogMTAwMDAsXHJcbiAgICBlcXVpdHk6IDEwMDAwLFxyXG4gICAgcG9zaXRpb25zOiBbXSxcclxuICAgIHRvdGFsUG5MOiAwLFxyXG4gICAgdW5yZWFsaXplZFBuTDogMCxcclxuICAgIHJlYWxpemVkUG5MOiAwLFxyXG4gICAgZHJhd2Rvd246IDAsXHJcbiAgICBkcmF3ZG93blBlcmNlbnRhZ2U6IDAsXHJcbiAgICBtYXhEcmF3ZG93bjogMCxcclxuICAgIG1heERyYXdkb3duUGVyY2VudGFnZTogMCxcclxuICB9LFxyXG4gIHtcclxuICAgIHRpbWVzdGFtcDogbmV3IERhdGUoJzIwMjQtMDEtMDFUMDE6MDA6MDBaJyksXHJcbiAgICBiYWxhbmNlOiAxMDAwMCxcclxuICAgIGVxdWl0eTogMTAwOTEuNixcclxuICAgIHBvc2l0aW9uczogW10sXHJcbiAgICB0b3RhbFBuTDogOTEuNixcclxuICAgIHVucmVhbGl6ZWRQbkw6IDAsXHJcbiAgICByZWFsaXplZFBuTDogOTEuNixcclxuICAgIGRyYXdkb3duOiAwLFxyXG4gICAgZHJhd2Rvd25QZXJjZW50YWdlOiAwLFxyXG4gICAgbWF4RHJhd2Rvd246IDAsXHJcbiAgICBtYXhEcmF3ZG93blBlcmNlbnRhZ2U6IDAsXHJcbiAgfSxcclxuICB7XHJcbiAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCcyMDI0LTAxLTAxVDAyOjAwOjAwWicpLFxyXG4gICAgYmFsYW5jZTogMTAwMDAsXHJcbiAgICBlcXVpdHk6IDEwMDYyLjM1LFxyXG4gICAgcG9zaXRpb25zOiBbXSxcclxuICAgIHRvdGFsUG5MOiA2Mi4zNSxcclxuICAgIHVucmVhbGl6ZWRQbkw6IDAsXHJcbiAgICByZWFsaXplZFBuTDogNjIuMzUsXHJcbiAgICBkcmF3ZG93bjogMjkuMjUsXHJcbiAgICBkcmF3ZG93blBlcmNlbnRhZ2U6IDAuMjksXHJcbiAgICBtYXhEcmF3ZG93bjogMjkuMjUsXHJcbiAgICBtYXhEcmF3ZG93blBlcmNlbnRhZ2U6IDAuMjksXHJcbiAgfSxcclxuXTtcclxuXHJcbmRlc2NyaWJlKCdQZXJmb3JtYW5jZUNhbGN1bGF0b3InLCAoKSA9PiB7XHJcbiAgZGVzY3JpYmUoJ1BlcmZvcm1hbmNlIE1ldHJpY3MgQ2FsY3VsYXRpb24nLCAoKSA9PiB7XHJcbiAgICB0ZXN0KCdzaG91bGQgY2FsY3VsYXRlIGJhc2ljIHBlcmZvcm1hbmNlIG1ldHJpY3MgY29ycmVjdGx5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBwZXJmb3JtYW5jZSA9IFBlcmZvcm1hbmNlQ2FsY3VsYXRvci5jYWxjdWxhdGVQZXJmb3JtYW5jZU1ldHJpY3MoXHJcbiAgICAgICAgc2FtcGxlVHJhZGVzLFxyXG4gICAgICAgIHNhbXBsZVBvcnRmb2xpb0hpc3RvcnksXHJcbiAgICAgICAgMTAwMDBcclxuICAgICAgKTtcclxuXHJcbiAgICAgIGV4cGVjdChwZXJmb3JtYW5jZS50b3RhbFJldHVybikudG9CZUNsb3NlVG8oNjIuMzUsIDIpO1xyXG4gICAgICBleHBlY3QocGVyZm9ybWFuY2UudG90YWxSZXR1cm5QZXJjZW50YWdlKS50b0JlQ2xvc2VUbygwLjYyLCAyKTtcclxuICAgICAgZXhwZWN0KHBlcmZvcm1hbmNlLm1heERyYXdkb3duKS50b0JlQ2xvc2VUbygyOS4yNSwgMik7XHJcbiAgICAgIGV4cGVjdChwZXJmb3JtYW5jZS5tYXhEcmF3ZG93blBlcmNlbnRhZ2UpLnRvQmVDbG9zZVRvKDAuMjksIDIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnc2hvdWxkIGNhbGN1bGF0ZSBTaGFycGUgcmF0aW8nLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBlcmZvcm1hbmNlID0gUGVyZm9ybWFuY2VDYWxjdWxhdG9yLmNhbGN1bGF0ZVBlcmZvcm1hbmNlTWV0cmljcyhcclxuICAgICAgICBzYW1wbGVUcmFkZXMsXHJcbiAgICAgICAgc2FtcGxlUG9ydGZvbGlvSGlzdG9yeSxcclxuICAgICAgICAxMDAwMFxyXG4gICAgICApO1xyXG5cclxuICAgICAgZXhwZWN0KHBlcmZvcm1hbmNlLnNoYXJwZVJhdGlvKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QodHlwZW9mIHBlcmZvcm1hbmNlLnNoYXJwZVJhdGlvKS50b0JlKCdudW1iZXInKTtcclxuICAgIH0pO1xyXG5cclxuICAgIHRlc3QoJ3Nob3VsZCBjYWxjdWxhdGUgcHJvZml0IGZhY3RvciBjb3JyZWN0bHknLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHBlcmZvcm1hbmNlID0gUGVyZm9ybWFuY2VDYWxjdWxhdG9yLmNhbGN1bGF0ZVBlcmZvcm1hbmNlTWV0cmljcyhcclxuICAgICAgICBzYW1wbGVUcmFkZXMsXHJcbiAgICAgICAgc2FtcGxlUG9ydGZvbGlvSGlzdG9yeSxcclxuICAgICAgICAxMDAwMFxyXG4gICAgICApO1xyXG5cclxuICAgICAgZXhwZWN0KHBlcmZvcm1hbmNlLnByb2ZpdEZhY3RvcikudG9CZUNsb3NlVG8oMy4xMywgMSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1RyYWRlIFN0YXRpc3RpY3MnLCAoKSA9PiB7XHJcbiAgICB0ZXN0KCdzaG91bGQgY2FsY3VsYXRlIHRyYWRlIHN0YXRpc3RpY3MgY29ycmVjdGx5JywgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0cmFkZVN0YXRzID0gUGVyZm9ybWFuY2VDYWxjdWxhdG9yLmNhbGN1bGF0ZVRyYWRlU3RhdGlzdGljcyhzYW1wbGVUcmFkZXMpO1xyXG5cclxuICAgICAgZXhwZWN0KHRyYWRlU3RhdHMudG90YWwpLnRvQmUoMik7XHJcbiAgICAgIGV4cGVjdCh0cmFkZVN0YXRzLndpbm5pbmcpLnRvQmUoMSk7XHJcbiAgICAgIGV4cGVjdCh0cmFkZVN0YXRzLmxvc2luZykudG9CZSgxKTtcclxuICAgICAgZXhwZWN0KHRyYWRlU3RhdHMud2luUmF0ZSkudG9CZSg1MCk7XHJcbiAgICAgIGV4cGVjdCh0cmFkZVN0YXRzLmF2ZXJhZ2VXaW4pLnRvQmVDbG9zZVRvKDkxLjYsIDIpO1xyXG4gICAgICBleHBlY3QodHJhZGVTdGF0cy5hdmVyYWdlTG9zcykudG9CZUNsb3NlVG8oMjkuMjUsIDIpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdSaXNrIE1ldHJpY3MnLCAoKSA9PiB7XHJcbiAgICB0ZXN0KCdzaG91bGQgY2FsY3VsYXRlIHJpc2sgbWV0cmljcyBjb3JyZWN0bHknLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHJldHVybnMgPSBbMC4wMDkxNiwgLTAuMDAyOV07XHJcbiAgICAgIGNvbnN0IHJpc2tNZXRyaWNzID0gUGVyZm9ybWFuY2VDYWxjdWxhdG9yLmNhbGN1bGF0ZVJpc2tNZXRyaWNzKHJldHVybnMpO1xyXG5cclxuICAgICAgZXhwZWN0KHJpc2tNZXRyaWNzLnZvbGF0aWxpdHkpLnRvQmVHcmVhdGVyVGhhbigwKTtcclxuICAgICAgZXhwZWN0KHJpc2tNZXRyaWNzLnZhcjk1KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3Qocmlza01ldHJpY3MuY3Zhcjk1KS50b0JlRGVmaW5lZCgpO1xyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdDdXJ2ZSBHZW5lcmF0aW9uJywgKCkgPT4ge1xyXG4gICAgdGVzdCgnc2hvdWxkIGdlbmVyYXRlIGVxdWl0eSBjdXJ2ZSBjb3JyZWN0bHknLCAoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGVxdWl0eUN1cnZlID0gUGVyZm9ybWFuY2VDYWxjdWxhdG9yLmdlbmVyYXRlRXF1aXR5Q3VydmUoc2FtcGxlUG9ydGZvbGlvSGlzdG9yeSk7XHJcblxyXG4gICAgICBleHBlY3QoZXF1aXR5Q3VydmUubGVuZ3RoKS50b0JlKHNhbXBsZVBvcnRmb2xpb0hpc3RvcnkubGVuZ3RoKTtcclxuICAgICAgZXhwZWN0KGVxdWl0eUN1cnZlWzBdLmVxdWl0eSkudG9CZSgxMDAwMCk7XHJcbiAgICAgIGV4cGVjdChlcXVpdHlDdXJ2ZVsxXS5lcXVpdHkpLnRvQmVDbG9zZVRvKDEwMDkxLjYsIDIpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgdGVzdCgnc2hvdWxkIGdlbmVyYXRlIGRyYXdkb3duIGN1cnZlIGNvcnJlY3RseScsICgpID0+IHtcclxuICAgICAgY29uc3QgZHJhd2Rvd25DdXJ2ZSA9IFBlcmZvcm1hbmNlQ2FsY3VsYXRvci5nZW5lcmF0ZURyYXdkb3duQ3VydmUoc2FtcGxlUG9ydGZvbGlvSGlzdG9yeSk7XHJcblxyXG4gICAgICBleHBlY3QoZHJhd2Rvd25DdXJ2ZS5sZW5ndGgpLnRvQmUoc2FtcGxlUG9ydGZvbGlvSGlzdG9yeS5sZW5ndGgpO1xyXG4gICAgICBleHBlY3QoZHJhd2Rvd25DdXJ2ZVswXS5kcmF3ZG93bikudG9CZSgwKTtcclxuICAgICAgZXhwZWN0KGRyYXdkb3duQ3VydmVbMl0uZHJhd2Rvd24pLnRvQmVDbG9zZVRvKDI5LjI1LCAyKTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTsiXSwidmVyc2lvbiI6M30=