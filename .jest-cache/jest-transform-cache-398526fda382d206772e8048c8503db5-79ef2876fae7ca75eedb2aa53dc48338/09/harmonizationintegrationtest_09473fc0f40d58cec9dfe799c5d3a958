2daaa85b827481f0f520479162fc89d9
"use strict";
/**
 * Strategy Harmonization Integration Tests
 *
 * Integration tests to verify the harmonization engine works correctly
 * with actual strategy implementations and real market data patterns.
 *
 * Requirements: 4.8, 17.10 - Strategy harmonization integration testing
 */
Object.defineProperty(exports, "__esModule", { value: true });
const harmonization_1 = require("../harmonization");
describe('StrategyHarmonizationEngine Integration', () => {
    let harmonizationEngine;
    beforeEach(() => {
        harmonizationEngine = new harmonization_1.StrategyHarmonizationEngine();
    });
    describe('Real Market Scenarios', () => {
        it('should handle bullish market conditions', () => {
            // Create bullish market data (uptrend with increasing volume)
            const bullishData = [];
            let basePrice = 45000;
            for (let i = 0; i < 50; i++) {
                basePrice += Math.random() * 200 + 50; // Generally increasing
                bullishData.push({
                    symbol: 'BTC/USDT',
                    timestamp: new Date(Date.now() - (50 - i) * 60000),
                    open: basePrice - 20,
                    high: basePrice + 100,
                    low: basePrice - 50,
                    close: basePrice,
                    volume: 1000000 + (i * 20000) // Increasing volume
                });
            }
            const harmonizedSignal = harmonizationEngine.harmonizeSignals(bullishData);
            expect(harmonizedSignal).toBeDefined();
            if (harmonizedSignal) {
                // In a strong bullish trend, we expect either BUY or HOLD
                expect(['BUY', 'HOLD']).toContain(harmonizedSignal.overallSignal);
                expect(harmonizedSignal.confidence).toBeGreaterThan(0);
                expect(harmonizedSignal.reasoning).toContain('indicators');
            }
        });
        it('should handle bearish market conditions', () => {
            // Create bearish market data (downtrend with increasing volume)
            const bearishData = [];
            let basePrice = 55000;
            for (let i = 0; i < 50; i++) {
                basePrice -= Math.random() * 200 + 50; // Generally decreasing
                bearishData.push({
                    symbol: 'BTC/USDT',
                    timestamp: new Date(Date.now() - (50 - i) * 60000),
                    open: basePrice + 20,
                    high: basePrice + 50,
                    low: basePrice - 100,
                    close: basePrice,
                    volume: 1000000 + (i * 20000) // Increasing volume
                });
            }
            const harmonizedSignal = harmonizationEngine.harmonizeSignals(bearishData);
            expect(harmonizedSignal).toBeDefined();
            if (harmonizedSignal) {
                // In a strong bearish trend, we expect either SELL or HOLD
                expect(['SELL', 'HOLD']).toContain(harmonizedSignal.overallSignal);
                expect(harmonizedSignal.confidence).toBeGreaterThan(0);
                expect(harmonizedSignal.reasoning).toContain('indicators');
            }
        });
        it('should handle sideways market conditions', () => {
            // Create sideways market data (range-bound)
            const sidewaysData = [];
            const basePrice = 50000;
            for (let i = 0; i < 50; i++) {
                const price = basePrice + (Math.sin(i * 0.2) * 500) + (Math.random() * 200 - 100);
                sidewaysData.push({
                    symbol: 'BTC/USDT',
                    timestamp: new Date(Date.now() - (50 - i) * 60000),
                    open: price - 10,
                    high: price + 50,
                    low: price - 50,
                    close: price,
                    volume: 1000000 + (Math.random() * 200000)
                });
            }
            const harmonizedSignal = harmonizationEngine.harmonizeSignals(sidewaysData);
            expect(harmonizedSignal).toBeDefined();
            if (harmonizedSignal) {
                // In sideways markets, we often expect HOLD or weak signals
                expect(['BUY', 'SELL', 'HOLD']).toContain(harmonizedSignal.overallSignal);
                expect(harmonizedSignal.reasoning).toContain('indicators');
            }
        });
        it('should handle volatile market conditions', () => {
            // Create highly volatile market data
            const volatileData = [];
            let basePrice = 50000;
            for (let i = 0; i < 50; i++) {
                // High volatility with random large moves
                const change = (Math.random() - 0.5) * 2000;
                basePrice += change;
                volatileData.push({
                    symbol: 'BTC/USDT',
                    timestamp: new Date(Date.now() - (50 - i) * 60000),
                    open: basePrice - change / 2,
                    high: basePrice + Math.abs(change),
                    low: basePrice - Math.abs(change),
                    close: basePrice,
                    volume: 1000000 + (Math.random() * 1000000) // High volume variance
                });
            }
            const harmonizedSignal = harmonizationEngine.harmonizeSignals(volatileData);
            expect(harmonizedSignal).toBeDefined();
            if (harmonizedSignal) {
                // In volatile markets, confidence should be lower
                expect(harmonizedSignal.confidence).toBeLessThan(90);
                expect(harmonizedSignal.reasoning).toContain('indicators');
                // Validation should flag potential issues
                const validation = harmonizationEngine.validateSignalHarmony(harmonizedSignal);
                expect(validation).toBeDefined();
            }
        });
    });
    describe('Strategy Interaction', () => {
        it('should demonstrate weighted scoring with custom weights', () => {
            // Create market data that would trigger different strategies
            const marketData = [];
            let basePrice = 50000;
            // Create data that shows RSI oversold but MACD bearish
            for (let i = 0; i < 30; i++) {
                if (i < 20) {
                    basePrice -= 100; // Decline for RSI oversold
                }
                else {
                    basePrice += 50; // Small recovery
                }
                marketData.push({
                    symbol: 'BTC/USDT',
                    timestamp: new Date(Date.now() - (30 - i) * 60000),
                    open: basePrice - 10,
                    high: basePrice + 30,
                    low: basePrice - 40,
                    close: basePrice,
                    volume: 1000000 + (Math.random() * 200000)
                });
            }
            // Test with RSI heavily weighted
            const rsiWeightedConfig = {
                rsi: { name: 'RSI', enabled: true, weight: 0.7, parameters: {} },
                macd: { name: 'MACD', enabled: true, weight: 0.3, parameters: {} }
            };
            const rsiWeightedSignal = harmonizationEngine.harmonizeSignals(marketData, rsiWeightedConfig);
            // Test with MACD heavily weighted
            const macdWeightedConfig = {
                rsi: { name: 'RSI', enabled: true, weight: 0.3, parameters: {} },
                macd: { name: 'MACD', enabled: true, weight: 0.7, parameters: {} }
            };
            const macdWeightedSignal = harmonizationEngine.harmonizeSignals(marketData, macdWeightedConfig);
            expect(rsiWeightedSignal).toBeDefined();
            expect(macdWeightedSignal).toBeDefined();
            if (rsiWeightedSignal && macdWeightedSignal) {
                // The weights should be reflected in the harmonized signals
                expect(rsiWeightedSignal.weights).toBeDefined();
                expect(macdWeightedSignal.weights).toBeDefined();
                // Both should have reasoning explaining the decision
                expect(rsiWeightedSignal.reasoning).toContain('indicators');
                expect(macdWeightedSignal.reasoning).toContain('indicators');
            }
        });
        it('should detect and report conflicts between strategies', () => {
            // Create market data that would cause conflicting signals
            const conflictingData = [];
            let basePrice = 50000;
            // Create a scenario where momentum is bullish but trend is bearish
            for (let i = 0; i < 40; i++) {
                if (i < 30) {
                    basePrice -= 50; // Long-term decline (bearish trend)
                }
                else {
                    basePrice += 200; // Recent sharp recovery (bullish momentum)
                }
                conflictingData.push({
                    symbol: 'BTC/USDT',
                    timestamp: new Date(Date.now() - (40 - i) * 60000),
                    open: basePrice - 20,
                    high: basePrice + 50,
                    low: basePrice - 60,
                    close: basePrice,
                    volume: 1000000 + (i > 30 ? 500000 : 0) // High volume on recovery
                });
            }
            const harmonizedSignal = harmonizationEngine.harmonizeSignals(conflictingData);
            expect(harmonizedSignal).toBeDefined();
            if (harmonizedSignal) {
                // Should detect conflicts between momentum and trend indicators
                expect(harmonizedSignal.conflicts.length).toBeGreaterThanOrEqual(0);
                // Validation should flag the conflicts
                const validation = harmonizationEngine.validateSignalHarmony(harmonizedSignal);
                expect(validation).toBeDefined();
                if (harmonizedSignal.conflicts.length > 0) {
                    expect(validation.issues.some(issue => issue.includes('conflicts'))).toBe(true);
                }
            }
        });
    });
    describe('Edge Cases and Error Handling', () => {
        it('should handle insufficient data gracefully', () => {
            const insufficientData = [
                {
                    symbol: 'BTC/USDT',
                    timestamp: new Date(),
                    open: 50000,
                    high: 50100,
                    low: 49900,
                    close: 50050,
                    volume: 1000000
                }
            ];
            const harmonizedSignal = harmonizationEngine.harmonizeSignals(insufficientData);
            // Should either return null or a signal with low confidence
            if (harmonizedSignal) {
                expect(harmonizedSignal.confidence).toBeLessThan(80);
            }
        });
        it('should handle extreme price movements', () => {
            const extremeData = [];
            let basePrice = 50000;
            for (let i = 0; i < 20; i++) {
                if (i === 10) {
                    basePrice *= 1.5; // 50% price spike
                }
                else if (i === 15) {
                    basePrice *= 0.7; // 30% price crash
                }
                else {
                    basePrice += (Math.random() - 0.5) * 100;
                }
                extremeData.push({
                    symbol: 'BTC/USDT',
                    timestamp: new Date(Date.now() - (20 - i) * 60000),
                    open: basePrice - 50,
                    high: basePrice + 100,
                    low: basePrice - 100,
                    close: basePrice,
                    volume: 1000000 + (Math.random() * 2000000)
                });
            }
            const harmonizedSignal = harmonizationEngine.harmonizeSignals(extremeData);
            expect(harmonizedSignal).toBeDefined();
            if (harmonizedSignal) {
                // Should handle extreme movements without crashing
                expect(harmonizedSignal.overallSignal).toMatch(/^(BUY|SELL|HOLD)$/);
                expect(harmonizedSignal.reasoning).toBeDefined();
            }
        });
    });
    describe('Performance and Reliability', () => {
        it('should provide consistent results for the same input', () => {
            const testData = [];
            for (let i = 0; i < 30; i++) {
                testData.push({
                    symbol: 'BTC/USDT',
                    timestamp: new Date(Date.now() - (30 - i) * 60000),
                    open: 50000 + i * 10,
                    high: 50000 + i * 10 + 50,
                    low: 50000 + i * 10 - 50,
                    close: 50000 + i * 10 + 5,
                    volume: 1000000
                });
            }
            // Run harmonization multiple times with same data
            const signal1 = harmonizationEngine.harmonizeSignals(testData);
            const signal2 = harmonizationEngine.harmonizeSignals(testData);
            const signal3 = harmonizationEngine.harmonizeSignals(testData);
            // Results should be consistent
            if (signal1 && signal2 && signal3) {
                expect(signal1.overallSignal).toBe(signal2.overallSignal);
                expect(signal2.overallSignal).toBe(signal3.overallSignal);
                expect(Math.abs(signal1.strength - signal2.strength)).toBeLessThan(0.1);
                expect(Math.abs(signal1.confidence - signal2.confidence)).toBeLessThan(0.1);
            }
        });
        it('should handle concurrent harmonization requests', async () => {
            const testData = [];
            for (let i = 0; i < 25; i++) {
                testData.push({
                    symbol: 'BTC/USDT',
                    timestamp: new Date(Date.now() - (25 - i) * 60000),
                    open: 50000 + Math.sin(i * 0.1) * 500,
                    high: 50000 + Math.sin(i * 0.1) * 500 + 100,
                    low: 50000 + Math.sin(i * 0.1) * 500 - 100,
                    close: 50000 + Math.sin(i * 0.1) * 500 + 25,
                    volume: 1000000
                });
            }
            // Run multiple harmonizations concurrently
            const promises = Array(5).fill(null).map(() => Promise.resolve(harmonizationEngine.harmonizeSignals(testData)));
            const results = await Promise.all(promises);
            // All should complete successfully
            results.forEach(result => {
                if (result) {
                    expect(result.overallSignal).toMatch(/^(BUY|SELL|HOLD)$/);
                    expect(result.strength).toBeGreaterThanOrEqual(0);
                    expect(result.confidence).toBeGreaterThanOrEqual(0);
                }
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxOaWNrXFxEZXNrdG9wXFxTbW9vdGhTYWlsXFxzcmNcXHRyYWRpbmdcXHN0cmF0ZWdpZXNcXF9fdGVzdHNfX1xcaGFybW9uaXphdGlvbi1pbnRlZ3JhdGlvbi50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7OztHQU9HOztBQUVILG9EQUErRDtBQUcvRCxRQUFRLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO0lBQ3ZELElBQUksbUJBQWdELENBQUM7SUFFckQsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLG1CQUFtQixHQUFHLElBQUksMkNBQTJCLEVBQUUsQ0FBQztJQUMxRCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7UUFDckMsRUFBRSxDQUFDLHlDQUF5QyxFQUFFLEdBQUcsRUFBRTtZQUNqRCw4REFBOEQ7WUFDOUQsTUFBTSxXQUFXLEdBQWlCLEVBQUUsQ0FBQztZQUNyQyxJQUFJLFNBQVMsR0FBRyxLQUFLLENBQUM7WUFFdEIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUM1QixTQUFTLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEdBQUcsR0FBRyxFQUFFLENBQUMsQ0FBQyx1QkFBdUI7Z0JBQzlELFdBQVcsQ0FBQyxJQUFJLENBQUM7b0JBQ2YsTUFBTSxFQUFFLFVBQVU7b0JBQ2xCLFNBQVMsRUFBRSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDO29CQUNsRCxJQUFJLEVBQUUsU0FBUyxHQUFHLEVBQUU7b0JBQ3BCLElBQUksRUFBRSxTQUFTLEdBQUcsR0FBRztvQkFDckIsR0FBRyxFQUFFLFNBQVMsR0FBRyxFQUFFO29CQUNuQixLQUFLLEVBQUUsU0FBUztvQkFDaEIsTUFBTSxFQUFFLE9BQU8sR0FBRyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxvQkFBb0I7aUJBQ25ELENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxNQUFNLGdCQUFnQixHQUFHLG1CQUFtQixDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBRTNFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3ZDLElBQUksZ0JBQWdCLEVBQUUsQ0FBQztnQkFDckIsMERBQTBEO2dCQUMxRCxNQUFNLENBQUMsQ0FBQyxLQUFLLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLENBQUM7Z0JBQ2xFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDN0QsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHlDQUF5QyxFQUFFLEdBQUcsRUFBRTtZQUNqRCxnRUFBZ0U7WUFDaEUsTUFBTSxXQUFXLEdBQWlCLEVBQUUsQ0FBQztZQUNyQyxJQUFJLFNBQVMsR0FBRyxLQUFLLENBQUM7WUFFdEIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUM1QixTQUFTLElBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEdBQUcsR0FBRyxFQUFFLENBQUMsQ0FBQyx1QkFBdUI7Z0JBQzlELFdBQVcsQ0FBQyxJQUFJLENBQUM7b0JBQ2YsTUFBTSxFQUFFLFVBQVU7b0JBQ2xCLFNBQVMsRUFBRSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDO29CQUNsRCxJQUFJLEVBQUUsU0FBUyxHQUFHLEVBQUU7b0JBQ3BCLElBQUksRUFBRSxTQUFTLEdBQUcsRUFBRTtvQkFDcEIsR0FBRyxFQUFFLFNBQVMsR0FBRyxHQUFHO29CQUNwQixLQUFLLEVBQUUsU0FBUztvQkFDaEIsTUFBTSxFQUFFLE9BQU8sR0FBRyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUMsQ0FBQyxvQkFBb0I7aUJBQ25ELENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxNQUFNLGdCQUFnQixHQUFHLG1CQUFtQixDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBRTNFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3ZDLElBQUksZ0JBQWdCLEVBQUUsQ0FBQztnQkFDckIsMkRBQTJEO2dCQUMzRCxNQUFNLENBQUMsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLENBQUM7Z0JBQ25FLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3ZELE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDN0QsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDBDQUEwQyxFQUFFLEdBQUcsRUFBRTtZQUNsRCw0Q0FBNEM7WUFDNUMsTUFBTSxZQUFZLEdBQWlCLEVBQUUsQ0FBQztZQUN0QyxNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUM7WUFFeEIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUM1QixNQUFNLEtBQUssR0FBRyxTQUFTLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxHQUFHLEdBQUcsR0FBRyxDQUFDLENBQUM7Z0JBQ2xGLFlBQVksQ0FBQyxJQUFJLENBQUM7b0JBQ2hCLE1BQU0sRUFBRSxVQUFVO29CQUNsQixTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQztvQkFDbEQsSUFBSSxFQUFFLEtBQUssR0FBRyxFQUFFO29CQUNoQixJQUFJLEVBQUUsS0FBSyxHQUFHLEVBQUU7b0JBQ2hCLEdBQUcsRUFBRSxLQUFLLEdBQUcsRUFBRTtvQkFDZixLQUFLLEVBQUUsS0FBSztvQkFDWixNQUFNLEVBQUUsT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLE1BQU0sQ0FBQztpQkFDM0MsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELE1BQU0sZ0JBQWdCLEdBQUcsbUJBQW1CLENBQUMsZ0JBQWdCLENBQUMsWUFBWSxDQUFDLENBQUM7WUFFNUUsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDdkMsSUFBSSxnQkFBZ0IsRUFBRSxDQUFDO2dCQUNyQiw0REFBNEQ7Z0JBQzVELE1BQU0sQ0FBQyxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLENBQUM7Z0JBQzFFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7WUFDN0QsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDBDQUEwQyxFQUFFLEdBQUcsRUFBRTtZQUNsRCxxQ0FBcUM7WUFDckMsTUFBTSxZQUFZLEdBQWlCLEVBQUUsQ0FBQztZQUN0QyxJQUFJLFNBQVMsR0FBRyxLQUFLLENBQUM7WUFFdEIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUM1QiwwQ0FBMEM7Z0JBQzFDLE1BQU0sTUFBTSxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLEdBQUcsQ0FBQyxHQUFHLElBQUksQ0FBQztnQkFDNUMsU0FBUyxJQUFJLE1BQU0sQ0FBQztnQkFFcEIsWUFBWSxDQUFDLElBQUksQ0FBQztvQkFDaEIsTUFBTSxFQUFFLFVBQVU7b0JBQ2xCLFNBQVMsRUFBRSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDO29CQUNsRCxJQUFJLEVBQUUsU0FBUyxHQUFHLE1BQU0sR0FBRyxDQUFDO29CQUM1QixJQUFJLEVBQUUsU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO29CQUNsQyxHQUFHLEVBQUUsU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDO29CQUNqQyxLQUFLLEVBQUUsU0FBUztvQkFDaEIsTUFBTSxFQUFFLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUMsQ0FBQyx1QkFBdUI7aUJBQ3BFLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxNQUFNLGdCQUFnQixHQUFHLG1CQUFtQixDQUFDLGdCQUFnQixDQUFDLFlBQVksQ0FBQyxDQUFDO1lBRTVFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3ZDLElBQUksZ0JBQWdCLEVBQUUsQ0FBQztnQkFDckIsa0RBQWtEO2dCQUNsRCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsVUFBVSxDQUFDLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDO2dCQUNyRCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxDQUFDLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUUzRCwwQ0FBMEM7Z0JBQzFDLE1BQU0sVUFBVSxHQUFHLG1CQUFtQixDQUFDLHFCQUFxQixDQUFDLGdCQUFnQixDQUFDLENBQUM7Z0JBQy9FLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNuQyxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUU7UUFDcEMsRUFBRSxDQUFDLHlEQUF5RCxFQUFFLEdBQUcsRUFBRTtZQUNqRSw2REFBNkQ7WUFDN0QsTUFBTSxVQUFVLEdBQWlCLEVBQUUsQ0FBQztZQUNwQyxJQUFJLFNBQVMsR0FBRyxLQUFLLENBQUM7WUFFdEIsdURBQXVEO1lBQ3ZELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDNUIsSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUM7b0JBQ1gsU0FBUyxJQUFJLEdBQUcsQ0FBQyxDQUFDLDJCQUEyQjtnQkFDL0MsQ0FBQztxQkFBTSxDQUFDO29CQUNOLFNBQVMsSUFBSSxFQUFFLENBQUMsQ0FBQyxpQkFBaUI7Z0JBQ3BDLENBQUM7Z0JBRUQsVUFBVSxDQUFDLElBQUksQ0FBQztvQkFDZCxNQUFNLEVBQUUsVUFBVTtvQkFDbEIsU0FBUyxFQUFFLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUM7b0JBQ2xELElBQUksRUFBRSxTQUFTLEdBQUcsRUFBRTtvQkFDcEIsSUFBSSxFQUFFLFNBQVMsR0FBRyxFQUFFO29CQUNwQixHQUFHLEVBQUUsU0FBUyxHQUFHLEVBQUU7b0JBQ25CLEtBQUssRUFBRSxTQUFTO29CQUNoQixNQUFNLEVBQUUsT0FBTyxHQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sRUFBRSxHQUFHLE1BQU0sQ0FBQztpQkFDM0MsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELGlDQUFpQztZQUNqQyxNQUFNLGlCQUFpQixHQUFHO2dCQUN4QixHQUFHLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsRUFBRSxFQUFFO2dCQUNoRSxJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsRUFBRSxFQUFFO2FBQ25FLENBQUM7WUFFRixNQUFNLGlCQUFpQixHQUFHLG1CQUFtQixDQUFDLGdCQUFnQixDQUFDLFVBQVUsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDO1lBRTlGLGtDQUFrQztZQUNsQyxNQUFNLGtCQUFrQixHQUFHO2dCQUN6QixHQUFHLEVBQUUsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsRUFBRSxFQUFFO2dCQUNoRSxJQUFJLEVBQUUsRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLE9BQU8sRUFBRSxJQUFJLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxVQUFVLEVBQUUsRUFBRSxFQUFFO2FBQ25FLENBQUM7WUFFRixNQUFNLGtCQUFrQixHQUFHLG1CQUFtQixDQUFDLGdCQUFnQixDQUFDLFVBQVUsRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1lBRWhHLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBRXpDLElBQUksaUJBQWlCLElBQUksa0JBQWtCLEVBQUUsQ0FBQztnQkFDNUMsNERBQTREO2dCQUM1RCxNQUFNLENBQUMsaUJBQWlCLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7Z0JBQ2hELE1BQU0sQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFFakQscURBQXFEO2dCQUNyRCxNQUFNLENBQUMsaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO2dCQUM1RCxNQUFNLENBQUMsa0JBQWtCLENBQUMsU0FBUyxDQUFDLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO1lBQy9ELENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyx1REFBdUQsRUFBRSxHQUFHLEVBQUU7WUFDL0QsMERBQTBEO1lBQzFELE1BQU0sZUFBZSxHQUFpQixFQUFFLENBQUM7WUFDekMsSUFBSSxTQUFTLEdBQUcsS0FBSyxDQUFDO1lBRXRCLG1FQUFtRTtZQUNuRSxLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQzVCLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDO29CQUNYLFNBQVMsSUFBSSxFQUFFLENBQUMsQ0FBQyxvQ0FBb0M7Z0JBQ3ZELENBQUM7cUJBQU0sQ0FBQztvQkFDTixTQUFTLElBQUksR0FBRyxDQUFDLENBQUMsMkNBQTJDO2dCQUMvRCxDQUFDO2dCQUVELGVBQWUsQ0FBQyxJQUFJLENBQUM7b0JBQ25CLE1BQU0sRUFBRSxVQUFVO29CQUNsQixTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQztvQkFDbEQsSUFBSSxFQUFFLFNBQVMsR0FBRyxFQUFFO29CQUNwQixJQUFJLEVBQUUsU0FBUyxHQUFHLEVBQUU7b0JBQ3BCLEdBQUcsRUFBRSxTQUFTLEdBQUcsRUFBRTtvQkFDbkIsS0FBSyxFQUFFLFNBQVM7b0JBQ2hCLE1BQU0sRUFBRSxPQUFPLEdBQUcsQ0FBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLDBCQUEwQjtpQkFDbkUsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELE1BQU0sZ0JBQWdCLEdBQUcsbUJBQW1CLENBQUMsZ0JBQWdCLENBQUMsZUFBZSxDQUFDLENBQUM7WUFFL0UsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDdkMsSUFBSSxnQkFBZ0IsRUFBRSxDQUFDO2dCQUNyQixnRUFBZ0U7Z0JBQ2hFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBRXBFLHVDQUF1QztnQkFDdkMsTUFBTSxVQUFVLEdBQUcsbUJBQW1CLENBQUMscUJBQXFCLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztnQkFDL0UsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO2dCQUVqQyxJQUFJLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFLENBQUM7b0JBQzFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztnQkFDbEYsQ0FBQztZQUNILENBQUM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLCtCQUErQixFQUFFLEdBQUcsRUFBRTtRQUM3QyxFQUFFLENBQUMsNENBQTRDLEVBQUUsR0FBRyxFQUFFO1lBQ3BELE1BQU0sZ0JBQWdCLEdBQWlCO2dCQUNyQztvQkFDRSxNQUFNLEVBQUUsVUFBVTtvQkFDbEIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO29CQUNyQixJQUFJLEVBQUUsS0FBSztvQkFDWCxJQUFJLEVBQUUsS0FBSztvQkFDWCxHQUFHLEVBQUUsS0FBSztvQkFDVixLQUFLLEVBQUUsS0FBSztvQkFDWixNQUFNLEVBQUUsT0FBTztpQkFDaEI7YUFDRixDQUFDO1lBRUYsTUFBTSxnQkFBZ0IsR0FBRyxtQkFBbUIsQ0FBQyxnQkFBZ0IsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1lBRWhGLDREQUE0RDtZQUM1RCxJQUFJLGdCQUFnQixFQUFFLENBQUM7Z0JBQ3JCLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDdkQsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHVDQUF1QyxFQUFFLEdBQUcsRUFBRTtZQUMvQyxNQUFNLFdBQVcsR0FBaUIsRUFBRSxDQUFDO1lBQ3JDLElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQztZQUV0QixLQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQzVCLElBQUksQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDO29CQUNiLFNBQVMsSUFBSSxHQUFHLENBQUMsQ0FBQyxrQkFBa0I7Z0JBQ3RDLENBQUM7cUJBQU0sSUFBSSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUM7b0JBQ3BCLFNBQVMsSUFBSSxHQUFHLENBQUMsQ0FBQyxrQkFBa0I7Z0JBQ3RDLENBQUM7cUJBQU0sQ0FBQztvQkFDTixTQUFTLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLEdBQUcsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDO2dCQUMzQyxDQUFDO2dCQUVELFdBQVcsQ0FBQyxJQUFJLENBQUM7b0JBQ2YsTUFBTSxFQUFFLFVBQVU7b0JBQ2xCLFNBQVMsRUFBRSxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEdBQUcsS0FBSyxDQUFDO29CQUNsRCxJQUFJLEVBQUUsU0FBUyxHQUFHLEVBQUU7b0JBQ3BCLElBQUksRUFBRSxTQUFTLEdBQUcsR0FBRztvQkFDckIsR0FBRyxFQUFFLFNBQVMsR0FBRyxHQUFHO29CQUNwQixLQUFLLEVBQUUsU0FBUztvQkFDaEIsTUFBTSxFQUFFLE9BQU8sR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxPQUFPLENBQUM7aUJBQzVDLENBQUMsQ0FBQztZQUNMLENBQUM7WUFFRCxNQUFNLGdCQUFnQixHQUFHLG1CQUFtQixDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBRTNFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3ZDLElBQUksZ0JBQWdCLEVBQUUsQ0FBQztnQkFDckIsbURBQW1EO2dCQUNuRCxNQUFNLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDLENBQUM7Z0JBQ3BFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNuRCxDQUFDO1FBQ0gsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyw2QkFBNkIsRUFBRSxHQUFHLEVBQUU7UUFDM0MsRUFBRSxDQUFDLHNEQUFzRCxFQUFFLEdBQUcsRUFBRTtZQUM5RCxNQUFNLFFBQVEsR0FBaUIsRUFBRSxDQUFDO1lBQ2xDLEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztnQkFDNUIsUUFBUSxDQUFDLElBQUksQ0FBQztvQkFDWixNQUFNLEVBQUUsVUFBVTtvQkFDbEIsU0FBUyxFQUFFLElBQUksSUFBSSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxLQUFLLENBQUM7b0JBQ2xELElBQUksRUFBRSxLQUFLLEdBQUcsQ0FBQyxHQUFHLEVBQUU7b0JBQ3BCLElBQUksRUFBRSxLQUFLLEdBQUcsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFO29CQUN6QixHQUFHLEVBQUUsS0FBSyxHQUFHLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRTtvQkFDeEIsS0FBSyxFQUFFLEtBQUssR0FBRyxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUM7b0JBQ3pCLE1BQU0sRUFBRSxPQUFPO2lCQUNoQixDQUFDLENBQUM7WUFDTCxDQUFDO1lBRUQsa0RBQWtEO1lBQ2xELE1BQU0sT0FBTyxHQUFHLG1CQUFtQixDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQy9ELE1BQU0sT0FBTyxHQUFHLG1CQUFtQixDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQy9ELE1BQU0sT0FBTyxHQUFHLG1CQUFtQixDQUFDLGdCQUFnQixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRS9ELCtCQUErQjtZQUMvQixJQUFJLE9BQU8sSUFBSSxPQUFPLElBQUksT0FBTyxFQUFFLENBQUM7Z0JBQ2xDLE1BQU0sQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQztnQkFDMUQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDO2dCQUMxRCxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsUUFBUSxHQUFHLE9BQU8sQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztnQkFDeEUsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxZQUFZLENBQUMsR0FBRyxDQUFDLENBQUM7WUFDOUUsQ0FBQztRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGlEQUFpRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQy9ELE1BQU0sUUFBUSxHQUFpQixFQUFFLENBQUM7WUFDbEMsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUM1QixRQUFRLENBQUMsSUFBSSxDQUFDO29CQUNaLE1BQU0sRUFBRSxVQUFVO29CQUNsQixTQUFTLEVBQUUsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxHQUFHLENBQUMsQ0FBQyxHQUFHLEtBQUssQ0FBQztvQkFDbEQsSUFBSSxFQUFFLEtBQUssR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsR0FBRyxHQUFHO29CQUNyQyxJQUFJLEVBQUUsS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxHQUFHO29CQUMzQyxHQUFHLEVBQUUsS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxHQUFHO29CQUMxQyxLQUFLLEVBQUUsS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxHQUFHLEdBQUcsR0FBRyxFQUFFO29CQUMzQyxNQUFNLEVBQUUsT0FBTztpQkFDaEIsQ0FBQyxDQUFDO1lBQ0wsQ0FBQztZQUVELDJDQUEyQztZQUMzQyxNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FDNUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUNoRSxDQUFDO1lBRUYsTUFBTSxPQUFPLEdBQUcsTUFBTSxPQUFPLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRTVDLG1DQUFtQztZQUNuQyxPQUFPLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFO2dCQUN2QixJQUFJLE1BQU0sRUFBRSxDQUFDO29CQUNYLE1BQU0sQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsT0FBTyxDQUFDLG1CQUFtQixDQUFDLENBQUM7b0JBQzFELE1BQU0sQ0FBQyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ2xELE1BQU0sQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ3RELENBQUM7WUFDSCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXE5pY2tcXERlc2t0b3BcXFNtb290aFNhaWxcXHNyY1xcdHJhZGluZ1xcc3RyYXRlZ2llc1xcX190ZXN0c19fXFxoYXJtb25pemF0aW9uLWludGVncmF0aW9uLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIFN0cmF0ZWd5IEhhcm1vbml6YXRpb24gSW50ZWdyYXRpb24gVGVzdHNcclxuICogXHJcbiAqIEludGVncmF0aW9uIHRlc3RzIHRvIHZlcmlmeSB0aGUgaGFybW9uaXphdGlvbiBlbmdpbmUgd29ya3MgY29ycmVjdGx5XHJcbiAqIHdpdGggYWN0dWFsIHN0cmF0ZWd5IGltcGxlbWVudGF0aW9ucyBhbmQgcmVhbCBtYXJrZXQgZGF0YSBwYXR0ZXJucy5cclxuICogXHJcbiAqIFJlcXVpcmVtZW50czogNC44LCAxNy4xMCAtIFN0cmF0ZWd5IGhhcm1vbml6YXRpb24gaW50ZWdyYXRpb24gdGVzdGluZ1xyXG4gKi9cclxuXHJcbmltcG9ydCB7IFN0cmF0ZWd5SGFybW9uaXphdGlvbkVuZ2luZSB9IGZyb20gJy4uL2hhcm1vbml6YXRpb24nO1xyXG5pbXBvcnQgeyBNYXJrZXREYXRhIH0gZnJvbSAnLi4vdHlwZXMnO1xyXG5cclxuZGVzY3JpYmUoJ1N0cmF0ZWd5SGFybW9uaXphdGlvbkVuZ2luZSBJbnRlZ3JhdGlvbicsICgpID0+IHtcclxuICBsZXQgaGFybW9uaXphdGlvbkVuZ2luZTogU3RyYXRlZ3lIYXJtb25pemF0aW9uRW5naW5lO1xyXG5cclxuICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgIGhhcm1vbml6YXRpb25FbmdpbmUgPSBuZXcgU3RyYXRlZ3lIYXJtb25pemF0aW9uRW5naW5lKCk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdSZWFsIE1hcmtldCBTY2VuYXJpb3MnLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBidWxsaXNoIG1hcmtldCBjb25kaXRpb25zJywgKCkgPT4ge1xyXG4gICAgICAvLyBDcmVhdGUgYnVsbGlzaCBtYXJrZXQgZGF0YSAodXB0cmVuZCB3aXRoIGluY3JlYXNpbmcgdm9sdW1lKVxyXG4gICAgICBjb25zdCBidWxsaXNoRGF0YTogTWFya2V0RGF0YVtdID0gW107XHJcbiAgICAgIGxldCBiYXNlUHJpY2UgPSA0NTAwMDtcclxuICAgICAgXHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTA7IGkrKykge1xyXG4gICAgICAgIGJhc2VQcmljZSArPSBNYXRoLnJhbmRvbSgpICogMjAwICsgNTA7IC8vIEdlbmVyYWxseSBpbmNyZWFzaW5nXHJcbiAgICAgICAgYnVsbGlzaERhdGEucHVzaCh7XHJcbiAgICAgICAgICBzeW1ib2w6ICdCVEMvVVNEVCcsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKERhdGUubm93KCkgLSAoNTAgLSBpKSAqIDYwMDAwKSxcclxuICAgICAgICAgIG9wZW46IGJhc2VQcmljZSAtIDIwLFxyXG4gICAgICAgICAgaGlnaDogYmFzZVByaWNlICsgMTAwLFxyXG4gICAgICAgICAgbG93OiBiYXNlUHJpY2UgLSA1MCxcclxuICAgICAgICAgIGNsb3NlOiBiYXNlUHJpY2UsXHJcbiAgICAgICAgICB2b2x1bWU6IDEwMDAwMDAgKyAoaSAqIDIwMDAwKSAvLyBJbmNyZWFzaW5nIHZvbHVtZVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBoYXJtb25pemVkU2lnbmFsID0gaGFybW9uaXphdGlvbkVuZ2luZS5oYXJtb25pemVTaWduYWxzKGJ1bGxpc2hEYXRhKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChoYXJtb25pemVkU2lnbmFsKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBpZiAoaGFybW9uaXplZFNpZ25hbCkge1xyXG4gICAgICAgIC8vIEluIGEgc3Ryb25nIGJ1bGxpc2ggdHJlbmQsIHdlIGV4cGVjdCBlaXRoZXIgQlVZIG9yIEhPTERcclxuICAgICAgICBleHBlY3QoWydCVVknLCAnSE9MRCddKS50b0NvbnRhaW4oaGFybW9uaXplZFNpZ25hbC5vdmVyYWxsU2lnbmFsKTtcclxuICAgICAgICBleHBlY3QoaGFybW9uaXplZFNpZ25hbC5jb25maWRlbmNlKS50b0JlR3JlYXRlclRoYW4oMCk7XHJcbiAgICAgICAgZXhwZWN0KGhhcm1vbml6ZWRTaWduYWwucmVhc29uaW5nKS50b0NvbnRhaW4oJ2luZGljYXRvcnMnKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgYmVhcmlzaCBtYXJrZXQgY29uZGl0aW9ucycsICgpID0+IHtcclxuICAgICAgLy8gQ3JlYXRlIGJlYXJpc2ggbWFya2V0IGRhdGEgKGRvd250cmVuZCB3aXRoIGluY3JlYXNpbmcgdm9sdW1lKVxyXG4gICAgICBjb25zdCBiZWFyaXNoRGF0YTogTWFya2V0RGF0YVtdID0gW107XHJcbiAgICAgIGxldCBiYXNlUHJpY2UgPSA1NTAwMDtcclxuICAgICAgXHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTA7IGkrKykge1xyXG4gICAgICAgIGJhc2VQcmljZSAtPSBNYXRoLnJhbmRvbSgpICogMjAwICsgNTA7IC8vIEdlbmVyYWxseSBkZWNyZWFzaW5nXHJcbiAgICAgICAgYmVhcmlzaERhdGEucHVzaCh7XHJcbiAgICAgICAgICBzeW1ib2w6ICdCVEMvVVNEVCcsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKERhdGUubm93KCkgLSAoNTAgLSBpKSAqIDYwMDAwKSxcclxuICAgICAgICAgIG9wZW46IGJhc2VQcmljZSArIDIwLFxyXG4gICAgICAgICAgaGlnaDogYmFzZVByaWNlICsgNTAsXHJcbiAgICAgICAgICBsb3c6IGJhc2VQcmljZSAtIDEwMCxcclxuICAgICAgICAgIGNsb3NlOiBiYXNlUHJpY2UsXHJcbiAgICAgICAgICB2b2x1bWU6IDEwMDAwMDAgKyAoaSAqIDIwMDAwKSAvLyBJbmNyZWFzaW5nIHZvbHVtZVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBoYXJtb25pemVkU2lnbmFsID0gaGFybW9uaXphdGlvbkVuZ2luZS5oYXJtb25pemVTaWduYWxzKGJlYXJpc2hEYXRhKTtcclxuICAgICAgXHJcbiAgICAgIGV4cGVjdChoYXJtb25pemVkU2lnbmFsKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBpZiAoaGFybW9uaXplZFNpZ25hbCkge1xyXG4gICAgICAgIC8vIEluIGEgc3Ryb25nIGJlYXJpc2ggdHJlbmQsIHdlIGV4cGVjdCBlaXRoZXIgU0VMTCBvciBIT0xEXHJcbiAgICAgICAgZXhwZWN0KFsnU0VMTCcsICdIT0xEJ10pLnRvQ29udGFpbihoYXJtb25pemVkU2lnbmFsLm92ZXJhbGxTaWduYWwpO1xyXG4gICAgICAgIGV4cGVjdChoYXJtb25pemVkU2lnbmFsLmNvbmZpZGVuY2UpLnRvQmVHcmVhdGVyVGhhbigwKTtcclxuICAgICAgICBleHBlY3QoaGFybW9uaXplZFNpZ25hbC5yZWFzb25pbmcpLnRvQ29udGFpbignaW5kaWNhdG9ycycpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzaWRld2F5cyBtYXJrZXQgY29uZGl0aW9ucycsICgpID0+IHtcclxuICAgICAgLy8gQ3JlYXRlIHNpZGV3YXlzIG1hcmtldCBkYXRhIChyYW5nZS1ib3VuZClcclxuICAgICAgY29uc3Qgc2lkZXdheXNEYXRhOiBNYXJrZXREYXRhW10gPSBbXTtcclxuICAgICAgY29uc3QgYmFzZVByaWNlID0gNTAwMDA7XHJcbiAgICAgIFxyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDUwOyBpKyspIHtcclxuICAgICAgICBjb25zdCBwcmljZSA9IGJhc2VQcmljZSArIChNYXRoLnNpbihpICogMC4yKSAqIDUwMCkgKyAoTWF0aC5yYW5kb20oKSAqIDIwMCAtIDEwMCk7XHJcbiAgICAgICAgc2lkZXdheXNEYXRhLnB1c2goe1xyXG4gICAgICAgICAgc3ltYm9sOiAnQlRDL1VTRFQnLFxyXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gKDUwIC0gaSkgKiA2MDAwMCksXHJcbiAgICAgICAgICBvcGVuOiBwcmljZSAtIDEwLFxyXG4gICAgICAgICAgaGlnaDogcHJpY2UgKyA1MCxcclxuICAgICAgICAgIGxvdzogcHJpY2UgLSA1MCxcclxuICAgICAgICAgIGNsb3NlOiBwcmljZSxcclxuICAgICAgICAgIHZvbHVtZTogMTAwMDAwMCArIChNYXRoLnJhbmRvbSgpICogMjAwMDAwKVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBoYXJtb25pemVkU2lnbmFsID0gaGFybW9uaXphdGlvbkVuZ2luZS5oYXJtb25pemVTaWduYWxzKHNpZGV3YXlzRGF0YSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoaGFybW9uaXplZFNpZ25hbCkudG9CZURlZmluZWQoKTtcclxuICAgICAgaWYgKGhhcm1vbml6ZWRTaWduYWwpIHtcclxuICAgICAgICAvLyBJbiBzaWRld2F5cyBtYXJrZXRzLCB3ZSBvZnRlbiBleHBlY3QgSE9MRCBvciB3ZWFrIHNpZ25hbHNcclxuICAgICAgICBleHBlY3QoWydCVVknLCAnU0VMTCcsICdIT0xEJ10pLnRvQ29udGFpbihoYXJtb25pemVkU2lnbmFsLm92ZXJhbGxTaWduYWwpO1xyXG4gICAgICAgIGV4cGVjdChoYXJtb25pemVkU2lnbmFsLnJlYXNvbmluZykudG9Db250YWluKCdpbmRpY2F0b3JzJyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHZvbGF0aWxlIG1hcmtldCBjb25kaXRpb25zJywgKCkgPT4ge1xyXG4gICAgICAvLyBDcmVhdGUgaGlnaGx5IHZvbGF0aWxlIG1hcmtldCBkYXRhXHJcbiAgICAgIGNvbnN0IHZvbGF0aWxlRGF0YTogTWFya2V0RGF0YVtdID0gW107XHJcbiAgICAgIGxldCBiYXNlUHJpY2UgPSA1MDAwMDtcclxuICAgICAgXHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTA7IGkrKykge1xyXG4gICAgICAgIC8vIEhpZ2ggdm9sYXRpbGl0eSB3aXRoIHJhbmRvbSBsYXJnZSBtb3Zlc1xyXG4gICAgICAgIGNvbnN0IGNoYW5nZSA9IChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIDIwMDA7XHJcbiAgICAgICAgYmFzZVByaWNlICs9IGNoYW5nZTtcclxuICAgICAgICBcclxuICAgICAgICB2b2xhdGlsZURhdGEucHVzaCh7XHJcbiAgICAgICAgICBzeW1ib2w6ICdCVEMvVVNEVCcsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKERhdGUubm93KCkgLSAoNTAgLSBpKSAqIDYwMDAwKSxcclxuICAgICAgICAgIG9wZW46IGJhc2VQcmljZSAtIGNoYW5nZSAvIDIsXHJcbiAgICAgICAgICBoaWdoOiBiYXNlUHJpY2UgKyBNYXRoLmFicyhjaGFuZ2UpLFxyXG4gICAgICAgICAgbG93OiBiYXNlUHJpY2UgLSBNYXRoLmFicyhjaGFuZ2UpLFxyXG4gICAgICAgICAgY2xvc2U6IGJhc2VQcmljZSxcclxuICAgICAgICAgIHZvbHVtZTogMTAwMDAwMCArIChNYXRoLnJhbmRvbSgpICogMTAwMDAwMCkgLy8gSGlnaCB2b2x1bWUgdmFyaWFuY2VcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgaGFybW9uaXplZFNpZ25hbCA9IGhhcm1vbml6YXRpb25FbmdpbmUuaGFybW9uaXplU2lnbmFscyh2b2xhdGlsZURhdGEpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KGhhcm1vbml6ZWRTaWduYWwpLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgIGlmIChoYXJtb25pemVkU2lnbmFsKSB7XHJcbiAgICAgICAgLy8gSW4gdm9sYXRpbGUgbWFya2V0cywgY29uZmlkZW5jZSBzaG91bGQgYmUgbG93ZXJcclxuICAgICAgICBleHBlY3QoaGFybW9uaXplZFNpZ25hbC5jb25maWRlbmNlKS50b0JlTGVzc1RoYW4oOTApO1xyXG4gICAgICAgIGV4cGVjdChoYXJtb25pemVkU2lnbmFsLnJlYXNvbmluZykudG9Db250YWluKCdpbmRpY2F0b3JzJyk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gVmFsaWRhdGlvbiBzaG91bGQgZmxhZyBwb3RlbnRpYWwgaXNzdWVzXHJcbiAgICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IGhhcm1vbml6YXRpb25FbmdpbmUudmFsaWRhdGVTaWduYWxIYXJtb255KGhhcm1vbml6ZWRTaWduYWwpO1xyXG4gICAgICAgIGV4cGVjdCh2YWxpZGF0aW9uKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ1N0cmF0ZWd5IEludGVyYWN0aW9uJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBkZW1vbnN0cmF0ZSB3ZWlnaHRlZCBzY29yaW5nIHdpdGggY3VzdG9tIHdlaWdodHMnLCAoKSA9PiB7XHJcbiAgICAgIC8vIENyZWF0ZSBtYXJrZXQgZGF0YSB0aGF0IHdvdWxkIHRyaWdnZXIgZGlmZmVyZW50IHN0cmF0ZWdpZXNcclxuICAgICAgY29uc3QgbWFya2V0RGF0YTogTWFya2V0RGF0YVtdID0gW107XHJcbiAgICAgIGxldCBiYXNlUHJpY2UgPSA1MDAwMDtcclxuICAgICAgXHJcbiAgICAgIC8vIENyZWF0ZSBkYXRhIHRoYXQgc2hvd3MgUlNJIG92ZXJzb2xkIGJ1dCBNQUNEIGJlYXJpc2hcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzMDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKGkgPCAyMCkge1xyXG4gICAgICAgICAgYmFzZVByaWNlIC09IDEwMDsgLy8gRGVjbGluZSBmb3IgUlNJIG92ZXJzb2xkXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGJhc2VQcmljZSArPSA1MDsgLy8gU21hbGwgcmVjb3ZlcnlcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgbWFya2V0RGF0YS5wdXNoKHtcclxuICAgICAgICAgIHN5bWJvbDogJ0JUQy9VU0RUJyxcclxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoRGF0ZS5ub3coKSAtICgzMCAtIGkpICogNjAwMDApLFxyXG4gICAgICAgICAgb3BlbjogYmFzZVByaWNlIC0gMTAsXHJcbiAgICAgICAgICBoaWdoOiBiYXNlUHJpY2UgKyAzMCxcclxuICAgICAgICAgIGxvdzogYmFzZVByaWNlIC0gNDAsXHJcbiAgICAgICAgICBjbG9zZTogYmFzZVByaWNlLFxyXG4gICAgICAgICAgdm9sdW1lOiAxMDAwMDAwICsgKE1hdGgucmFuZG9tKCkgKiAyMDAwMDApXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIFRlc3Qgd2l0aCBSU0kgaGVhdmlseSB3ZWlnaHRlZFxyXG4gICAgICBjb25zdCByc2lXZWlnaHRlZENvbmZpZyA9IHtcclxuICAgICAgICByc2k6IHsgbmFtZTogJ1JTSScsIGVuYWJsZWQ6IHRydWUsIHdlaWdodDogMC43LCBwYXJhbWV0ZXJzOiB7fSB9LFxyXG4gICAgICAgIG1hY2Q6IHsgbmFtZTogJ01BQ0QnLCBlbmFibGVkOiB0cnVlLCB3ZWlnaHQ6IDAuMywgcGFyYW1ldGVyczoge30gfVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgcnNpV2VpZ2h0ZWRTaWduYWwgPSBoYXJtb25pemF0aW9uRW5naW5lLmhhcm1vbml6ZVNpZ25hbHMobWFya2V0RGF0YSwgcnNpV2VpZ2h0ZWRDb25maWcpO1xyXG4gICAgICBcclxuICAgICAgLy8gVGVzdCB3aXRoIE1BQ0QgaGVhdmlseSB3ZWlnaHRlZFxyXG4gICAgICBjb25zdCBtYWNkV2VpZ2h0ZWRDb25maWcgPSB7XHJcbiAgICAgICAgcnNpOiB7IG5hbWU6ICdSU0knLCBlbmFibGVkOiB0cnVlLCB3ZWlnaHQ6IDAuMywgcGFyYW1ldGVyczoge30gfSxcclxuICAgICAgICBtYWNkOiB7IG5hbWU6ICdNQUNEJywgZW5hYmxlZDogdHJ1ZSwgd2VpZ2h0OiAwLjcsIHBhcmFtZXRlcnM6IHt9IH1cclxuICAgICAgfTtcclxuXHJcbiAgICAgIGNvbnN0IG1hY2RXZWlnaHRlZFNpZ25hbCA9IGhhcm1vbml6YXRpb25FbmdpbmUuaGFybW9uaXplU2lnbmFscyhtYXJrZXREYXRhLCBtYWNkV2VpZ2h0ZWRDb25maWcpO1xyXG4gICAgICBcclxuICAgICAgZXhwZWN0KHJzaVdlaWdodGVkU2lnbmFsKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBleHBlY3QobWFjZFdlaWdodGVkU2lnbmFsKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICBcclxuICAgICAgaWYgKHJzaVdlaWdodGVkU2lnbmFsICYmIG1hY2RXZWlnaHRlZFNpZ25hbCkge1xyXG4gICAgICAgIC8vIFRoZSB3ZWlnaHRzIHNob3VsZCBiZSByZWZsZWN0ZWQgaW4gdGhlIGhhcm1vbml6ZWQgc2lnbmFsc1xyXG4gICAgICAgIGV4cGVjdChyc2lXZWlnaHRlZFNpZ25hbC53ZWlnaHRzKS50b0JlRGVmaW5lZCgpO1xyXG4gICAgICAgIGV4cGVjdChtYWNkV2VpZ2h0ZWRTaWduYWwud2VpZ2h0cykudG9CZURlZmluZWQoKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBCb3RoIHNob3VsZCBoYXZlIHJlYXNvbmluZyBleHBsYWluaW5nIHRoZSBkZWNpc2lvblxyXG4gICAgICAgIGV4cGVjdChyc2lXZWlnaHRlZFNpZ25hbC5yZWFzb25pbmcpLnRvQ29udGFpbignaW5kaWNhdG9ycycpO1xyXG4gICAgICAgIGV4cGVjdChtYWNkV2VpZ2h0ZWRTaWduYWwucmVhc29uaW5nKS50b0NvbnRhaW4oJ2luZGljYXRvcnMnKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBkZXRlY3QgYW5kIHJlcG9ydCBjb25mbGljdHMgYmV0d2VlbiBzdHJhdGVnaWVzJywgKCkgPT4ge1xyXG4gICAgICAvLyBDcmVhdGUgbWFya2V0IGRhdGEgdGhhdCB3b3VsZCBjYXVzZSBjb25mbGljdGluZyBzaWduYWxzXHJcbiAgICAgIGNvbnN0IGNvbmZsaWN0aW5nRGF0YTogTWFya2V0RGF0YVtdID0gW107XHJcbiAgICAgIGxldCBiYXNlUHJpY2UgPSA1MDAwMDtcclxuICAgICAgXHJcbiAgICAgIC8vIENyZWF0ZSBhIHNjZW5hcmlvIHdoZXJlIG1vbWVudHVtIGlzIGJ1bGxpc2ggYnV0IHRyZW5kIGlzIGJlYXJpc2hcclxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA0MDsgaSsrKSB7XHJcbiAgICAgICAgaWYgKGkgPCAzMCkge1xyXG4gICAgICAgICAgYmFzZVByaWNlIC09IDUwOyAvLyBMb25nLXRlcm0gZGVjbGluZSAoYmVhcmlzaCB0cmVuZClcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgYmFzZVByaWNlICs9IDIwMDsgLy8gUmVjZW50IHNoYXJwIHJlY292ZXJ5IChidWxsaXNoIG1vbWVudHVtKVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICBjb25mbGljdGluZ0RhdGEucHVzaCh7XHJcbiAgICAgICAgICBzeW1ib2w6ICdCVEMvVVNEVCcsXHJcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKERhdGUubm93KCkgLSAoNDAgLSBpKSAqIDYwMDAwKSxcclxuICAgICAgICAgIG9wZW46IGJhc2VQcmljZSAtIDIwLFxyXG4gICAgICAgICAgaGlnaDogYmFzZVByaWNlICsgNTAsXHJcbiAgICAgICAgICBsb3c6IGJhc2VQcmljZSAtIDYwLFxyXG4gICAgICAgICAgY2xvc2U6IGJhc2VQcmljZSxcclxuICAgICAgICAgIHZvbHVtZTogMTAwMDAwMCArIChpID4gMzAgPyA1MDAwMDAgOiAwKSAvLyBIaWdoIHZvbHVtZSBvbiByZWNvdmVyeVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBjb25zdCBoYXJtb25pemVkU2lnbmFsID0gaGFybW9uaXphdGlvbkVuZ2luZS5oYXJtb25pemVTaWduYWxzKGNvbmZsaWN0aW5nRGF0YSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoaGFybW9uaXplZFNpZ25hbCkudG9CZURlZmluZWQoKTtcclxuICAgICAgaWYgKGhhcm1vbml6ZWRTaWduYWwpIHtcclxuICAgICAgICAvLyBTaG91bGQgZGV0ZWN0IGNvbmZsaWN0cyBiZXR3ZWVuIG1vbWVudHVtIGFuZCB0cmVuZCBpbmRpY2F0b3JzXHJcbiAgICAgICAgZXhwZWN0KGhhcm1vbml6ZWRTaWduYWwuY29uZmxpY3RzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBWYWxpZGF0aW9uIHNob3VsZCBmbGFnIHRoZSBjb25mbGljdHNcclxuICAgICAgICBjb25zdCB2YWxpZGF0aW9uID0gaGFybW9uaXphdGlvbkVuZ2luZS52YWxpZGF0ZVNpZ25hbEhhcm1vbnkoaGFybW9uaXplZFNpZ25hbCk7XHJcbiAgICAgICAgZXhwZWN0KHZhbGlkYXRpb24pLnRvQmVEZWZpbmVkKCk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKGhhcm1vbml6ZWRTaWduYWwuY29uZmxpY3RzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgIGV4cGVjdCh2YWxpZGF0aW9uLmlzc3Vlcy5zb21lKGlzc3VlID0+IGlzc3VlLmluY2x1ZGVzKCdjb25mbGljdHMnKSkpLnRvQmUodHJ1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9KTtcclxuXHJcbiAgZGVzY3JpYmUoJ0VkZ2UgQ2FzZXMgYW5kIEVycm9yIEhhbmRsaW5nJywgKCkgPT4ge1xyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgaW5zdWZmaWNpZW50IGRhdGEgZ3JhY2VmdWxseScsICgpID0+IHtcclxuICAgICAgY29uc3QgaW5zdWZmaWNpZW50RGF0YTogTWFya2V0RGF0YVtdID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgIHN5bWJvbDogJ0JUQy9VU0RUJyxcclxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgICAgICAgIG9wZW46IDUwMDAwLFxyXG4gICAgICAgICAgaGlnaDogNTAxMDAsXHJcbiAgICAgICAgICBsb3c6IDQ5OTAwLFxyXG4gICAgICAgICAgY2xvc2U6IDUwMDUwLFxyXG4gICAgICAgICAgdm9sdW1lOiAxMDAwMDAwXHJcbiAgICAgICAgfVxyXG4gICAgICBdO1xyXG5cclxuICAgICAgY29uc3QgaGFybW9uaXplZFNpZ25hbCA9IGhhcm1vbml6YXRpb25FbmdpbmUuaGFybW9uaXplU2lnbmFscyhpbnN1ZmZpY2llbnREYXRhKTtcclxuICAgICAgXHJcbiAgICAgIC8vIFNob3VsZCBlaXRoZXIgcmV0dXJuIG51bGwgb3IgYSBzaWduYWwgd2l0aCBsb3cgY29uZmlkZW5jZVxyXG4gICAgICBpZiAoaGFybW9uaXplZFNpZ25hbCkge1xyXG4gICAgICAgIGV4cGVjdChoYXJtb25pemVkU2lnbmFsLmNvbmZpZGVuY2UpLnRvQmVMZXNzVGhhbig4MCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGV4dHJlbWUgcHJpY2UgbW92ZW1lbnRzJywgKCkgPT4ge1xyXG4gICAgICBjb25zdCBleHRyZW1lRGF0YTogTWFya2V0RGF0YVtdID0gW107XHJcbiAgICAgIGxldCBiYXNlUHJpY2UgPSA1MDAwMDtcclxuICAgICAgXHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjA7IGkrKykge1xyXG4gICAgICAgIGlmIChpID09PSAxMCkge1xyXG4gICAgICAgICAgYmFzZVByaWNlICo9IDEuNTsgLy8gNTAlIHByaWNlIHNwaWtlXHJcbiAgICAgICAgfSBlbHNlIGlmIChpID09PSAxNSkge1xyXG4gICAgICAgICAgYmFzZVByaWNlICo9IDAuNzsgLy8gMzAlIHByaWNlIGNyYXNoXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGJhc2VQcmljZSArPSAoTWF0aC5yYW5kb20oKSAtIDAuNSkgKiAxMDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIGV4dHJlbWVEYXRhLnB1c2goe1xyXG4gICAgICAgICAgc3ltYm9sOiAnQlRDL1VTRFQnLFxyXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gKDIwIC0gaSkgKiA2MDAwMCksXHJcbiAgICAgICAgICBvcGVuOiBiYXNlUHJpY2UgLSA1MCxcclxuICAgICAgICAgIGhpZ2g6IGJhc2VQcmljZSArIDEwMCxcclxuICAgICAgICAgIGxvdzogYmFzZVByaWNlIC0gMTAwLFxyXG4gICAgICAgICAgY2xvc2U6IGJhc2VQcmljZSxcclxuICAgICAgICAgIHZvbHVtZTogMTAwMDAwMCArIChNYXRoLnJhbmRvbSgpICogMjAwMDAwMClcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgaGFybW9uaXplZFNpZ25hbCA9IGhhcm1vbml6YXRpb25FbmdpbmUuaGFybW9uaXplU2lnbmFscyhleHRyZW1lRGF0YSk7XHJcbiAgICAgIFxyXG4gICAgICBleHBlY3QoaGFybW9uaXplZFNpZ25hbCkudG9CZURlZmluZWQoKTtcclxuICAgICAgaWYgKGhhcm1vbml6ZWRTaWduYWwpIHtcclxuICAgICAgICAvLyBTaG91bGQgaGFuZGxlIGV4dHJlbWUgbW92ZW1lbnRzIHdpdGhvdXQgY3Jhc2hpbmdcclxuICAgICAgICBleHBlY3QoaGFybW9uaXplZFNpZ25hbC5vdmVyYWxsU2lnbmFsKS50b01hdGNoKC9eKEJVWXxTRUxMfEhPTEQpJC8pO1xyXG4gICAgICAgIGV4cGVjdChoYXJtb25pemVkU2lnbmFsLnJlYXNvbmluZykudG9CZURlZmluZWQoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfSk7XHJcblxyXG4gIGRlc2NyaWJlKCdQZXJmb3JtYW5jZSBhbmQgUmVsaWFiaWxpdHknLCAoKSA9PiB7XHJcbiAgICBpdCgnc2hvdWxkIHByb3ZpZGUgY29uc2lzdGVudCByZXN1bHRzIGZvciB0aGUgc2FtZSBpbnB1dCcsICgpID0+IHtcclxuICAgICAgY29uc3QgdGVzdERhdGE6IE1hcmtldERhdGFbXSA9IFtdO1xyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDMwOyBpKyspIHtcclxuICAgICAgICB0ZXN0RGF0YS5wdXNoKHtcclxuICAgICAgICAgIHN5bWJvbDogJ0JUQy9VU0RUJyxcclxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoRGF0ZS5ub3coKSAtICgzMCAtIGkpICogNjAwMDApLFxyXG4gICAgICAgICAgb3BlbjogNTAwMDAgKyBpICogMTAsXHJcbiAgICAgICAgICBoaWdoOiA1MDAwMCArIGkgKiAxMCArIDUwLFxyXG4gICAgICAgICAgbG93OiA1MDAwMCArIGkgKiAxMCAtIDUwLFxyXG4gICAgICAgICAgY2xvc2U6IDUwMDAwICsgaSAqIDEwICsgNSxcclxuICAgICAgICAgIHZvbHVtZTogMTAwMDAwMFxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBSdW4gaGFybW9uaXphdGlvbiBtdWx0aXBsZSB0aW1lcyB3aXRoIHNhbWUgZGF0YVxyXG4gICAgICBjb25zdCBzaWduYWwxID0gaGFybW9uaXphdGlvbkVuZ2luZS5oYXJtb25pemVTaWduYWxzKHRlc3REYXRhKTtcclxuICAgICAgY29uc3Qgc2lnbmFsMiA9IGhhcm1vbml6YXRpb25FbmdpbmUuaGFybW9uaXplU2lnbmFscyh0ZXN0RGF0YSk7XHJcbiAgICAgIGNvbnN0IHNpZ25hbDMgPSBoYXJtb25pemF0aW9uRW5naW5lLmhhcm1vbml6ZVNpZ25hbHModGVzdERhdGEpO1xyXG5cclxuICAgICAgLy8gUmVzdWx0cyBzaG91bGQgYmUgY29uc2lzdGVudFxyXG4gICAgICBpZiAoc2lnbmFsMSAmJiBzaWduYWwyICYmIHNpZ25hbDMpIHtcclxuICAgICAgICBleHBlY3Qoc2lnbmFsMS5vdmVyYWxsU2lnbmFsKS50b0JlKHNpZ25hbDIub3ZlcmFsbFNpZ25hbCk7XHJcbiAgICAgICAgZXhwZWN0KHNpZ25hbDIub3ZlcmFsbFNpZ25hbCkudG9CZShzaWduYWwzLm92ZXJhbGxTaWduYWwpO1xyXG4gICAgICAgIGV4cGVjdChNYXRoLmFicyhzaWduYWwxLnN0cmVuZ3RoIC0gc2lnbmFsMi5zdHJlbmd0aCkpLnRvQmVMZXNzVGhhbigwLjEpO1xyXG4gICAgICAgIGV4cGVjdChNYXRoLmFicyhzaWduYWwxLmNvbmZpZGVuY2UgLSBzaWduYWwyLmNvbmZpZGVuY2UpKS50b0JlTGVzc1RoYW4oMC4xKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29uY3VycmVudCBoYXJtb25pemF0aW9uIHJlcXVlc3RzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICBjb25zdCB0ZXN0RGF0YTogTWFya2V0RGF0YVtdID0gW107XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjU7IGkrKykge1xyXG4gICAgICAgIHRlc3REYXRhLnB1c2goe1xyXG4gICAgICAgICAgc3ltYm9sOiAnQlRDL1VTRFQnLFxyXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZShEYXRlLm5vdygpIC0gKDI1IC0gaSkgKiA2MDAwMCksXHJcbiAgICAgICAgICBvcGVuOiA1MDAwMCArIE1hdGguc2luKGkgKiAwLjEpICogNTAwLFxyXG4gICAgICAgICAgaGlnaDogNTAwMDAgKyBNYXRoLnNpbihpICogMC4xKSAqIDUwMCArIDEwMCxcclxuICAgICAgICAgIGxvdzogNTAwMDAgKyBNYXRoLnNpbihpICogMC4xKSAqIDUwMCAtIDEwMCxcclxuICAgICAgICAgIGNsb3NlOiA1MDAwMCArIE1hdGguc2luKGkgKiAwLjEpICogNTAwICsgMjUsXHJcbiAgICAgICAgICB2b2x1bWU6IDEwMDAwMDBcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gUnVuIG11bHRpcGxlIGhhcm1vbml6YXRpb25zIGNvbmN1cnJlbnRseVxyXG4gICAgICBjb25zdCBwcm9taXNlcyA9IEFycmF5KDUpLmZpbGwobnVsbCkubWFwKCgpID0+IFxyXG4gICAgICAgIFByb21pc2UucmVzb2x2ZShoYXJtb25pemF0aW9uRW5naW5lLmhhcm1vbml6ZVNpZ25hbHModGVzdERhdGEpKVxyXG4gICAgICApO1xyXG5cclxuICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTtcclxuICAgICAgXHJcbiAgICAgIC8vIEFsbCBzaG91bGQgY29tcGxldGUgc3VjY2Vzc2Z1bGx5XHJcbiAgICAgIHJlc3VsdHMuZm9yRWFjaChyZXN1bHQgPT4ge1xyXG4gICAgICAgIGlmIChyZXN1bHQpIHtcclxuICAgICAgICAgIGV4cGVjdChyZXN1bHQub3ZlcmFsbFNpZ25hbCkudG9NYXRjaCgvXihCVVl8U0VMTHxIT0xEKSQvKTtcclxuICAgICAgICAgIGV4cGVjdChyZXN1bHQuc3RyZW5ndGgpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XHJcbiAgICAgICAgICBleHBlY3QocmVzdWx0LmNvbmZpZGVuY2UpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KTtcclxuICAgIH0pO1xyXG4gIH0pO1xyXG59KTsiXSwidmVyc2lvbiI6M30=