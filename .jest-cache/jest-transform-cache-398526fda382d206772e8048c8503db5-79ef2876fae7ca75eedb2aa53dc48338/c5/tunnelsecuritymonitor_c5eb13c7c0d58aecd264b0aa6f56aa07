42586257a0cbbd797057356031b8d05d
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.TunnelSecurityMonitor = exports.SecurityEventType = exports.ThreatLevel = void 0;
const events_1 = require("events");
const crypto_1 = require("crypto");
/**
 * Security threat levels
 */
var ThreatLevel;
(function (ThreatLevel) {
    ThreatLevel["LOW"] = "LOW";
    ThreatLevel["MEDIUM"] = "MEDIUM";
    ThreatLevel["HIGH"] = "HIGH";
    ThreatLevel["CRITICAL"] = "CRITICAL";
})(ThreatLevel || (exports.ThreatLevel = ThreatLevel = {}));
/**
 * Security event types
 */
var SecurityEventType;
(function (SecurityEventType) {
    SecurityEventType["UNAUTHORIZED_ACCESS"] = "UNAUTHORIZED_ACCESS";
    SecurityEventType["SUSPICIOUS_TRAFFIC"] = "SUSPICIOUS_TRAFFIC";
    SecurityEventType["TUNNEL_HIJACK_ATTEMPT"] = "TUNNEL_HIJACK_ATTEMPT";
    SecurityEventType["DATA_INTEGRITY_VIOLATION"] = "DATA_INTEGRITY_VIOLATION";
    SecurityEventType["ENCRYPTION_FAILURE"] = "ENCRYPTION_FAILURE";
    SecurityEventType["AUTHENTICATION_FAILURE"] = "AUTHENTICATION_FAILURE";
    SecurityEventType["TRAFFIC_ANOMALY"] = "TRAFFIC_ANOMALY";
    SecurityEventType["CONNECTION_TAMPERING"] = "CONNECTION_TAMPERING";
})(SecurityEventType || (exports.SecurityEventType = SecurityEventType = {}));
/**
 * Tunnel Security Monitor
 * Monitors SSH tunnel security with traffic analysis, intrusion detection, and integrity checking
 */
class TunnelSecurityMonitor extends events_1.EventEmitter {
    logger;
    tunnelManager;
    encryptionService;
    config;
    securityEvents;
    trafficAnalysis;
    intrusionPatterns;
    securityMetrics;
    monitoringIntervals;
    isMonitoring;
    constructor(logger, tunnelManager, encryptionService, config) {
        super();
        this.logger = logger;
        this.tunnelManager = tunnelManager;
        this.encryptionService = encryptionService;
        this.securityEvents = new Map();
        this.trafficAnalysis = new Map();
        this.monitoringIntervals = new Map();
        this.isMonitoring = false;
        // Default configuration
        this.config = {
            enableTrafficMonitoring: true,
            enableIntrusionDetection: true,
            enableDataIntegrityChecking: true,
            trafficAnalysisInterval: 30000, // 30 seconds
            maxAnomalyScore: 70,
            enableAutoResponse: true,
            threatResponseTimeout: 10000,
            eventRetentionPeriod: 7 * 24 * 60 * 60 * 1000, // 7 days
            ...config
        };
        // Initialize security metrics
        this.securityMetrics = {
            totalEvents: 0,
            eventsByType: new Map(),
            eventsByThreatLevel: new Map(),
            averageAnomalyScore: 0,
            integrityViolations: 0,
            resolvedEvents: 0,
            activeThreats: 0,
            lastSecurityScan: new Date(),
            systemSecurityScore: 100
        };
        // Initialize intrusion detection patterns
        this.initializeIntrusionPatterns();
        this.setupEventListeners();
        this.logger.info('Tunnel Security Monitor initialized', this.config);
    }
    /**
     * Start security monitoring
     */
    startMonitoring() {
        if (this.isMonitoring) {
            this.logger.warn('Security monitoring is already running');
            return;
        }
        this.isMonitoring = true;
        this.logger.info('Starting tunnel security monitoring');
        // Monitor existing connections
        const connections = this.tunnelManager.getAllConnections();
        for (const connection of connections) {
            this.startMonitoringConnection(connection.id);
        }
        // Start periodic security scans
        this.startPeriodicSecurityScans();
        this.emit('securityMonitoringStarted');
    }
    /**
     * Stop security monitoring
     */
    stopMonitoring() {
        if (!this.isMonitoring) {
            this.logger.warn('Security monitoring is not running');
            return;
        }
        this.isMonitoring = false;
        this.logger.info('Stopping tunnel security monitoring');
        // Clear all monitoring intervals
        for (const [connectionId, interval] of this.monitoringIntervals.entries()) {
            clearInterval(interval);
            this.monitoringIntervals.delete(connectionId);
        }
        this.emit('securityMonitoringStopped');
    }
    /**
     * Start monitoring a specific connection
     *
     * @param connectionId - Connection identifier
     */
    startMonitoringConnection(connectionId) {
        if (this.monitoringIntervals.has(connectionId)) {
            this.logger.debug(`Already monitoring connection: ${connectionId}`);
            return;
        }
        this.logger.info(`Starting security monitoring for connection: ${connectionId}`);
        // Initialize traffic analysis history
        this.trafficAnalysis.set(connectionId, []);
        // Start periodic traffic analysis
        if (this.config.enableTrafficMonitoring) {
            const interval = setInterval(async () => {
                try {
                    await this.analyzeTraffic(connectionId);
                }
                catch (error) {
                    this.logger.error(`Traffic analysis failed for connection ${connectionId}`, error);
                }
            }, this.config.trafficAnalysisInterval);
            this.monitoringIntervals.set(connectionId, interval);
        }
        // Perform initial security scan
        setTimeout(() => this.performSecurityScan(connectionId), 1000);
    }
    /**
     * Stop monitoring a specific connection
     *
     * @param connectionId - Connection identifier
     */
    stopMonitoringConnection(connectionId) {
        const interval = this.monitoringIntervals.get(connectionId);
        if (interval) {
            clearInterval(interval);
            this.monitoringIntervals.delete(connectionId);
            this.logger.info(`Stopped security monitoring for connection: ${connectionId}`);
        }
        // Clean up traffic analysis data
        this.trafficAnalysis.delete(connectionId);
    }
    /**
     * Report security event
     *
     * @param connectionId - Connection identifier
     * @param type - Security event type
     * @param threatLevel - Threat level
     * @param description - Event description
     * @param metadata - Additional metadata
     */
    reportSecurityEvent(connectionId, type, threatLevel, description, metadata = {}) {
        const event = {
            id: this.generateEventId(),
            timestamp: new Date(),
            connectionId,
            type,
            threatLevel,
            description,
            metadata,
            resolved: false,
            responseActions: []
        };
        // Store event
        this.securityEvents.set(event.id, event);
        // Update metrics
        this.updateSecurityMetrics(event);
        // Log event
        this.logger.warn(`Security event detected: ${event.id}`, {
            connectionId,
            type,
            threatLevel,
            description
        });
        // Emit event
        this.emit('securityEvent', event);
        // Trigger automatic response if enabled
        if (this.config.enableAutoResponse) {
            this.triggerAutomaticResponse(event);
        }
        return event;
    }
    /**
     * Resolve security event
     *
     * @param eventId - Event identifier
     * @param responseActions - Actions taken to resolve the event
     */
    resolveSecurityEvent(eventId, responseActions) {
        const event = this.securityEvents.get(eventId);
        if (!event) {
            this.logger.warn(`Security event not found: ${eventId}`);
            return;
        }
        event.resolved = true;
        event.resolvedAt = new Date();
        event.responseActions = responseActions;
        this.securityMetrics.resolvedEvents++;
        this.securityMetrics.activeThreats = Math.max(0, this.securityMetrics.activeThreats - 1);
        this.logger.info(`Security event resolved: ${eventId}`, { responseActions });
        this.emit('securityEventResolved', event);
    }
    /**
     * Get security events
     *
     * @param connectionId - Optional connection filter
     * @param threatLevel - Optional threat level filter
     * @param limit - Maximum number of events to return
     * @returns Array of security events
     */
    getSecurityEvents(connectionId, threatLevel, limit) {
        let events = Array.from(this.securityEvents.values());
        // Apply filters
        if (connectionId) {
            events = events.filter(event => event.connectionId === connectionId);
        }
        if (threatLevel) {
            events = events.filter(event => event.threatLevel === threatLevel);
        }
        // Sort by timestamp (newest first)
        events.sort((a, b) => b.timestamp.getTime() - a.timestamp.getTime());
        // Apply limit
        if (limit) {
            events = events.slice(0, limit);
        }
        return events;
    }
    /**
     * Get traffic analysis data
     *
     * @param connectionId - Connection identifier
     * @param limit - Maximum number of analysis entries to return
     * @returns Array of traffic analysis results
     */
    getTrafficAnalysis(connectionId, limit) {
        const analysis = this.trafficAnalysis.get(connectionId) || [];
        return limit ? analysis.slice(-limit) : [...analysis];
    }
    /**
     * Get security metrics
     *
     * @returns Current security metrics
     */
    getSecurityMetrics() {
        return { ...this.securityMetrics };
    }
    /**
     * Perform comprehensive security scan
     *
     * @param connectionId - Connection identifier
     */
    async performSecurityScan(connectionId) {
        const connection = this.tunnelManager.getConnection(connectionId);
        if (!connection) {
            this.logger.warn(`Connection not found for security scan: ${connectionId}`);
            return;
        }
        try {
            this.logger.debug(`Performing security scan for connection: ${connectionId}`);
            // Check connection integrity
            await this.checkConnectionIntegrity(connection);
            // Analyze traffic patterns
            if (this.config.enableTrafficMonitoring) {
                await this.analyzeTraffic(connectionId);
            }
            // Check for intrusion attempts
            if (this.config.enableIntrusionDetection) {
                await this.detectIntrusions(connection);
            }
            // Verify data integrity
            if (this.config.enableDataIntegrityChecking) {
                await this.checkDataIntegrity(connection);
            }
            this.securityMetrics.lastSecurityScan = new Date();
        }
        catch (error) {
            this.logger.error(`Security scan failed for connection ${connectionId}`, error);
            this.reportSecurityEvent(connectionId, SecurityEventType.ENCRYPTION_FAILURE, ThreatLevel.HIGH, `Security scan failed: ${error instanceof Error ? error.message : String(error)}`, { error: error instanceof Error ? error.stack : String(error) });
        }
    }
    /**
     * Setup event listeners
     */
    setupEventListeners() {
        // Listen for new tunnel connections
        this.tunnelManager.on('tunnelConnected', (connection) => {
            if (this.isMonitoring) {
                this.startMonitoringConnection(connection.id);
            }
        });
        // Listen for tunnel disconnections
        this.tunnelManager.on('tunnelDisconnected', (connection) => {
            this.stopMonitoringConnection(connection.id);
        });
        // Listen for tunnel errors (potential security issues)
        this.tunnelManager.on('tunnelError', (connection, error) => {
            this.reportSecurityEvent(connection.id, SecurityEventType.CONNECTION_TAMPERING, ThreatLevel.MEDIUM, `Tunnel error detected: ${error.message}`, { error: error.stack });
        });
    }
    /**
     * Initialize intrusion detection patterns
     */
    initializeIntrusionPatterns() {
        this.intrusionPatterns = [
            {
                name: 'Port Scanning',
                pattern: /(?:nmap|masscan|zmap)/i,
                threatLevel: ThreatLevel.MEDIUM,
                description: 'Port scanning activity detected',
                responseAction: 'Block source IP'
            },
            {
                name: 'SQL Injection',
                pattern: /(?:union|select|insert|update|delete|drop|create|alter)\s+/i,
                threatLevel: ThreatLevel.HIGH,
                description: 'SQL injection attempt detected',
                responseAction: 'Block connection and alert'
            },
            {
                name: 'SSH Brute Force',
                pattern: /(?:ssh|sshd).*(?:failed|invalid|authentication)/i,
                threatLevel: ThreatLevel.HIGH,
                description: 'SSH brute force attack detected',
                responseAction: 'Implement rate limiting'
            },
            {
                name: 'Malware Signature',
                pattern: /(?:malware|virus|trojan|backdoor|rootkit)/i,
                threatLevel: ThreatLevel.CRITICAL,
                description: 'Malware signature detected',
                responseAction: 'Immediate connection termination'
            },
            {
                name: 'Data Exfiltration',
                pattern: /(?:wget|curl|nc|netcat).*(?:http|ftp|tcp)/i,
                threatLevel: ThreatLevel.HIGH,
                description: 'Potential data exfiltration detected',
                responseAction: 'Monitor and analyze traffic'
            }
        ];
    }
    /**
     * Analyze traffic for security threats
     *
     * @param connectionId - Connection identifier
     */
    async analyzeTraffic(connectionId) {
        const connection = this.tunnelManager.getConnection(connectionId);
        if (!connection)
            return;
        try {
            // Simulate traffic analysis (in real implementation, this would analyze actual network traffic)
            const analysis = {
                connectionId,
                timestamp: new Date(),
                bytesIn: Math.floor(Math.random() * 10000),
                bytesOut: Math.floor(Math.random() * 10000),
                packetsIn: Math.floor(Math.random() * 100),
                packetsOut: Math.floor(Math.random() * 100),
                suspiciousPatterns: [],
                anomalyScore: Math.floor(Math.random() * 100),
                encryptionIntegrity: true,
                dataIntegrityHash: this.calculateDataIntegrityHash(connectionId)
            };
            // Check for suspicious patterns
            analysis.suspiciousPatterns = this.detectSuspiciousPatterns(analysis);
            // Check anomaly score
            if (analysis.anomalyScore > this.config.maxAnomalyScore) {
                this.reportSecurityEvent(connectionId, SecurityEventType.TRAFFIC_ANOMALY, analysis.anomalyScore > 90 ? ThreatLevel.HIGH : ThreatLevel.MEDIUM, `High traffic anomaly score: ${analysis.anomalyScore}`, { analysis });
            }
            // Store analysis
            const analysisHistory = this.trafficAnalysis.get(connectionId) || [];
            analysisHistory.push(analysis);
            // Limit history size
            const maxHistorySize = 1000;
            if (analysisHistory.length > maxHistorySize) {
                analysisHistory.splice(0, analysisHistory.length - maxHistorySize);
            }
            this.trafficAnalysis.set(connectionId, analysisHistory);
            // Update metrics
            this.updateAnomalyMetrics(analysis);
        }
        catch (error) {
            this.logger.error(`Traffic analysis failed for connection ${connectionId}`, error);
        }
    }
    /**
     * Check connection integrity
     *
     * @param connection - Tunnel connection
     */
    async checkConnectionIntegrity(connection) {
        try {
            // Verify connection state
            if (connection.process && connection.process.killed) {
                this.reportSecurityEvent(connection.id, SecurityEventType.CONNECTION_TAMPERING, ThreatLevel.HIGH, 'Connection process was terminated unexpectedly', { processKilled: true });
            }
            // Check for unusual connection parameters
            if (connection.config.localPort < 1024 && process.getuid && process.getuid() !== 0) {
                this.reportSecurityEvent(connection.id, SecurityEventType.UNAUTHORIZED_ACCESS, ThreatLevel.MEDIUM, 'Privileged port usage without root access', { localPort: connection.config.localPort });
            }
        }
        catch (error) {
            this.logger.error(`Connection integrity check failed for ${connection.id}`, error);
        }
    }
    /**
     * Detect intrusion attempts
     *
     * @param connection - Tunnel connection
     */
    async detectIntrusions(connection) {
        try {
            // Simulate log analysis (in real implementation, this would analyze actual logs)
            const logEntries = this.getRecentLogEntries(connection.id);
            for (const logEntry of logEntries) {
                for (const pattern of this.intrusionPatterns) {
                    if (pattern.pattern.test(logEntry)) {
                        this.reportSecurityEvent(connection.id, SecurityEventType.SUSPICIOUS_TRAFFIC, pattern.threatLevel, pattern.description, {
                            pattern: pattern.name,
                            logEntry,
                            responseAction: pattern.responseAction
                        });
                    }
                }
            }
        }
        catch (error) {
            this.logger.error(`Intrusion detection failed for connection ${connection.id}`, error);
        }
    }
    /**
     * Check data integrity
     *
     * @param connection - Tunnel connection
     */
    async checkDataIntegrity(connection) {
        try {
            // Calculate current data integrity hash
            const currentHash = this.calculateDataIntegrityHash(connection.id);
            // Get previous hash from traffic analysis
            const analysisHistory = this.trafficAnalysis.get(connection.id) || [];
            const previousAnalysis = analysisHistory[analysisHistory.length - 1];
            if (previousAnalysis && previousAnalysis.dataIntegrityHash !== currentHash) {
                // Check if the difference is significant
                const hashDifference = this.calculateHashDifference(previousAnalysis.dataIntegrityHash, currentHash);
                if (hashDifference > 0.1) { // 10% threshold
                    this.reportSecurityEvent(connection.id, SecurityEventType.DATA_INTEGRITY_VIOLATION, ThreatLevel.HIGH, 'Data integrity violation detected', {
                        previousHash: previousAnalysis.dataIntegrityHash,
                        currentHash,
                        difference: hashDifference
                    });
                    this.securityMetrics.integrityViolations++;
                }
            }
        }
        catch (error) {
            this.logger.error(`Data integrity check failed for connection ${connection.id}`, error);
        }
    }
    /**
     * Detect suspicious patterns in traffic analysis
     *
     * @param analysis - Traffic analysis data
     * @returns Array of suspicious pattern names
     */
    detectSuspiciousPatterns(analysis) {
        const patterns = [];
        // Check for unusual traffic volume
        if (analysis.bytesIn > 100000 || analysis.bytesOut > 100000) {
            patterns.push('High traffic volume');
        }
        // Check for packet ratio anomalies
        const packetRatio = analysis.packetsIn / Math.max(analysis.packetsOut, 1);
        if (packetRatio > 10 || packetRatio < 0.1) {
            patterns.push('Unusual packet ratio');
        }
        // Check for potential data exfiltration
        if (analysis.bytesOut > analysis.bytesIn * 2) {
            patterns.push('Potential data exfiltration');
        }
        return patterns;
    }
    /**
     * Calculate data integrity hash
     *
     * @param connectionId - Connection identifier
     * @returns Data integrity hash
     */
    calculateDataIntegrityHash(connectionId) {
        const connection = this.tunnelManager.getConnection(connectionId);
        if (!connection)
            return '';
        const data = JSON.stringify({
            connectionId,
            config: connection.config,
            state: connection.state,
            timestamp: Date.now()
        });
        return (0, crypto_1.createHash)('sha256').update(data).digest('hex');
    }
    /**
     * Calculate hash difference percentage
     *
     * @param hash1 - First hash
     * @param hash2 - Second hash
     * @returns Difference percentage (0-1)
     */
    calculateHashDifference(hash1, hash2) {
        if (hash1.length !== hash2.length)
            return 1;
        let differences = 0;
        for (let i = 0; i < hash1.length; i++) {
            if (hash1[i] !== hash2[i]) {
                differences++;
            }
        }
        return differences / hash1.length;
    }
    /**
     * Get recent log entries for analysis
     *
     * @param connectionId - Connection identifier
     * @returns Array of log entries
     */
    getRecentLogEntries(connectionId) {
        // Simulate log entries (in real implementation, this would read actual logs)
        return [
            `SSH connection established for ${connectionId}`,
            `Data transfer initiated for ${connectionId}`,
            `Normal operation for ${connectionId}`,
            // Add some potentially suspicious entries for testing
            ...(Math.random() > 0.8 ? ['SSH authentication failed for user admin'] : []),
            ...(Math.random() > 0.9 ? ['Port scan detected from 192.168.1.100'] : [])
        ];
    }
    /**
     * Trigger automatic response to security event
     *
     * @param event - Security event
     */
    async triggerAutomaticResponse(event) {
        try {
            const responseActions = [];
            switch (event.threatLevel) {
                case ThreatLevel.CRITICAL:
                    // Immediate connection termination
                    await this.tunnelManager.disconnectTunnel(event.connectionId);
                    responseActions.push('Connection terminated');
                    break;
                case ThreatLevel.HIGH:
                    // Enhanced monitoring and alerting
                    responseActions.push('Enhanced monitoring enabled');
                    this.emit('highThreatDetected', event);
                    break;
                case ThreatLevel.MEDIUM:
                    // Increased logging and monitoring
                    responseActions.push('Increased monitoring');
                    break;
                case ThreatLevel.LOW:
                    // Log and continue monitoring
                    responseActions.push('Logged for analysis');
                    break;
            }
            // Update event with response actions
            event.responseActions = responseActions;
            this.logger.info(`Automatic response triggered for event ${event.id}`, { responseActions });
        }
        catch (error) {
            this.logger.error(`Automatic response failed for event ${event.id}`, error);
        }
    }
    /**
     * Start periodic security scans
     */
    startPeriodicSecurityScans() {
        // Perform security scans every 5 minutes
        setInterval(() => {
            const connections = this.tunnelManager.getAllConnections();
            for (const connection of connections) {
                this.performSecurityScan(connection.id);
            }
        }, 5 * 60 * 1000);
    }
    /**
     * Update security metrics
     *
     * @param event - Security event
     */
    updateSecurityMetrics(event) {
        this.securityMetrics.totalEvents++;
        this.securityMetrics.activeThreats++;
        // Update event type counts
        const typeCount = this.securityMetrics.eventsByType.get(event.type) || 0;
        this.securityMetrics.eventsByType.set(event.type, typeCount + 1);
        // Update threat level counts
        const threatCount = this.securityMetrics.eventsByThreatLevel.get(event.threatLevel) || 0;
        this.securityMetrics.eventsByThreatLevel.set(event.threatLevel, threatCount + 1);
        // Calculate system security score
        this.calculateSystemSecurityScore();
    }
    /**
     * Update anomaly metrics
     *
     * @param analysis - Traffic analysis
     */
    updateAnomalyMetrics(analysis) {
        // Calculate running average of anomaly scores
        const allAnalysis = Array.from(this.trafficAnalysis.values()).flat();
        const totalScore = allAnalysis.reduce((sum, a) => sum + a.anomalyScore, 0);
        this.securityMetrics.averageAnomalyScore = allAnalysis.length > 0 ? totalScore / allAnalysis.length : 0;
    }
    /**
     * Calculate system security score
     */
    calculateSystemSecurityScore() {
        let score = 100;
        // Deduct points for active threats
        score -= this.securityMetrics.activeThreats * 10;
        // Deduct points for high anomaly scores
        if (this.securityMetrics.averageAnomalyScore > 70) {
            score -= (this.securityMetrics.averageAnomalyScore - 70) * 0.5;
        }
        // Deduct points for integrity violations
        score -= this.securityMetrics.integrityViolations * 5;
        // Deduct points for critical events
        const criticalEvents = this.securityMetrics.eventsByThreatLevel.get(ThreatLevel.CRITICAL) || 0;
        score -= criticalEvents * 20;
        this.securityMetrics.systemSecurityScore = Math.max(0, Math.min(100, score));
    }
    /**
     * Generate unique event ID
     *
     * @returns Unique event identifier
     */
    generateEventId() {
        return `sec_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }
    /**
     * Cleanup security monitor resources
     */
    cleanup() {
        this.stopMonitoring();
        // Clean up old events
        const cutoffTime = Date.now() - this.config.eventRetentionPeriod;
        for (const [eventId, event] of this.securityEvents.entries()) {
            if (event.timestamp.getTime() < cutoffTime) {
                this.securityEvents.delete(eventId);
            }
        }
        this.trafficAnalysis.clear();
        this.logger.info('Tunnel security monitor cleanup completed');
    }
}
exports.TunnelSecurityMonitor = TunnelSecurityMonitor;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxOaWNrXFxEZXNrdG9wXFxTbW9vdGhTYWlsXFxzcmNcXGluZnJhc3RydWN0dXJlXFx0dW5uZWwtc2VjdXJpdHktbW9uaXRvci50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSxtQ0FBc0M7QUFDdEMsbUNBQWdEO0FBS2hEOztHQUVHO0FBQ0gsSUFBWSxXQUtYO0FBTEQsV0FBWSxXQUFXO0lBQ3JCLDBCQUFXLENBQUE7SUFDWCxnQ0FBaUIsQ0FBQTtJQUNqQiw0QkFBYSxDQUFBO0lBQ2Isb0NBQXFCLENBQUE7QUFDdkIsQ0FBQyxFQUxXLFdBQVcsMkJBQVgsV0FBVyxRQUt0QjtBQUVEOztHQUVHO0FBQ0gsSUFBWSxpQkFTWDtBQVRELFdBQVksaUJBQWlCO0lBQzNCLGdFQUEyQyxDQUFBO0lBQzNDLDhEQUF5QyxDQUFBO0lBQ3pDLG9FQUErQyxDQUFBO0lBQy9DLDBFQUFxRCxDQUFBO0lBQ3JELDhEQUF5QyxDQUFBO0lBQ3pDLHNFQUFpRCxDQUFBO0lBQ2pELHdEQUFtQyxDQUFBO0lBQ25DLGtFQUE2QyxDQUFBO0FBQy9DLENBQUMsRUFUVyxpQkFBaUIsaUNBQWpCLGlCQUFpQixRQVM1QjtBQXFGRDs7O0dBR0c7QUFDSCxNQUFhLHFCQUFzQixTQUFRLHFCQUFZO0lBQzdDLE1BQU0sQ0FBUztJQUNmLGFBQWEsQ0FBbUI7SUFDaEMsaUJBQWlCLENBQW9CO0lBQ3JDLE1BQU0sQ0FBd0I7SUFDOUIsY0FBYyxDQUE2QjtJQUMzQyxlQUFlLENBQWlDO0lBQ2hELGlCQUFpQixDQUFxQjtJQUN0QyxlQUFlLENBQWtCO0lBQ2pDLG1CQUFtQixDQUE4QjtJQUNqRCxZQUFZLENBQVU7SUFFOUIsWUFDRSxNQUFjLEVBQ2QsYUFBK0IsRUFDL0IsaUJBQW9DLEVBQ3BDLE1BQXVDO1FBRXZDLEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7UUFDbkMsSUFBSSxDQUFDLGlCQUFpQixHQUFH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S0FBSyxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsR0FBRyxVQUFVLEVBQUUsQ0FBQztnQkFDM0MsSUFBSSxDQUFDLGNBQWMsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDdEMsQ0FBQztRQUNILENBQUM7UUFFRCxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssRUFBRSxDQUFDO1FBQzdCLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLDJDQUEyQyxDQUFDLENBQUM7SUFDaEUsQ0FBQztDQUNGO0FBN3hCRCxzREE2eEJDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcTmlja1xcRGVza3RvcFxcU21vb3RoU2FpbFxcc3JjXFxpbmZyYXN0cnVjdHVyZVxcdHVubmVsLXNlY3VyaXR5LW1vbml0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcclxuaW1wb3J0IHsgY3JlYXRlSGFzaCwgY3JlYXRlSG1hYyB9IGZyb20gJ2NyeXB0byc7XHJcbmltcG9ydCB7IExvZ2dlciB9IGZyb20gJy4uL2NvcmUvbG9nZ2luZy9sb2dnZXInO1xyXG5pbXBvcnQgeyBTU0hUdW5uZWxNYW5hZ2VyLCBUdW5uZWxDb25uZWN0aW9uIH0gZnJvbSAnLi9zc2gtdHVubmVsLW1hbmFnZXInO1xyXG5pbXBvcnQgeyBFbmNyeXB0aW9uU2VydmljZSB9IGZyb20gJy4uL3NlY3VyaXR5L2VuY3J5cHRpb24tc2VydmljZSc7XHJcblxyXG4vKipcclxuICogU2VjdXJpdHkgdGhyZWF0IGxldmVsc1xyXG4gKi9cclxuZXhwb3J0IGVudW0gVGhyZWF0TGV2ZWwge1xyXG4gIExPVyA9ICdMT1cnLFxyXG4gIE1FRElVTSA9ICdNRURJVU0nLFxyXG4gIEhJR0ggPSAnSElHSCcsXHJcbiAgQ1JJVElDQUwgPSAnQ1JJVElDQUwnXHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZWN1cml0eSBldmVudCB0eXBlc1xyXG4gKi9cclxuZXhwb3J0IGVudW0gU2VjdXJpdHlFdmVudFR5cGUge1xyXG4gIFVOQVVUSE9SSVpFRF9BQ0NFU1MgPSAnVU5BVVRIT1JJWkVEX0FDQ0VTUycsXHJcbiAgU1VTUElDSU9VU19UUkFGRklDID0gJ1NVU1BJQ0lPVVNfVFJBRkZJQycsXHJcbiAgVFVOTkVMX0hJSkFDS19BVFRFTVBUID0gJ1RVTk5FTF9ISUpBQ0tfQVRURU1QVCcsXHJcbiAgREFUQV9JTlRFR1JJVFlfVklPTEFUSU9OID0gJ0RBVEFfSU5URUdSSVRZX1ZJT0xBVElPTicsXHJcbiAgRU5DUllQVElPTl9GQUlMVVJFID0gJ0VOQ1JZUFRJT05fRkFJTFVSRScsXHJcbiAgQVVUSEVOVElDQVRJT05fRkFJTFVSRSA9ICdBVVRIRU5USUNBVElPTl9GQUlMVVJFJyxcclxuICBUUkFGRklDX0FOT01BTFkgPSAnVFJBRkZJQ19BTk9NQUxZJyxcclxuICBDT05ORUNUSU9OX1RBTVBFUklORyA9ICdDT05ORUNUSU9OX1RBTVBFUklORydcclxufVxyXG5cclxuLyoqXHJcbiAqIFNlY3VyaXR5IGV2ZW50IGluZm9ybWF0aW9uXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIFNlY3VyaXR5RXZlbnQge1xyXG4gIGlkOiBzdHJpbmc7XHJcbiAgdGltZXN0YW1wOiBEYXRlO1xyXG4gIGNvbm5lY3Rpb25JZDogc3RyaW5nO1xyXG4gIHR5cGU6IFNlY3VyaXR5RXZlbnRUeXBlO1xyXG4gIHRocmVhdExldmVsOiBUaHJlYXRMZXZlbDtcclxuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xyXG4gIHNvdXJjZUlQPzogc3RyaW5nO1xyXG4gIHRhcmdldElQPzogc3RyaW5nO1xyXG4gIGRhdGFTaXplPzogbnVtYmVyO1xyXG4gIG1ldGFkYXRhOiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xyXG4gIHJlc29sdmVkOiBib29sZWFuO1xyXG4gIHJlc29sdmVkQXQ/OiBEYXRlO1xyXG4gIHJlc3BvbnNlQWN0aW9uczogc3RyaW5nW107XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBUcmFmZmljIGFuYWx5c2lzIHJlc3VsdFxyXG4gKi9cclxuZXhwb3J0IGludGVyZmFjZSBUcmFmZmljQW5hbHlzaXMge1xyXG4gIGNvbm5lY3Rpb25JZDogc3RyaW5nO1xyXG4gIHRpbWVzdGFtcDogRGF0ZTtcclxuICBieXRlc0luOiBudW1iZXI7XHJcbiAgYnl0ZXNPdXQ6IG51bWJlcjtcclxuICBwYWNrZXRzSW46IG51bWJlcjtcclxuICBwYWNrZXRzT3V0OiBudW1iZXI7XHJcbiAgc3VzcGljaW91c1BhdHRlcm5zOiBzdHJpbmdbXTtcclxuICBhbm9tYWx5U2NvcmU6IG51bWJlcjsgLy8gMC0xMDBcclxuICBlbmNyeXB0aW9uSW50ZWdyaXR5OiBib29sZWFuO1xyXG4gIGRhdGFJbnRlZ3JpdHlIYXNoOiBzdHJpbmc7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBTZWN1cml0eSBtb25pdG9yaW5nIGNvbmZpZ3VyYXRpb25cclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgU2VjdXJpdHlNb25pdG9yQ29uZmlnIHtcclxuICAvKiogRW5hYmxlIHRyYWZmaWMgbW9uaXRvcmluZyAqL1xyXG4gIGVuYWJsZVRyYWZmaWNNb25pdG9yaW5nOiBib29sZWFuO1xyXG4gIC8qKiBFbmFibGUgaW50cnVzaW9uIGRldGVjdGlvbiAqL1xyXG4gIGVuYWJsZUludHJ1c2lvbkRldGVjdGlvbjogYm9vbGVhbjtcclxuICAvKiogRW5hYmxlIGRhdGEgaW50ZWdyaXR5IGNoZWNraW5nICovXHJcbiAgZW5hYmxlRGF0YUludGVncml0eUNoZWNraW5nOiBib29sZWFuO1xyXG4gIC8qKiBUcmFmZmljIGFuYWx5c2lzIGludGVydmFsIGluIG1pbGxpc2Vjb25kcyAqL1xyXG4gIHRyYWZmaWNBbmFseXNpc0ludGVydmFsOiBudW1iZXI7XHJcbiAgLyoqIE1heGltdW0gYWxsb3dlZCB0cmFmZmljIGFub21hbHkgc2NvcmUgKi9cclxuICBtYXhBbm9tYWx5U2NvcmU6IG51bWJlcjtcclxuICAvKiogRW5hYmxlIGF1dG9tYXRpYyB0aHJlYXQgcmVzcG9uc2UgKi9cclxuICBlbmFibGVBdXRvUmVzcG9uc2U6IGJvb2xlYW47XHJcbiAgLyoqIFRocmVhdCByZXNwb25zZSB0aW1lb3V0IGluIG1pbGxpc2Vjb25kcyAqL1xyXG4gIHRocmVhdFJlc3BvbnNlVGltZW91dDogbnVtYmVyO1xyXG4gIC8qKiBTZWN1cml0eSBldmVudCByZXRlbnRpb24gcGVyaW9kIGluIG1pbGxpc2Vjb25kcyAqL1xyXG4gIGV2ZW50UmV0ZW50aW9uUGVyaW9kOiBudW1iZXI7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBJbnRydXNpb24gZGV0ZWN0aW9uIHBhdHRlcm5zXHJcbiAqL1xyXG5leHBvcnQgaW50ZXJmYWNlIEludHJ1c2lvblBhdHRlcm4ge1xyXG4gIG5hbWU6IHN0cmluZztcclxuICBwYXR0ZXJuOiBSZWdFeHA7XHJcbiAgdGhyZWF0TGV2ZWw6IFRocmVhdExldmVsO1xyXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XHJcbiAgcmVzcG9uc2VBY3Rpb246IHN0cmluZztcclxufVxyXG5cclxuLyoqXHJcbiAqIFNlY3VyaXR5IG1ldHJpY3NcclxuICovXHJcbmV4cG9ydCBpbnRlcmZhY2UgU2VjdXJpdHlNZXRyaWNzIHtcclxuICB0b3RhbEV2ZW50czogbnVtYmVyO1xyXG4gIGV2ZW50c0J5VHlwZTogTWFwPFNlY3VyaXR5RXZlbnRUeXBlLCBudW1iZXI+O1xyXG4gIGV2ZW50c0J5VGhyZWF0TGV2ZWw6IE1hcDxUaHJlYXRMZXZlbCwgbnVtYmVyPjtcclxuICBhdmVyYWdlQW5vbWFseVNjb3JlOiBudW1iZXI7XHJcbiAgaW50ZWdyaXR5VmlvbGF0aW9uczogbnVtYmVyO1xyXG4gIHJlc29sdmVkRXZlbnRzOiBudW1iZXI7XHJcbiAgYWN0aXZlVGhyZWF0czogbnVtYmVyO1xyXG4gIGxhc3RTZWN1cml0eVNjYW46IERhdGU7XHJcbiAgc3lzdGVtU2VjdXJpdHlTY29yZTogbnVtYmVyOyAvLyAwLTEwMFxyXG59XHJcblxyXG4vKipcclxuICogVHVubmVsIFNlY3VyaXR5IE1vbml0b3JcclxuICogTW9uaXRvcnMgU1NIIHR1bm5lbCBzZWN1cml0eSB3aXRoIHRyYWZmaWMgYW5hbHlzaXMsIGludHJ1c2lvbiBkZXRlY3Rpb24sIGFuZCBpbnRlZ3JpdHkgY2hlY2tpbmdcclxuICovXHJcbmV4cG9ydCBjbGFzcyBUdW5uZWxTZWN1cml0eU1vbml0b3IgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xyXG4gIHByaXZhdGUgbG9nZ2VyOiBMb2dnZXI7XHJcbiAgcHJpdmF0ZSB0dW5uZWxNYW5hZ2VyOiBTU0hUdW5uZWxNYW5hZ2VyO1xyXG4gIHByaXZhdGUgZW5jcnlwdGlvblNlcnZpY2U6IEVuY3J5cHRpb25TZXJ2aWNlO1xyXG4gIHByaXZhdGUgY29uZmlnOiBTZWN1cml0eU1vbml0b3JDb25maWc7XHJcbiAgcHJpdmF0ZSBzZWN1cml0eUV2ZW50czogTWFwPHN0cmluZywgU2VjdXJpdHlFdmVudD47XHJcbiAgcHJpdmF0ZSB0cmFmZmljQW5hbHlzaXM6IE1hcDxzdHJpbmcsIFRyYWZmaWNBbmFseXNpc1tdPjtcclxuICBwcml2YXRlIGludHJ1c2lvblBhdHRlcm5zOiBJbnRydXNpb25QYXR0ZXJuW107XHJcbiAgcHJpdmF0ZSBzZWN1cml0eU1ldHJpY3M6IFNlY3VyaXR5TWV0cmljcztcclxuICBwcml2YXRlIG1vbml0b3JpbmdJbnRlcnZhbHM6IE1hcDxzdHJpbmcsIE5vZGVKUy5UaW1lb3V0PjtcclxuICBwcml2YXRlIGlzTW9uaXRvcmluZzogYm9vbGVhbjtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBsb2dnZXI6IExvZ2dlcixcclxuICAgIHR1bm5lbE1hbmFnZXI6IFNTSFR1bm5lbE1hbmFnZXIsXHJcbiAgICBlbmNyeXB0aW9uU2VydmljZTogRW5jcnlwdGlvblNlcnZpY2UsXHJcbiAgICBjb25maWc/OiBQYXJ0aWFsPFNlY3VyaXR5TW9uaXRvckNvbmZpZz5cclxuICApIHtcclxuICAgIHN1cGVyKCk7XHJcbiAgICB0aGlzLmxvZ2dlciA9IGxvZ2dlcjtcclxuICAgIHRoaXMudHVubmVsTWFuYWdlciA9IHR1bm5lbE1hbmFnZXI7XHJcbiAgICB0aGlzLmVuY3J5cHRpb25TZXJ2aWNlID0gZW5jcnlwdGlvblNlcnZpY2U7XHJcbiAgICB0aGlzLnNlY3VyaXR5RXZlbnRzID0gbmV3IE1hcCgpO1xyXG4gICAgdGhpcy50cmFmZmljQW5hbHlzaXMgPSBuZXcgTWFwKCk7XHJcbiAgICB0aGlzLm1vbml0b3JpbmdJbnRlcnZhbHMgPSBuZXcgTWFwKCk7XHJcbiAgICB0aGlzLmlzTW9uaXRvcmluZyA9IGZhbHNlO1xyXG5cclxuICAgIC8vIERlZmF1bHQgY29uZmlndXJhdGlvblxyXG4gICAgdGhpcy5jb25maWcgPSB7XHJcbiAgICAgIGVuYWJsZVRyYWZmaWNNb25pdG9yaW5nOiB0cnVlLFxyXG4gICAgICBlbmFibGVJbnRydXNpb25EZXRlY3Rpb246IHRydWUsXHJcbiAgICAgIGVuYWJsZURhdGFJbnRlZ3JpdHlDaGVja2luZzogdHJ1ZSxcclxuICAgICAgdHJhZmZpY0FuYWx5c2lzSW50ZXJ2YWw6IDMwMDAwLCAvLyAzMCBzZWNvbmRzXHJcbiAgICAgIG1heEFub21hbHlTY29yZTogNzAsXHJcbiAgICAgIGVuYWJsZUF1dG9SZXNwb25zZTogdHJ1ZSxcclxuICAgICAgdGhyZWF0UmVzcG9uc2VUaW1lb3V0OiAxMDAwMCxcclxuICAgICAgZXZlbnRSZXRlbnRpb25QZXJpb2Q6IDcgKiAyNCAqIDYwICogNjAgKiAxMDAwLCAvLyA3IGRheXNcclxuICAgICAgLi4uY29uZmlnXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEluaXRpYWxpemUgc2VjdXJpdHkgbWV0cmljc1xyXG4gICAgdGhpcy5zZWN1cml0eU1ldHJpY3MgPSB7XHJcbiAgICAgIHRvdGFsRXZlbnRzOiAwLFxyXG4gICAgICBldmVudHNCeVR5cGU6IG5ldyBNYXAoKSxcclxuICAgICAgZXZlbnRzQnlUaHJlYXRMZXZlbDogbmV3IE1hcCgpLFxyXG4gICAgICBhdmVyYWdlQW5vbWFseVNjb3JlOiAwLFxyXG4gICAgICBpbnRlZ3JpdHlWaW9sYXRpb25zOiAwLFxyXG4gICAgICByZXNvbHZlZEV2ZW50czogMCxcclxuICAgICAgYWN0aXZlVGhyZWF0czogMCxcclxuICAgICAgbGFzdFNlY3VyaXR5U2NhbjogbmV3IERhdGUoKSxcclxuICAgICAgc3lzdGVtU2VjdXJpdHlTY29yZTogMTAwXHJcbiAgICB9O1xyXG5cclxuICAgIC8vIEluaXRpYWxpemUgaW50cnVzaW9uIGRldGVjdGlvbiBwYXR0ZXJuc1xyXG4gICAgdGhpcy5pbml0aWFsaXplSW50cnVzaW9uUGF0dGVybnMoKTtcclxuXHJcbiAgICB0aGlzLnNldHVwRXZlbnRMaXN0ZW5lcnMoKTtcclxuICAgIHRoaXMubG9nZ2VyLmluZm8oJ1R1bm5lbCBTZWN1cml0eSBNb25pdG9yIGluaXRpYWxpemVkJywgdGhpcy5jb25maWcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgc2VjdXJpdHkgbW9uaXRvcmluZ1xyXG4gICAqL1xyXG4gIHN0YXJ0TW9uaXRvcmluZygpOiB2b2lkIHtcclxuICAgIGlmICh0aGlzLmlzTW9uaXRvcmluZykge1xyXG4gICAgICB0aGlzLmxvZ2dlci53YXJuKCdTZWN1cml0eSBtb25pdG9yaW5nIGlzIGFscmVhZHkgcnVubmluZycpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5pc01vbml0b3JpbmcgPSB0cnVlO1xyXG4gICAgdGhpcy5sb2dnZXIuaW5mbygnU3RhcnRpbmcgdHVubmVsIHNlY3VyaXR5IG1vbml0b3JpbmcnKTtcclxuXHJcbiAgICAvLyBNb25pdG9yIGV4aXN0aW5nIGNvbm5lY3Rpb25zXHJcbiAgICBjb25zdCBjb25uZWN0aW9ucyA9IHRoaXMudHVubmVsTWFuYWdlci5nZXRBbGxDb25uZWN0aW9ucygpO1xyXG4gICAgZm9yIChjb25zdCBjb25uZWN0aW9uIG9mIGNvbm5lY3Rpb25zKSB7XHJcbiAgICAgIHRoaXMuc3RhcnRNb25pdG9yaW5nQ29ubmVjdGlvbihjb25uZWN0aW9uLmlkKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBTdGFydCBwZXJpb2RpYyBzZWN1cml0eSBzY2Fuc1xyXG4gICAgdGhpcy5zdGFydFBlcmlvZGljU2VjdXJpdHlTY2FucygpO1xyXG5cclxuICAgIHRoaXMuZW1pdCgnc2VjdXJpdHlNb25pdG9yaW5nU3RhcnRlZCcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RvcCBzZWN1cml0eSBtb25pdG9yaW5nXHJcbiAgICovXHJcbiAgc3RvcE1vbml0b3JpbmcoKTogdm9pZCB7XHJcbiAgICBpZiAoIXRoaXMuaXNNb25pdG9yaW5nKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oJ1NlY3VyaXR5IG1vbml0b3JpbmcgaXMgbm90IHJ1bm5pbmcnKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuaXNNb25pdG9yaW5nID0gZmFsc2U7XHJcbiAgICB0aGlzLmxvZ2dlci5pbmZvKCdTdG9wcGluZyB0dW5uZWwgc2VjdXJpdHkgbW9uaXRvcmluZycpO1xyXG5cclxuICAgIC8vIENsZWFyIGFsbCBtb25pdG9yaW5nIGludGVydmFsc1xyXG4gICAgZm9yIChjb25zdCBbY29ubmVjdGlvbklkLCBpbnRlcnZhbF0gb2YgdGhpcy5tb25pdG9yaW5nSW50ZXJ2YWxzLmVudHJpZXMoKSkge1xyXG4gICAgICBjbGVhckludGVydmFsKGludGVydmFsKTtcclxuICAgICAgdGhpcy5tb25pdG9yaW5nSW50ZXJ2YWxzLmRlbGV0ZShjb25uZWN0aW9uSWQpO1xyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuZW1pdCgnc2VjdXJpdHlNb25pdG9yaW5nU3RvcHBlZCcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgbW9uaXRvcmluZyBhIHNwZWNpZmljIGNvbm5lY3Rpb25cclxuICAgKiBcclxuICAgKiBAcGFyYW0gY29ubmVjdGlvbklkIC0gQ29ubmVjdGlvbiBpZGVudGlmaWVyXHJcbiAgICovXHJcbiAgc3RhcnRNb25pdG9yaW5nQ29ubmVjdGlvbihjb25uZWN0aW9uSWQ6IHN0cmluZyk6IHZvaWQge1xyXG4gICAgaWYgKHRoaXMubW9uaXRvcmluZ0ludGVydmFscy5oYXMoY29ubmVjdGlvbklkKSkge1xyXG4gICAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgQWxyZWFkeSBtb25pdG9yaW5nIGNvbm5lY3Rpb246ICR7Y29ubmVjdGlvbklkfWApO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5sb2dnZXIuaW5mbyhgU3RhcnRpbmcgc2VjdXJpdHkgbW9uaXRvcmluZyBmb3IgY29ubmVjdGlvbjogJHtjb25uZWN0aW9uSWR9YCk7XHJcblxyXG4gICAgLy8gSW5pdGlhbGl6ZSB0cmFmZmljIGFuYWx5c2lzIGhpc3RvcnlcclxuICAgIHRoaXMudHJhZmZpY0FuYWx5c2lzLnNldChjb25uZWN0aW9uSWQsIFtdKTtcclxuXHJcbiAgICAvLyBTdGFydCBwZXJpb2RpYyB0cmFmZmljIGFuYWx5c2lzXHJcbiAgICBpZiAodGhpcy5jb25maWcuZW5hYmxlVHJhZmZpY01vbml0b3JpbmcpIHtcclxuICAgICAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgdHJ5IHtcclxuICAgICAgICAgIGF3YWl0IHRoaXMuYW5hbHl6ZVRyYWZmaWMoY29ubmVjdGlvbklkKTtcclxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYFRyYWZmaWMgYW5hbHlzaXMgZmFpbGVkIGZvciBjb25uZWN0aW9uICR7Y29ubmVjdGlvbklkfWAsIGVycm9yKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sIHRoaXMuY29uZmlnLnRyYWZmaWNBbmFseXNpc0ludGVydmFsKTtcclxuXHJcbiAgICAgIHRoaXMubW9uaXRvcmluZ0ludGVydmFscy5zZXQoY29ubmVjdGlvbklkLCBpbnRlcnZhbCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gUGVyZm9ybSBpbml0aWFsIHNlY3VyaXR5IHNjYW5cclxuICAgIHNldFRpbWVvdXQoKCkgPT4gdGhpcy5wZXJmb3JtU2VjdXJpdHlTY2FuKGNvbm5lY3Rpb25JZCksIDEwMDApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RvcCBtb25pdG9yaW5nIGEgc3BlY2lmaWMgY29ubmVjdGlvblxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBjb25uZWN0aW9uSWQgLSBDb25uZWN0aW9uIGlkZW50aWZpZXJcclxuICAgKi9cclxuICBzdG9wTW9uaXRvcmluZ0Nvbm5lY3Rpb24oY29ubmVjdGlvbklkOiBzdHJpbmcpOiB2b2lkIHtcclxuICAgIGNvbnN0IGludGVydmFsID0gdGhpcy5tb25pdG9yaW5nSW50ZXJ2YWxzLmdldChjb25uZWN0aW9uSWQpO1xyXG4gICAgaWYgKGludGVydmFsKSB7XHJcbiAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xyXG4gICAgICB0aGlzLm1vbml0b3JpbmdJbnRlcnZhbHMuZGVsZXRlKGNvbm5lY3Rpb25JZCk7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oYFN0b3BwZWQgc2VjdXJpdHkgbW9uaXRvcmluZyBmb3IgY29ubmVjdGlvbjogJHtjb25uZWN0aW9uSWR9YCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2xlYW4gdXAgdHJhZmZpYyBhbmFseXNpcyBkYXRhXHJcbiAgICB0aGlzLnRyYWZmaWNBbmFseXNpcy5kZWxldGUoY29ubmVjdGlvbklkKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlcG9ydCBzZWN1cml0eSBldmVudFxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBjb25uZWN0aW9uSWQgLSBDb25uZWN0aW9uIGlkZW50aWZpZXJcclxuICAgKiBAcGFyYW0gdHlwZSAtIFNlY3VyaXR5IGV2ZW50IHR5cGVcclxuICAgKiBAcGFyYW0gdGhyZWF0TGV2ZWwgLSBUaHJlYXQgbGV2ZWxcclxuICAgKiBAcGFyYW0gZGVzY3JpcHRpb24gLSBFdmVudCBkZXNjcmlwdGlvblxyXG4gICAqIEBwYXJhbSBtZXRhZGF0YSAtIEFkZGl0aW9uYWwgbWV0YWRhdGFcclxuICAgKi9cclxuICByZXBvcnRTZWN1cml0eUV2ZW50KFxyXG4gICAgY29ubmVjdGlvbklkOiBzdHJpbmcsXHJcbiAgICB0eXBlOiBTZWN1cml0eUV2ZW50VHlwZSxcclxuICAgIHRocmVhdExldmVsOiBUaHJlYXRMZXZlbCxcclxuICAgIGRlc2NyaXB0aW9uOiBzdHJpbmcsXHJcbiAgICBtZXRhZGF0YTogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9XHJcbiAgKTogU2VjdXJpdHlFdmVudCB7XHJcbiAgICBjb25zdCBldmVudDogU2VjdXJpdHlFdmVudCA9IHtcclxuICAgICAgaWQ6IHRoaXMuZ2VuZXJhdGVFdmVudElkKCksXHJcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcclxuICAgICAgY29ubmVjdGlvbklkLFxyXG4gICAgICB0eXBlLFxyXG4gICAgICB0aHJlYXRMZXZlbCxcclxuICAgICAgZGVzY3JpcHRpb24sXHJcbiAgICAgIG1ldGFkYXRhLFxyXG4gICAgICByZXNvbHZlZDogZmFsc2UsXHJcbiAgICAgIHJlc3BvbnNlQWN0aW9uczogW11cclxuICAgIH07XHJcblxyXG4gICAgLy8gU3RvcmUgZXZlbnRcclxuICAgIHRoaXMuc2VjdXJpdHlFdmVudHMuc2V0KGV2ZW50LmlkLCBldmVudCk7XHJcblxyXG4gICAgLy8gVXBkYXRlIG1ldHJpY3NcclxuICAgIHRoaXMudXBkYXRlU2VjdXJpdHlNZXRyaWNzKGV2ZW50KTtcclxuXHJcbiAgICAvLyBMb2cgZXZlbnRcclxuICAgIHRoaXMubG9nZ2VyLndhcm4oYFNlY3VyaXR5IGV2ZW50IGRldGVjdGVkOiAke2V2ZW50LmlkfWAsIHtcclxuICAgICAgY29ubmVjdGlvbklkLFxyXG4gICAgICB0eXBlLFxyXG4gICAgICB0aHJlYXRMZXZlbCxcclxuICAgICAgZGVzY3JpcHRpb25cclxuICAgIH0pO1xyXG5cclxuICAgIC8vIEVtaXQgZXZlbnRcclxuICAgIHRoaXMuZW1pdCgnc2VjdXJpdHlFdmVudCcsIGV2ZW50KTtcclxuXHJcbiAgICAvLyBUcmlnZ2VyIGF1dG9tYXRpYyByZXNwb25zZSBpZiBlbmFibGVkXHJcbiAgICBpZiAodGhpcy5jb25maWcuZW5hYmxlQXV0b1Jlc3BvbnNlKSB7XHJcbiAgICAgIHRoaXMudHJpZ2dlckF1dG9tYXRpY1Jlc3BvbnNlKGV2ZW50KTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZXZlbnQ7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXNvbHZlIHNlY3VyaXR5IGV2ZW50XHJcbiAgICogXHJcbiAgICogQHBhcmFtIGV2ZW50SWQgLSBFdmVudCBpZGVudGlmaWVyXHJcbiAgICogQHBhcmFtIHJlc3BvbnNlQWN0aW9ucyAtIEFjdGlvbnMgdGFrZW4gdG8gcmVzb2x2ZSB0aGUgZXZlbnRcclxuICAgKi9cclxuICByZXNvbHZlU2VjdXJpdHlFdmVudChldmVudElkOiBzdHJpbmcsIHJlc3BvbnNlQWN0aW9uczogc3RyaW5nW10pOiB2b2lkIHtcclxuICAgIGNvbnN0IGV2ZW50ID0gdGhpcy5zZWN1cml0eUV2ZW50cy5nZXQoZXZlbnRJZCk7XHJcbiAgICBpZiAoIWV2ZW50KSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLndhcm4oYFNlY3VyaXR5IGV2ZW50IG5vdCBmb3VuZDogJHtldmVudElkfWApO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgZXZlbnQucmVzb2x2ZWQgPSB0cnVlO1xyXG4gICAgZXZlbnQucmVzb2x2ZWRBdCA9IG5ldyBEYXRlKCk7XHJcbiAgICBldmVudC5yZXNwb25zZUFjdGlvbnMgPSByZXNwb25zZUFjdGlvbnM7XHJcblxyXG4gICAgdGhpcy5zZWN1cml0eU1ldHJpY3MucmVzb2x2ZWRFdmVudHMrKztcclxuICAgIHRoaXMuc2VjdXJpdHlNZXRyaWNzLmFjdGl2ZVRocmVhdHMgPSBNYXRoLm1heCgwLCB0aGlzLnNlY3VyaXR5TWV0cmljcy5hY3RpdmVUaHJlYXRzIC0gMSk7XHJcblxyXG4gICAgdGhpcy5sb2dnZXIuaW5mbyhgU2VjdXJpdHkgZXZlbnQgcmVzb2x2ZWQ6ICR7ZXZlbnRJZH1gLCB7IHJlc3BvbnNlQWN0aW9ucyB9KTtcclxuICAgIHRoaXMuZW1pdCgnc2VjdXJpdHlFdmVudFJlc29sdmVkJywgZXZlbnQpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHNlY3VyaXR5IGV2ZW50c1xyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBjb25uZWN0aW9uSWQgLSBPcHRpb25hbCBjb25uZWN0aW9uIGZpbHRlclxyXG4gICAqIEBwYXJhbSB0aHJlYXRMZXZlbCAtIE9wdGlvbmFsIHRocmVhdCBsZXZlbCBmaWx0ZXJcclxuICAgKiBAcGFyYW0gbGltaXQgLSBNYXhpbXVtIG51bWJlciBvZiBldmVudHMgdG8gcmV0dXJuXHJcbiAgICogQHJldHVybnMgQXJyYXkgb2Ygc2VjdXJpdHkgZXZlbnRzXHJcbiAgICovXHJcbiAgZ2V0U2VjdXJpdHlFdmVudHMoXHJcbiAgICBjb25uZWN0aW9uSWQ/OiBzdHJpbmcsXHJcbiAgICB0aHJlYXRMZXZlbD86IFRocmVhdExldmVsLFxyXG4gICAgbGltaXQ/OiBudW1iZXJcclxuICApOiBTZWN1cml0eUV2ZW50W10ge1xyXG4gICAgbGV0IGV2ZW50cyA9IEFycmF5LmZyb20odGhpcy5zZWN1cml0eUV2ZW50cy52YWx1ZXMoKSk7XHJcblxyXG4gICAgLy8gQXBwbHkgZmlsdGVyc1xyXG4gICAgaWYgKGNvbm5lY3Rpb25JZCkge1xyXG4gICAgICBldmVudHMgPSBldmVudHMuZmlsdGVyKGV2ZW50ID0+IGV2ZW50LmNvbm5lY3Rpb25JZCA9PT0gY29ubmVjdGlvbklkKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhyZWF0TGV2ZWwpIHtcclxuICAgICAgZXZlbnRzID0gZXZlbnRzLmZpbHRlcihldmVudCA9PiBldmVudC50aHJlYXRMZXZlbCA9PT0gdGhyZWF0TGV2ZWwpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIFNvcnQgYnkgdGltZXN0YW1wIChuZXdlc3QgZmlyc3QpXHJcbiAgICBldmVudHMuc29ydCgoYSwgYikgPT4gYi50aW1lc3RhbXAuZ2V0VGltZSgpIC0gYS50aW1lc3RhbXAuZ2V0VGltZSgpKTtcclxuXHJcbiAgICAvLyBBcHBseSBsaW1pdFxyXG4gICAgaWYgKGxpbWl0KSB7XHJcbiAgICAgIGV2ZW50cyA9IGV2ZW50cy5zbGljZSgwLCBsaW1pdCk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGV2ZW50cztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEdldCB0cmFmZmljIGFuYWx5c2lzIGRhdGFcclxuICAgKiBcclxuICAgKiBAcGFyYW0gY29ubmVjdGlvbklkIC0gQ29ubmVjdGlvbiBpZGVudGlmaWVyXHJcbiAgICogQHBhcmFtIGxpbWl0IC0gTWF4aW11bSBudW1iZXIgb2YgYW5hbHlzaXMgZW50cmllcyB0byByZXR1cm5cclxuICAgKiBAcmV0dXJucyBBcnJheSBvZiB0cmFmZmljIGFuYWx5c2lzIHJlc3VsdHNcclxuICAgKi9cclxuICBnZXRUcmFmZmljQW5hbHlzaXMoY29ubmVjdGlvbklkOiBzdHJpbmcsIGxpbWl0PzogbnVtYmVyKTogVHJhZmZpY0FuYWx5c2lzW10ge1xyXG4gICAgY29uc3QgYW5hbHlzaXMgPSB0aGlzLnRyYWZmaWNBbmFseXNpcy5nZXQoY29ubmVjdGlvbklkKSB8fCBbXTtcclxuICAgIHJldHVybiBsaW1pdCA/IGFuYWx5c2lzLnNsaWNlKC1saW1pdCkgOiBbLi4uYW5hbHlzaXNdO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0IHNlY3VyaXR5IG1ldHJpY3NcclxuICAgKiBcclxuICAgKiBAcmV0dXJucyBDdXJyZW50IHNlY3VyaXR5IG1ldHJpY3NcclxuICAgKi9cclxuICBnZXRTZWN1cml0eU1ldHJpY3MoKTogU2VjdXJpdHlNZXRyaWNzIHtcclxuICAgIHJldHVybiB7IC4uLnRoaXMuc2VjdXJpdHlNZXRyaWNzIH07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBQZXJmb3JtIGNvbXByZWhlbnNpdmUgc2VjdXJpdHkgc2NhblxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBjb25uZWN0aW9uSWQgLSBDb25uZWN0aW9uIGlkZW50aWZpZXJcclxuICAgKi9cclxuICBhc3luYyBwZXJmb3JtU2VjdXJpdHlTY2FuKGNvbm5lY3Rpb25JZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICBjb25zdCBjb25uZWN0aW9uID0gdGhpcy50dW5uZWxNYW5hZ2VyLmdldENvbm5lY3Rpb24oY29ubmVjdGlvbklkKTtcclxuICAgIGlmICghY29ubmVjdGlvbikge1xyXG4gICAgICB0aGlzLmxvZ2dlci53YXJuKGBDb25uZWN0aW9uIG5vdCBmb3VuZCBmb3Igc2VjdXJpdHkgc2NhbjogJHtjb25uZWN0aW9uSWR9YCk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgUGVyZm9ybWluZyBzZWN1cml0eSBzY2FuIGZvciBjb25uZWN0aW9uOiAke2Nvbm5lY3Rpb25JZH1gKTtcclxuXHJcbiAgICAgIC8vIENoZWNrIGNvbm5lY3Rpb24gaW50ZWdyaXR5XHJcbiAgICAgIGF3YWl0IHRoaXMuY2hlY2tDb25uZWN0aW9uSW50ZWdyaXR5KGNvbm5lY3Rpb24pO1xyXG5cclxuICAgICAgLy8gQW5hbHl6ZSB0cmFmZmljIHBhdHRlcm5zXHJcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5lbmFibGVUcmFmZmljTW9uaXRvcmluZykge1xyXG4gICAgICAgIGF3YWl0IHRoaXMuYW5hbHl6ZVRyYWZmaWMoY29ubmVjdGlvbklkKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQ2hlY2sgZm9yIGludHJ1c2lvbiBhdHRlbXB0c1xyXG4gICAgICBpZiAodGhpcy5jb25maWcuZW5hYmxlSW50cnVzaW9uRGV0ZWN0aW9uKSB7XHJcbiAgICAgICAgYXdhaXQgdGhpcy5kZXRlY3RJbnRydXNpb25zKGNvbm5lY3Rpb24pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBWZXJpZnkgZGF0YSBpbnRlZ3JpdHlcclxuICAgICAgaWYgKHRoaXMuY29uZmlnLmVuYWJsZURhdGFJbnRlZ3JpdHlDaGVja2luZykge1xyXG4gICAgICAgIGF3YWl0IHRoaXMuY2hlY2tEYXRhSW50ZWdyaXR5KGNvbm5lY3Rpb24pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICB0aGlzLnNlY3VyaXR5TWV0cmljcy5sYXN0U2VjdXJpdHlTY2FuID0gbmV3IERhdGUoKTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgU2VjdXJpdHkgc2NhbiBmYWlsZWQgZm9yIGNvbm5lY3Rpb24gJHtjb25uZWN0aW9uSWR9YCwgZXJyb3IpO1xyXG4gICAgICBcclxuICAgICAgdGhpcy5yZXBvcnRTZWN1cml0eUV2ZW50KFxyXG4gICAgICAgIGNvbm5lY3Rpb25JZCxcclxuICAgICAgICBTZWN1cml0eUV2ZW50VHlwZS5FTkNSWVBUSU9OX0ZBSUxVUkUsXHJcbiAgICAgICAgVGhyZWF0TGV2ZWwuSElHSCxcclxuICAgICAgICBgU2VjdXJpdHkgc2NhbiBmYWlsZWQ6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpfWAsXHJcbiAgICAgICAgeyBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrIDogU3RyaW5nKGVycm9yKSB9XHJcbiAgICAgICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBTZXR1cCBldmVudCBsaXN0ZW5lcnNcclxuICAgKi9cclxuICBwcml2YXRlIHNldHVwRXZlbnRMaXN0ZW5lcnMoKTogdm9pZCB7XHJcbiAgICAvLyBMaXN0ZW4gZm9yIG5ldyB0dW5uZWwgY29ubmVjdGlvbnNcclxuICAgIHRoaXMudHVubmVsTWFuYWdlci5vbigndHVubmVsQ29ubmVjdGVkJywgKGNvbm5lY3Rpb24pID0+IHtcclxuICAgICAgaWYgKHRoaXMuaXNNb25pdG9yaW5nKSB7XHJcbiAgICAgICAgdGhpcy5zdGFydE1vbml0b3JpbmdDb25uZWN0aW9uKGNvbm5lY3Rpb24uaWQpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBMaXN0ZW4gZm9yIHR1bm5lbCBkaXNjb25uZWN0aW9uc1xyXG4gICAgdGhpcy50dW5uZWxNYW5hZ2VyLm9uKCd0dW5uZWxEaXNjb25uZWN0ZWQnLCAoY29ubmVjdGlvbikgPT4ge1xyXG4gICAgICB0aGlzLnN0b3BNb25pdG9yaW5nQ29ubmVjdGlvbihjb25uZWN0aW9uLmlkKTtcclxuICAgIH0pO1xyXG5cclxuICAgIC8vIExpc3RlbiBmb3IgdHVubmVsIGVycm9ycyAocG90ZW50aWFsIHNlY3VyaXR5IGlzc3VlcylcclxuICAgIHRoaXMudHVubmVsTWFuYWdlci5vbigndHVubmVsRXJyb3InLCAoY29ubmVjdGlvbiwgZXJyb3IpID0+IHtcclxuICAgICAgdGhpcy5yZXBvcnRTZWN1cml0eUV2ZW50KFxyXG4gICAgICAgIGNvbm5lY3Rpb24uaWQsXHJcbiAgICAgICAgU2VjdXJpdHlFdmVudFR5cGUuQ09OTkVDVElPTl9UQU1QRVJJTkcsXHJcbiAgICAgICAgVGhyZWF0TGV2ZWwuTUVESVVNLFxyXG4gICAgICAgIGBUdW5uZWwgZXJyb3IgZGV0ZWN0ZWQ6ICR7ZXJyb3IubWVzc2FnZX1gLFxyXG4gICAgICAgIHsgZXJyb3I6IGVycm9yLnN0YWNrIH1cclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogSW5pdGlhbGl6ZSBpbnRydXNpb24gZGV0ZWN0aW9uIHBhdHRlcm5zXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBpbml0aWFsaXplSW50cnVzaW9uUGF0dGVybnMoKTogdm9pZCB7XHJcbiAgICB0aGlzLmludHJ1c2lvblBhdHRlcm5zID0gW1xyXG4gICAgICB7XHJcbiAgICAgICAgbmFtZTogJ1BvcnQgU2Nhbm5pbmcnLFxyXG4gICAgICAgIHBhdHRlcm46IC8oPzpubWFwfG1hc3NjYW58em1hcCkvaSxcclxuICAgICAgICB0aHJlYXRMZXZlbDogVGhyZWF0TGV2ZWwuTUVESVVNLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnUG9ydCBzY2FubmluZyBhY3Rpdml0eSBkZXRlY3RlZCcsXHJcbiAgICAgICAgcmVzcG9uc2VBY3Rpb246ICdCbG9jayBzb3VyY2UgSVAnXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBuYW1lOiAnU1FMIEluamVjdGlvbicsXHJcbiAgICAgICAgcGF0dGVybjogLyg/OnVuaW9ufHNlbGVjdHxpbnNlcnR8dXBkYXRlfGRlbGV0ZXxkcm9wfGNyZWF0ZXxhbHRlcilcXHMrL2ksXHJcbiAgICAgICAgdGhyZWF0TGV2ZWw6IFRocmVhdExldmVsLkhJR0gsXHJcbiAgICAgICAgZGVzY3JpcHRpb246ICdTUUwgaW5qZWN0aW9uIGF0dGVtcHQgZGV0ZWN0ZWQnLFxyXG4gICAgICAgIHJlc3BvbnNlQWN0aW9uOiAnQmxvY2sgY29ubmVjdGlvbiBhbmQgYWxlcnQnXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBuYW1lOiAnU1NIIEJydXRlIEZvcmNlJyxcclxuICAgICAgICBwYXR0ZXJuOiAvKD86c3NofHNzaGQpLiooPzpmYWlsZWR8aW52YWxpZHxhdXRoZW50aWNhdGlvbikvaSxcclxuICAgICAgICB0aHJlYXRMZXZlbDogVGhyZWF0TGV2ZWwuSElHSCxcclxuICAgICAgICBkZXNjcmlwdGlvbjogJ1NTSCBicnV0ZSBmb3JjZSBhdHRhY2sgZGV0ZWN0ZWQnLFxyXG4gICAgICAgIHJlc3BvbnNlQWN0aW9uOiAnSW1wbGVtZW50IHJhdGUgbGltaXRpbmcnXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBuYW1lOiAnTWFsd2FyZSBTaWduYXR1cmUnLFxyXG4gICAgICAgIHBhdHRlcm46IC8oPzptYWx3YXJlfHZpcnVzfHRyb2phbnxiYWNrZG9vcnxyb290a2l0KS9pLFxyXG4gICAgICAgIHRocmVhdExldmVsOiBUaHJlYXRMZXZlbC5DUklUSUNBTCxcclxuICAgICAgICBkZXNjcmlwdGlvbjogJ01hbHdhcmUgc2lnbmF0dXJlIGRldGVjdGVkJyxcclxuICAgICAgICByZXNwb25zZUFjdGlvbjogJ0ltbWVkaWF0ZSBjb25uZWN0aW9uIHRlcm1pbmF0aW9uJ1xyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgbmFtZTogJ0RhdGEgRXhmaWx0cmF0aW9uJyxcclxuICAgICAgICBwYXR0ZXJuOiAvKD86d2dldHxjdXJsfG5jfG5ldGNhdCkuKig/Omh0dHB8ZnRwfHRjcCkvaSxcclxuICAgICAgICB0aHJlYXRMZXZlbDogVGhyZWF0TGV2ZWwuSElHSCxcclxuICAgICAgICBkZXNjcmlwdGlvbjogJ1BvdGVudGlhbCBkYXRhIGV4ZmlsdHJhdGlvbiBkZXRlY3RlZCcsXHJcbiAgICAgICAgcmVzcG9uc2VBY3Rpb246ICdNb25pdG9yIGFuZCBhbmFseXplIHRyYWZmaWMnXHJcbiAgICAgIH1cclxuICAgIF07XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBBbmFseXplIHRyYWZmaWMgZm9yIHNlY3VyaXR5IHRocmVhdHNcclxuICAgKiBcclxuICAgKiBAcGFyYW0gY29ubmVjdGlvbklkIC0gQ29ubmVjdGlvbiBpZGVudGlmaWVyXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBhbmFseXplVHJhZmZpYyhjb25uZWN0aW9uSWQ6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgY29uc3QgY29ubmVjdGlvbiA9IHRoaXMudHVubmVsTWFuYWdlci5nZXRDb25uZWN0aW9uKGNvbm5lY3Rpb25JZCk7XHJcbiAgICBpZiAoIWNvbm5lY3Rpb24pIHJldHVybjtcclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAvLyBTaW11bGF0ZSB0cmFmZmljIGFuYWx5c2lzIChpbiByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIGFuYWx5emUgYWN0dWFsIG5ldHdvcmsgdHJhZmZpYylcclxuICAgICAgY29uc3QgYW5hbHlzaXM6IFRyYWZmaWNBbmFseXNpcyA9IHtcclxuICAgICAgICBjb25uZWN0aW9uSWQsXHJcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxyXG4gICAgICAgIGJ5dGVzSW46IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwKSxcclxuICAgICAgICBieXRlc091dDogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDApLFxyXG4gICAgICAgIHBhY2tldHNJbjogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwKSxcclxuICAgICAgICBwYWNrZXRzT3V0OiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApLFxyXG4gICAgICAgIHN1c3BpY2lvdXNQYXR0ZXJuczogW10sXHJcbiAgICAgICAgYW5vbWFseVNjb3JlOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDApLFxyXG4gICAgICAgIGVuY3J5cHRpb25JbnRlZ3JpdHk6IHRydWUsXHJcbiAgICAgICAgZGF0YUludGVncml0eUhhc2g6IHRoaXMuY2FsY3VsYXRlRGF0YUludGVncml0eUhhc2goY29ubmVjdGlvbklkKVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gQ2hlY2sgZm9yIHN1c3BpY2lvdXMgcGF0dGVybnNcclxuICAgICAgYW5hbHlzaXMuc3VzcGljaW91c1BhdHRlcm5zID0gdGhpcy5kZXRlY3RTdXNwaWNpb3VzUGF0dGVybnMoYW5hbHlzaXMpO1xyXG5cclxuICAgICAgLy8gQ2hlY2sgYW5vbWFseSBzY29yZVxyXG4gICAgICBpZiAoYW5hbHlzaXMuYW5vbWFseVNjb3JlID4gdGhpcy5jb25maWcubWF4QW5vbWFseVNjb3JlKSB7XHJcbiAgICAgICAgdGhpcy5yZXBvcnRTZWN1cml0eUV2ZW50KFxyXG4gICAgICAgICAgY29ubmVjdGlvbklkLFxyXG4gICAgICAgICAgU2VjdXJpdHlFdmVudFR5cGUuVFJBRkZJQ19BTk9NQUxZLFxyXG4gICAgICAgICAgYW5hbHlzaXMuYW5vbWFseVNjb3JlID4gOTAgPyBUaHJlYXRMZXZlbC5ISUdIIDogVGhyZWF0TGV2ZWwuTUVESVVNLFxyXG4gICAgICAgICAgYEhpZ2ggdHJhZmZpYyBhbm9tYWx5IHNjb3JlOiAke2FuYWx5c2lzLmFub21hbHlTY29yZX1gLFxyXG4gICAgICAgICAgeyBhbmFseXNpcyB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gU3RvcmUgYW5hbHlzaXNcclxuICAgICAgY29uc3QgYW5hbHlzaXNIaXN0b3J5ID0gdGhpcy50cmFmZmljQW5hbHlzaXMuZ2V0KGNvbm5lY3Rpb25JZCkgfHwgW107XHJcbiAgICAgIGFuYWx5c2lzSGlzdG9yeS5wdXNoKGFuYWx5c2lzKTtcclxuXHJcbiAgICAgIC8vIExpbWl0IGhpc3Rvcnkgc2l6ZVxyXG4gICAgICBjb25zdCBtYXhIaXN0b3J5U2l6ZSA9IDEwMDA7XHJcbiAgICAgIGlmIChhbmFseXNpc0hpc3RvcnkubGVuZ3RoID4gbWF4SGlzdG9yeVNpemUpIHtcclxuICAgICAgICBhbmFseXNpc0hpc3Rvcnkuc3BsaWNlKDAsIGFuYWx5c2lzSGlzdG9yeS5sZW5ndGggLSBtYXhIaXN0b3J5U2l6ZSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMudHJhZmZpY0FuYWx5c2lzLnNldChjb25uZWN0aW9uSWQsIGFuYWx5c2lzSGlzdG9yeSk7XHJcblxyXG4gICAgICAvLyBVcGRhdGUgbWV0cmljc1xyXG4gICAgICB0aGlzLnVwZGF0ZUFub21hbHlNZXRyaWNzKGFuYWx5c2lzKTtcclxuXHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICB0aGlzLmxvZ2dlci5lcnJvcihgVHJhZmZpYyBhbmFseXNpcyBmYWlsZWQgZm9yIGNvbm5lY3Rpb24gJHtjb25uZWN0aW9uSWR9YCwgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgY29ubmVjdGlvbiBpbnRlZ3JpdHlcclxuICAgKiBcclxuICAgKiBAcGFyYW0gY29ubmVjdGlvbiAtIFR1bm5lbCBjb25uZWN0aW9uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBjaGVja0Nvbm5lY3Rpb25JbnRlZ3JpdHkoY29ubmVjdGlvbjogVHVubmVsQ29ubmVjdGlvbik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gVmVyaWZ5IGNvbm5lY3Rpb24gc3RhdGVcclxuICAgICAgaWYgKGNvbm5lY3Rpb24ucHJvY2VzcyAmJiBjb25uZWN0aW9uLnByb2Nlc3Mua2lsbGVkKSB7XHJcbiAgICAgICAgdGhpcy5yZXBvcnRTZWN1cml0eUV2ZW50KFxyXG4gICAgICAgICAgY29ubmVjdGlvbi5pZCxcclxuICAgICAgICAgIFNlY3VyaXR5RXZlbnRUeXBlLkNPTk5FQ1RJT05fVEFNUEVSSU5HLFxyXG4gICAgICAgICAgVGhyZWF0TGV2ZWwuSElHSCxcclxuICAgICAgICAgICdDb25uZWN0aW9uIHByb2Nlc3Mgd2FzIHRlcm1pbmF0ZWQgdW5leHBlY3RlZGx5JyxcclxuICAgICAgICAgIHsgcHJvY2Vzc0tpbGxlZDogdHJ1ZSB9XHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gQ2hlY2sgZm9yIHVudXN1YWwgY29ubmVjdGlvbiBwYXJhbWV0ZXJzXHJcbiAgICAgIGlmIChjb25uZWN0aW9uLmNvbmZpZy5sb2NhbFBvcnQgPCAxMDI0ICYmIHByb2Nlc3MuZ2V0dWlkICYmIHByb2Nlc3MuZ2V0dWlkKCkgIT09IDApIHtcclxuICAgICAgICB0aGlzLnJlcG9ydFNlY3VyaXR5RXZlbnQoXHJcbiAgICAgICAgICBjb25uZWN0aW9uLmlkLFxyXG4gICAgICAgICAgU2VjdXJpdHlFdmVudFR5cGUuVU5BVVRIT1JJWkVEX0FDQ0VTUyxcclxuICAgICAgICAgIFRocmVhdExldmVsLk1FRElVTSxcclxuICAgICAgICAgICdQcml2aWxlZ2VkIHBvcnQgdXNhZ2Ugd2l0aG91dCByb290IGFjY2VzcycsXHJcbiAgICAgICAgICB7IGxvY2FsUG9ydDogY29ubmVjdGlvbi5jb25maWcubG9jYWxQb3J0IH1cclxuICAgICAgICApO1xyXG4gICAgICB9XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYENvbm5lY3Rpb24gaW50ZWdyaXR5IGNoZWNrIGZhaWxlZCBmb3IgJHtjb25uZWN0aW9uLmlkfWAsIGVycm9yKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIERldGVjdCBpbnRydXNpb24gYXR0ZW1wdHNcclxuICAgKiBcclxuICAgKiBAcGFyYW0gY29ubmVjdGlvbiAtIFR1bm5lbCBjb25uZWN0aW9uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBkZXRlY3RJbnRydXNpb25zKGNvbm5lY3Rpb246IFR1bm5lbENvbm5lY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcclxuICAgIHRyeSB7XHJcbiAgICAgIC8vIFNpbXVsYXRlIGxvZyBhbmFseXNpcyAoaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3b3VsZCBhbmFseXplIGFjdHVhbCBsb2dzKVxyXG4gICAgICBjb25zdCBsb2dFbnRyaWVzID0gdGhpcy5nZXRSZWNlbnRMb2dFbnRyaWVzKGNvbm5lY3Rpb24uaWQpO1xyXG5cclxuICAgICAgZm9yIChjb25zdCBsb2dFbnRyeSBvZiBsb2dFbnRyaWVzKSB7XHJcbiAgICAgICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHRoaXMuaW50cnVzaW9uUGF0dGVybnMpIHtcclxuICAgICAgICAgIGlmIChwYXR0ZXJuLnBhdHRlcm4udGVzdChsb2dFbnRyeSkpIHtcclxuICAgICAgICAgICAgdGhpcy5yZXBvcnRTZWN1cml0eUV2ZW50KFxyXG4gICAgICAgICAgICAgIGNvbm5lY3Rpb24uaWQsXHJcbiAgICAgICAgICAgICAgU2VjdXJpdHlFdmVudFR5cGUuU1VTUElDSU9VU19UUkFGRklDLFxyXG4gICAgICAgICAgICAgIHBhdHRlcm4udGhyZWF0TGV2ZWwsXHJcbiAgICAgICAgICAgICAgcGF0dGVybi5kZXNjcmlwdGlvbixcclxuICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICBwYXR0ZXJuOiBwYXR0ZXJuLm5hbWUsXHJcbiAgICAgICAgICAgICAgICBsb2dFbnRyeSxcclxuICAgICAgICAgICAgICAgIHJlc3BvbnNlQWN0aW9uOiBwYXR0ZXJuLnJlc3BvbnNlQWN0aW9uXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG5cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIHRoaXMubG9nZ2VyLmVycm9yKGBJbnRydXNpb24gZGV0ZWN0aW9uIGZhaWxlZCBmb3IgY29ubmVjdGlvbiAke2Nvbm5lY3Rpb24uaWR9YCwgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2hlY2sgZGF0YSBpbnRlZ3JpdHlcclxuICAgKiBcclxuICAgKiBAcGFyYW0gY29ubmVjdGlvbiAtIFR1bm5lbCBjb25uZWN0aW9uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBhc3luYyBjaGVja0RhdGFJbnRlZ3JpdHkoY29ubmVjdGlvbjogVHVubmVsQ29ubmVjdGlvbik6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gQ2FsY3VsYXRlIGN1cnJlbnQgZGF0YSBpbnRlZ3JpdHkgaGFzaFxyXG4gICAgICBjb25zdCBjdXJyZW50SGFzaCA9IHRoaXMuY2FsY3VsYXRlRGF0YUludGVncml0eUhhc2goY29ubmVjdGlvbi5pZCk7XHJcbiAgICAgIFxyXG4gICAgICAvLyBHZXQgcHJldmlvdXMgaGFzaCBmcm9tIHRyYWZmaWMgYW5hbHlzaXNcclxuICAgICAgY29uc3QgYW5hbHlzaXNIaXN0b3J5ID0gdGhpcy50cmFmZmljQW5hbHlzaXMuZ2V0KGNvbm5lY3Rpb24uaWQpIHx8IFtdO1xyXG4gICAgICBjb25zdCBwcmV2aW91c0FuYWx5c2lzID0gYW5hbHlzaXNIaXN0b3J5W2FuYWx5c2lzSGlzdG9yeS5sZW5ndGggLSAxXTtcclxuXHJcbiAgICAgIGlmIChwcmV2aW91c0FuYWx5c2lzICYmIHByZXZpb3VzQW5hbHlzaXMuZGF0YUludGVncml0eUhhc2ggIT09IGN1cnJlbnRIYXNoKSB7XHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGRpZmZlcmVuY2UgaXMgc2lnbmlmaWNhbnRcclxuICAgICAgICBjb25zdCBoYXNoRGlmZmVyZW5jZSA9IHRoaXMuY2FsY3VsYXRlSGFzaERpZmZlcmVuY2UocHJldmlvdXNBbmFseXNpcy5kYXRhSW50ZWdyaXR5SGFzaCwgY3VycmVudEhhc2gpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmIChoYXNoRGlmZmVyZW5jZSA+IDAuMSkgeyAvLyAxMCUgdGhyZXNob2xkXHJcbiAgICAgICAgICB0aGlzLnJlcG9ydFNlY3VyaXR5RXZlbnQoXHJcbiAgICAgICAgICAgIGNvbm5lY3Rpb24uaWQsXHJcbiAgICAgICAgICAgIFNlY3VyaXR5RXZlbnRUeXBlLkRBVEFfSU5URUdSSVRZX1ZJT0xBVElPTixcclxuICAgICAgICAgICAgVGhyZWF0TGV2ZWwuSElHSCxcclxuICAgICAgICAgICAgJ0RhdGEgaW50ZWdyaXR5IHZpb2xhdGlvbiBkZXRlY3RlZCcsXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICBwcmV2aW91c0hhc2g6IHByZXZpb3VzQW5hbHlzaXMuZGF0YUludGVncml0eUhhc2gsXHJcbiAgICAgICAgICAgICAgY3VycmVudEhhc2gsXHJcbiAgICAgICAgICAgICAgZGlmZmVyZW5jZTogaGFzaERpZmZlcmVuY2VcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgKTtcclxuXHJcbiAgICAgICAgICB0aGlzLnNlY3VyaXR5TWV0cmljcy5pbnRlZ3JpdHlWaW9sYXRpb25zKys7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYERhdGEgaW50ZWdyaXR5IGNoZWNrIGZhaWxlZCBmb3IgY29ubmVjdGlvbiAke2Nvbm5lY3Rpb24uaWR9YCwgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRGV0ZWN0IHN1c3BpY2lvdXMgcGF0dGVybnMgaW4gdHJhZmZpYyBhbmFseXNpc1xyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBhbmFseXNpcyAtIFRyYWZmaWMgYW5hbHlzaXMgZGF0YVxyXG4gICAqIEByZXR1cm5zIEFycmF5IG9mIHN1c3BpY2lvdXMgcGF0dGVybiBuYW1lc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZGV0ZWN0U3VzcGljaW91c1BhdHRlcm5zKGFuYWx5c2lzOiBUcmFmZmljQW5hbHlzaXMpOiBzdHJpbmdbXSB7XHJcbiAgICBjb25zdCBwYXR0ZXJuczogc3RyaW5nW10gPSBbXTtcclxuXHJcbiAgICAvLyBDaGVjayBmb3IgdW51c3VhbCB0cmFmZmljIHZvbHVtZVxyXG4gICAgaWYgKGFuYWx5c2lzLmJ5dGVzSW4gPiAxMDAwMDAgfHwgYW5hbHlzaXMuYnl0ZXNPdXQgPiAxMDAwMDApIHtcclxuICAgICAgcGF0dGVybnMucHVzaCgnSGlnaCB0cmFmZmljIHZvbHVtZScpO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENoZWNrIGZvciBwYWNrZXQgcmF0aW8gYW5vbWFsaWVzXHJcbiAgICBjb25zdCBwYWNrZXRSYXRpbyA9IGFuYWx5c2lzLnBhY2tldHNJbiAvIE1hdGgubWF4KGFuYWx5c2lzLnBhY2tldHNPdXQsIDEpO1xyXG4gICAgaWYgKHBhY2tldFJhdGlvID4gMTAgfHwgcGFja2V0UmF0aW8gPCAwLjEpIHtcclxuICAgICAgcGF0dGVybnMucHVzaCgnVW51c3VhbCBwYWNrZXQgcmF0aW8nKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBDaGVjayBmb3IgcG90ZW50aWFsIGRhdGEgZXhmaWx0cmF0aW9uXHJcbiAgICBpZiAoYW5hbHlzaXMuYnl0ZXNPdXQgPiBhbmFseXNpcy5ieXRlc0luICogMikge1xyXG4gICAgICBwYXR0ZXJucy5wdXNoKCdQb3RlbnRpYWwgZGF0YSBleGZpbHRyYXRpb24nKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcGF0dGVybnM7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDYWxjdWxhdGUgZGF0YSBpbnRlZ3JpdHkgaGFzaFxyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBjb25uZWN0aW9uSWQgLSBDb25uZWN0aW9uIGlkZW50aWZpZXJcclxuICAgKiBAcmV0dXJucyBEYXRhIGludGVncml0eSBoYXNoXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjYWxjdWxhdGVEYXRhSW50ZWdyaXR5SGFzaChjb25uZWN0aW9uSWQ6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICBjb25zdCBjb25uZWN0aW9uID0gdGhpcy50dW5uZWxNYW5hZ2VyLmdldENvbm5lY3Rpb24oY29ubmVjdGlvbklkKTtcclxuICAgIGlmICghY29ubmVjdGlvbikgcmV0dXJuICcnO1xyXG5cclxuICAgIGNvbnN0IGRhdGEgPSBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgIGNvbm5lY3Rpb25JZCxcclxuICAgICAgY29uZmlnOiBjb25uZWN0aW9uLmNvbmZpZyxcclxuICAgICAgc3RhdGU6IGNvbm5lY3Rpb24uc3RhdGUsXHJcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIGNyZWF0ZUhhc2goJ3NoYTI1NicpLnVwZGF0ZShkYXRhKS5kaWdlc3QoJ2hleCcpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ2FsY3VsYXRlIGhhc2ggZGlmZmVyZW5jZSBwZXJjZW50YWdlXHJcbiAgICogXHJcbiAgICogQHBhcmFtIGhhc2gxIC0gRmlyc3QgaGFzaFxyXG4gICAqIEBwYXJhbSBoYXNoMiAtIFNlY29uZCBoYXNoXHJcbiAgICogQHJldHVybnMgRGlmZmVyZW5jZSBwZXJjZW50YWdlICgwLTEpXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBjYWxjdWxhdGVIYXNoRGlmZmVyZW5jZShoYXNoMTogc3RyaW5nLCBoYXNoMjogc3RyaW5nKTogbnVtYmVyIHtcclxuICAgIGlmIChoYXNoMS5sZW5ndGggIT09IGhhc2gyLmxlbmd0aCkgcmV0dXJuIDE7XHJcblxyXG4gICAgbGV0IGRpZmZlcmVuY2VzID0gMDtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaGFzaDEubGVuZ3RoOyBpKyspIHtcclxuICAgICAgaWYgKGhhc2gxW2ldICE9PSBoYXNoMltpXSkge1xyXG4gICAgICAgIGRpZmZlcmVuY2VzKys7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gZGlmZmVyZW5jZXMgLyBoYXNoMS5sZW5ndGg7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZXQgcmVjZW50IGxvZyBlbnRyaWVzIGZvciBhbmFseXNpc1xyXG4gICAqIFxyXG4gICAqIEBwYXJhbSBjb25uZWN0aW9uSWQgLSBDb25uZWN0aW9uIGlkZW50aWZpZXJcclxuICAgKiBAcmV0dXJucyBBcnJheSBvZiBsb2cgZW50cmllc1xyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2V0UmVjZW50TG9nRW50cmllcyhjb25uZWN0aW9uSWQ6IHN0cmluZyk6IHN0cmluZ1tdIHtcclxuICAgIC8vIFNpbXVsYXRlIGxvZyBlbnRyaWVzIChpbiByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIHJlYWQgYWN0dWFsIGxvZ3MpXHJcbiAgICByZXR1cm4gW1xyXG4gICAgICBgU1NIIGNvbm5lY3Rpb24gZXN0YWJsaXNoZWQgZm9yICR7Y29ubmVjdGlvbklkfWAsXHJcbiAgICAgIGBEYXRhIHRyYW5zZmVyIGluaXRpYXRlZCBmb3IgJHtjb25uZWN0aW9uSWR9YCxcclxuICAgICAgYE5vcm1hbCBvcGVyYXRpb24gZm9yICR7Y29ubmVjdGlvbklkfWAsXHJcbiAgICAgIC8vIEFkZCBzb21lIHBvdGVudGlhbGx5IHN1c3BpY2lvdXMgZW50cmllcyBmb3IgdGVzdGluZ1xyXG4gICAgICAuLi4oTWF0aC5yYW5kb20oKSA+IDAuOCA/IFsnU1NIIGF1dGhlbnRpY2F0aW9uIGZhaWxlZCBmb3IgdXNlciBhZG1pbiddIDogW10pLFxyXG4gICAgICAuLi4oTWF0aC5yYW5kb20oKSA+IDAuOSA/IFsnUG9ydCBzY2FuIGRldGVjdGVkIGZyb20gMTkyLjE2OC4xLjEwMCddIDogW10pXHJcbiAgICBdO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVHJpZ2dlciBhdXRvbWF0aWMgcmVzcG9uc2UgdG8gc2VjdXJpdHkgZXZlbnRcclxuICAgKiBcclxuICAgKiBAcGFyYW0gZXZlbnQgLSBTZWN1cml0eSBldmVudFxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgdHJpZ2dlckF1dG9tYXRpY1Jlc3BvbnNlKGV2ZW50OiBTZWN1cml0eUV2ZW50KTogUHJvbWlzZTx2b2lkPiB7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCByZXNwb25zZUFjdGlvbnM6IHN0cmluZ1tdID0gW107XHJcblxyXG4gICAgICBzd2l0Y2ggKGV2ZW50LnRocmVhdExldmVsKSB7XHJcbiAgICAgICAgY2FzZSBUaHJlYXRMZXZlbC5DUklUSUNBTDpcclxuICAgICAgICAgIC8vIEltbWVkaWF0ZSBjb25uZWN0aW9uIHRlcm1pbmF0aW9uXHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnR1bm5lbE1hbmFnZXIuZGlzY29ubmVjdFR1bm5lbChldmVudC5jb25uZWN0aW9uSWQpO1xyXG4gICAgICAgICAgcmVzcG9uc2VBY3Rpb25zLnB1c2goJ0Nvbm5lY3Rpb24gdGVybWluYXRlZCcpO1xyXG4gICAgICAgICAgYnJlYWs7XHJcblxyXG4gICAgICAgIGNhc2UgVGhyZWF0TGV2ZWwuSElHSDpcclxuICAgICAgICAgIC8vIEVuaGFuY2VkIG1vbml0b3JpbmcgYW5kIGFsZXJ0aW5nXHJcbiAgICAgICAgICByZXNwb25zZUFjdGlvbnMucHVzaCgnRW5oYW5jZWQgbW9uaXRvcmluZyBlbmFibGVkJyk7XHJcbiAgICAgICAgICB0aGlzLmVtaXQoJ2hpZ2hUaHJlYXREZXRlY3RlZCcsIGV2ZW50KTtcclxuICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBjYXNlIFRocmVhdExldmVsLk1FRElVTTpcclxuICAgICAgICAgIC8vIEluY3JlYXNlZCBsb2dnaW5nIGFuZCBtb25pdG9yaW5nXHJcbiAgICAgICAgICByZXNwb25zZUFjdGlvbnMucHVzaCgnSW5jcmVhc2VkIG1vbml0b3JpbmcnKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG5cclxuICAgICAgICBjYXNlIFRocmVhdExldmVsLkxPVzpcclxuICAgICAgICAgIC8vIExvZyBhbmQgY29udGludWUgbW9uaXRvcmluZ1xyXG4gICAgICAgICAgcmVzcG9uc2VBY3Rpb25zLnB1c2goJ0xvZ2dlZCBmb3IgYW5hbHlzaXMnKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyBVcGRhdGUgZXZlbnQgd2l0aCByZXNwb25zZSBhY3Rpb25zXHJcbiAgICAgIGV2ZW50LnJlc3BvbnNlQWN0aW9ucyA9IHJlc3BvbnNlQWN0aW9ucztcclxuXHJcbiAgICAgIHRoaXMubG9nZ2VyLmluZm8oYEF1dG9tYXRpYyByZXNwb25zZSB0cmlnZ2VyZWQgZm9yIGV2ZW50ICR7ZXZlbnQuaWR9YCwgeyByZXNwb25zZUFjdGlvbnMgfSk7XHJcblxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgdGhpcy5sb2dnZXIuZXJyb3IoYEF1dG9tYXRpYyByZXNwb25zZSBmYWlsZWQgZm9yIGV2ZW50ICR7ZXZlbnQuaWR9YCwgZXJyb3IpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3RhcnQgcGVyaW9kaWMgc2VjdXJpdHkgc2NhbnNcclxuICAgKi9cclxuICBwcml2YXRlIHN0YXJ0UGVyaW9kaWNTZWN1cml0eVNjYW5zKCk6IHZvaWQge1xyXG4gICAgLy8gUGVyZm9ybSBzZWN1cml0eSBzY2FucyBldmVyeSA1IG1pbnV0ZXNcclxuICAgIHNldEludGVydmFsKCgpID0+IHtcclxuICAgICAgY29uc3QgY29ubmVjdGlvbnMgPSB0aGlzLnR1bm5lbE1hbmFnZXIuZ2V0QWxsQ29ubmVjdGlvbnMoKTtcclxuICAgICAgZm9yIChjb25zdCBjb25uZWN0aW9uIG9mIGNvbm5lY3Rpb25zKSB7XHJcbiAgICAgICAgdGhpcy5wZXJmb3JtU2VjdXJpdHlTY2FuKGNvbm5lY3Rpb24uaWQpO1xyXG4gICAgICB9XHJcbiAgICB9LCA1ICogNjAgKiAxMDAwKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZSBzZWN1cml0eSBtZXRyaWNzXHJcbiAgICogXHJcbiAgICogQHBhcmFtIGV2ZW50IC0gU2VjdXJpdHkgZXZlbnRcclxuICAgKi9cclxuICBwcml2YXRlIHVwZGF0ZVNlY3VyaXR5TWV0cmljcyhldmVudDogU2VjdXJpdHlFdmVudCk6IHZvaWQge1xyXG4gICAgdGhpcy5zZWN1cml0eU1ldHJpY3MudG90YWxFdmVudHMrKztcclxuICAgIHRoaXMuc2VjdXJpdHlNZXRyaWNzLmFjdGl2ZVRocmVhdHMrKztcclxuXHJcbiAgICAvLyBVcGRhdGUgZXZlbnQgdHlwZSBjb3VudHNcclxuICAgIGNvbnN0IHR5cGVDb3VudCA9IHRoaXMuc2VjdXJpdHlNZXRyaWNzLmV2ZW50c0J5VHlwZS5nZXQoZXZlbnQudHlwZSkgfHwgMDtcclxuICAgIHRoaXMuc2VjdXJpdHlNZXRyaWNzLmV2ZW50c0J5VHlwZS5zZXQoZXZlbnQudHlwZSwgdHlwZUNvdW50ICsgMSk7XHJcblxyXG4gICAgLy8gVXBkYXRlIHRocmVhdCBsZXZlbCBjb3VudHNcclxuICAgIGNvbnN0IHRocmVhdENvdW50ID0gdGhpcy5zZWN1cml0eU1ldHJpY3MuZXZlbnRzQnlUaHJlYXRMZXZlbC5nZXQoZXZlbnQudGhyZWF0TGV2ZWwpIHx8IDA7XHJcbiAgICB0aGlzLnNlY3VyaXR5TWV0cmljcy5ldmVudHNCeVRocmVhdExldmVsLnNldChldmVudC50aHJlYXRMZXZlbCwgdGhyZWF0Q291bnQgKyAxKTtcclxuXHJcbiAgICAvLyBDYWxjdWxhdGUgc3lzdGVtIHNlY3VyaXR5IHNjb3JlXHJcbiAgICB0aGlzLmNhbGN1bGF0ZVN5c3RlbVNlY3VyaXR5U2NvcmUoKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFVwZGF0ZSBhbm9tYWx5IG1ldHJpY3NcclxuICAgKiBcclxuICAgKiBAcGFyYW0gYW5hbHlzaXMgLSBUcmFmZmljIGFuYWx5c2lzXHJcbiAgICovXHJcbiAgcHJpdmF0ZSB1cGRhdGVBbm9tYWx5TWV0cmljcyhhbmFseXNpczogVHJhZmZpY0FuYWx5c2lzKTogdm9pZCB7XHJcbiAgICAvLyBDYWxjdWxhdGUgcnVubmluZyBhdmVyYWdlIG9mIGFub21hbHkgc2NvcmVzXHJcbiAgICBjb25zdCBhbGxBbmFseXNpcyA9IEFycmF5LmZyb20odGhpcy50cmFmZmljQW5hbHlzaXMudmFsdWVzKCkpLmZsYXQoKTtcclxuICAgIGNvbnN0IHRvdGFsU2NvcmUgPSBhbGxBbmFseXNpcy5yZWR1Y2UoKHN1bSwgYSkgPT4gc3VtICsgYS5hbm9tYWx5U2NvcmUsIDApO1xyXG4gICAgdGhpcy5zZWN1cml0eU1ldHJpY3MuYXZlcmFnZUFub21hbHlTY29yZSA9IGFsbEFuYWx5c2lzLmxlbmd0aCA+IDAgPyB0b3RhbFNjb3JlIC8gYWxsQW5hbHlzaXMubGVuZ3RoIDogMDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENhbGN1bGF0ZSBzeXN0ZW0gc2VjdXJpdHkgc2NvcmVcclxuICAgKi9cclxuICBwcml2YXRlIGNhbGN1bGF0ZVN5c3RlbVNlY3VyaXR5U2NvcmUoKTogdm9pZCB7XHJcbiAgICBsZXQgc2NvcmUgPSAxMDA7XHJcblxyXG4gICAgLy8gRGVkdWN0IHBvaW50cyBmb3IgYWN0aXZlIHRocmVhdHNcclxuICAgIHNjb3JlIC09IHRoaXMuc2VjdXJpdHlNZXRyaWNzLmFjdGl2ZVRocmVhdHMgKiAxMDtcclxuXHJcbiAgICAvLyBEZWR1Y3QgcG9pbnRzIGZvciBoaWdoIGFub21hbHkgc2NvcmVzXHJcbiAgICBpZiAodGhpcy5zZWN1cml0eU1ldHJpY3MuYXZlcmFnZUFub21hbHlTY29yZSA+IDcwKSB7XHJcbiAgICAgIHNjb3JlIC09ICh0aGlzLnNlY3VyaXR5TWV0cmljcy5hdmVyYWdlQW5vbWFseVNjb3JlIC0gNzApICogMC41O1xyXG4gICAgfVxyXG5cclxuICAgIC8vIERlZHVjdCBwb2ludHMgZm9yIGludGVncml0eSB2aW9sYXRpb25zXHJcbiAgICBzY29yZSAtPSB0aGlzLnNlY3VyaXR5TWV0cmljcy5pbnRlZ3JpdHlWaW9sYXRpb25zICogNTtcclxuXHJcbiAgICAvLyBEZWR1Y3QgcG9pbnRzIGZvciBjcml0aWNhbCBldmVudHNcclxuICAgIGNvbnN0IGNyaXRpY2FsRXZlbnRzID0gdGhpcy5zZWN1cml0eU1ldHJpY3MuZXZlbnRzQnlUaHJlYXRMZXZlbC5nZXQoVGhyZWF0TGV2ZWwuQ1JJVElDQUwpIHx8IDA7XHJcbiAgICBzY29yZSAtPSBjcml0aWNhbEV2ZW50cyAqIDIwO1xyXG5cclxuICAgIHRoaXMuc2VjdXJpdHlNZXRyaWNzLnN5c3RlbVNlY3VyaXR5U2NvcmUgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxMDAsIHNjb3JlKSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBHZW5lcmF0ZSB1bmlxdWUgZXZlbnQgSURcclxuICAgKiBcclxuICAgKiBAcmV0dXJucyBVbmlxdWUgZXZlbnQgaWRlbnRpZmllclxyXG4gICAqL1xyXG4gIHByaXZhdGUgZ2VuZXJhdGVFdmVudElkKCk6IHN0cmluZyB7XHJcbiAgICByZXR1cm4gYHNlY18ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyKDIsIDkpfWA7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDbGVhbnVwIHNlY3VyaXR5IG1vbml0b3IgcmVzb3VyY2VzXHJcbiAgICovXHJcbiAgY2xlYW51cCgpOiB2b2lkIHtcclxuICAgIHRoaXMuc3RvcE1vbml0b3JpbmcoKTtcclxuICAgIFxyXG4gICAgLy8gQ2xlYW4gdXAgb2xkIGV2ZW50c1xyXG4gICAgY29uc3QgY3V0b2ZmVGltZSA9IERhdGUubm93KCkgLSB0aGlzLmNvbmZpZy5ldmVudFJldGVudGlvblBlcmlvZDtcclxuICAgIGZvciAoY29uc3QgW2V2ZW50SWQsIGV2ZW50XSBvZiB0aGlzLnNlY3VyaXR5RXZlbnRzLmVudHJpZXMoKSkge1xyXG4gICAgICBpZiAoZXZlbnQudGltZXN0YW1wLmdldFRpbWUoKSA8IGN1dG9mZlRpbWUpIHtcclxuICAgICAgICB0aGlzLnNlY3VyaXR5RXZlbnRzLmRlbGV0ZShldmVudElkKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRoaXMudHJhZmZpY0FuYWx5c2lzLmNsZWFyKCk7XHJcbiAgICB0aGlzLmxvZ2dlci5pbmZvKCdUdW5uZWwgc2VjdXJpdHkgbW9uaXRvciBjbGVhbnVwIGNvbXBsZXRlZCcpO1xyXG4gIH1cclxufSJdLCJ2ZXJzaW9uIjozfQ==